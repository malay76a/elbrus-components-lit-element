{"version":3,"file":"chunk-260346dc.js","sources":["../../node_modules/@webcomponents/shadydom/src/shady-data.js","../../node_modules/@webcomponents/shadydom/src/utils.js","../../node_modules/@webcomponents/shadydom/src/flush.js","../../node_modules/@webcomponents/shadydom/src/observe-changes.js","../../node_modules/@webcomponents/shadydom/src/innerHTML.js","../../node_modules/@webcomponents/shadydom/src/patch-native.js","../../node_modules/@webcomponents/shadydom/src/patch-instances.js","../../node_modules/@webcomponents/shadydom/src/patch-events.js","../../node_modules/@webcomponents/shadydom/src/array-splice.js","../../node_modules/@webcomponents/shadydom/src/link-nodes.js","../../node_modules/@webcomponents/shadydom/src/style-scoping.js","../../node_modules/@webcomponents/shadydom/src/patches/Node.js","../../node_modules/@webcomponents/shadydom/src/patches/ParentNode.js","../../node_modules/@webcomponents/shadydom/src/patches/DocumentOrFragment.js","../../node_modules/@webcomponents/shadydom/src/patches/DocumentOrShadowRoot.js","../../node_modules/@webcomponents/shadydom/src/patches/ElementOrShadowRoot.js","../../node_modules/@webcomponents/shadydom/src/patches/ShadowRoot.js","../../node_modules/@webcomponents/shadydom/src/patch-shadyRoot.js","../../node_modules/@webcomponents/shadydom/src/attach-shadow.js","../../node_modules/@webcomponents/shadydom/src/wrapper.js","../../node_modules/@webcomponents/shadydom/src/patches/EventTarget.js","../../node_modules/@webcomponents/shadydom/src/patches/Slotable.js","../../node_modules/@webcomponents/shadydom/src/patches/Element.js","../../node_modules/@webcomponents/shadydom/src/patches/HTMLElement.js","../../node_modules/@webcomponents/shadydom/src/patches/Slot.js","../../node_modules/@webcomponents/shadydom/src/patches/Document.js","../../node_modules/@webcomponents/shadydom/src/patches/Window.js","../../node_modules/@webcomponents/shadydom/src/patch-prototypes.js","../../node_modules/@webcomponents/shadydom/src/shadydom.js","../../node_modules/@webcomponents/custom-elements/src/Utilities.js","../../node_modules/@webcomponents/custom-elements/src/CustomElementState.js","../../node_modules/@webcomponents/custom-elements/src/CustomElementInternals.js","../../node_modules/@webcomponents/custom-elements/src/DocumentConstructionObserver.js","../../node_modules/@webcomponents/custom-elements/src/Deferred.js","../../node_modules/@webcomponents/custom-elements/src/CustomElementRegistry.js","../../node_modules/@webcomponents/custom-elements/src/Patch/Native.js","../../node_modules/@webcomponents/custom-elements/src/AlreadyConstructedMarker.js","../../node_modules/@webcomponents/custom-elements/src/Patch/HTMLElement.js","../../node_modules/@webcomponents/custom-elements/src/Patch/Interface/ParentNode.js","../../node_modules/@webcomponents/custom-elements/src/Patch/Document.js","../../node_modules/@webcomponents/custom-elements/src/Patch/DocumentFragment.js","../../node_modules/@webcomponents/custom-elements/src/Patch/Node.js","../../node_modules/@webcomponents/custom-elements/src/Patch/Interface/ChildNode.js","../../node_modules/@webcomponents/custom-elements/src/Patch/Element.js","../../node_modules/@webcomponents/custom-elements/src/custom-elements.js","../../node_modules/@webcomponents/shadycss/src/css-parse.js","../../node_modules/@webcomponents/shadycss/src/style-settings.js","../../node_modules/@webcomponents/shadycss/src/common-regex.js","../../node_modules/@webcomponents/shadycss/src/unscoped-style-handler.js","../../node_modules/@webcomponents/shadycss/src/style-util.js","../../node_modules/@webcomponents/shadycss/src/style-transformer.js","../../node_modules/@webcomponents/shadycss/src/style-info.js","../../node_modules/@webcomponents/shadycss/src/style-properties.js","../../node_modules/@webcomponents/shadycss/src/style-placeholder.js","../../node_modules/@webcomponents/shadycss/src/style-cache.js","../../node_modules/@webcomponents/shadycss/src/document-watcher.js","../../node_modules/@webcomponents/shadycss/src/template-map.js","../../node_modules/@webcomponents/shadycss/src/apply-shim-utils.js","../../node_modules/@webcomponents/shadycss/src/common-utils.js","../../node_modules/@webcomponents/shadycss/src/document-wait.js","../../node_modules/@webcomponents/shadycss/src/custom-style-interface.js","../../node_modules/@webcomponents/shadycss/src/scoping-shim.js","../../node_modules/@webcomponents/shadycss/entrypoints/scoping-shim.js"],"sourcesContent":["/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n\nexport class ShadyData {\n  constructor() {\n    /** @type {ShadowRoot} */\n    this.root = null;\n    /** @type {ShadowRoot} */\n    this.publicRoot = null;\n    this.dirty = false;\n    this.observer = null;\n    /** @type {Array<Node>} */\n    this.assignedNodes = null;\n    /** @type {Element} */\n    this.assignedSlot = null;\n    /** @type {Array<Node>} */\n    this._previouslyAssignedNodes = null;\n    /** @type {Element} */\n    this._prevAssignedSlot = null;\n    /** @type {Array<Node>} */\n    this.flattenedNodes = null;\n    this.ownerShadyRoot = undefined;\n    /** @type {Node|undefined} */\n    this.parentNode = undefined;\n    /** @type {Node|undefined} */\n    this.firstChild = undefined;\n    /** @type {Node|undefined} */\n    this.lastChild = undefined;\n    /** @type {Node|undefined} */\n    this.previousSibling = undefined;\n    /** @type {Node|undefined} */\n    this.nextSibling = undefined;\n    /** @type {Array<Node>|undefined} */\n    this.childNodes = undefined;\n    this.__outsideAccessors = false;\n    this.__insideAccessors = false;\n    this.__onCallbackListeners = {};\n  }\n\n  /** @override */\n  toJSON() {\n    return {};\n  }\n}\n\nexport function ensureShadyDataForNode(node) {\n  if (!node.__shady) {\n    node.__shady = new ShadyData();\n  }\n  return node.__shady;\n}\n\nexport function shadyDataForNode(node) {\n  return node && node.__shady;\n}\n","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\nimport {shadyDataForNode} from './shady-data.js';\n\n/** @type {!Object} */\nexport const settings = window['ShadyDOM'] || {};\n\nsettings.hasNativeShadowDOM = Boolean(Element.prototype.attachShadow && Node.prototype.getRootNode);\n\nconst desc = Object.getOwnPropertyDescriptor(Node.prototype, 'firstChild');\n\nsettings.hasDescriptors = Boolean(desc && desc.configurable && desc.get);\nsettings.inUse = settings['force'] || !settings.hasNativeShadowDOM;\nsettings.noPatch = settings['noPatch'] || false;\nsettings.preferPerformance = settings['preferPerformance'];\n\nexport const isTrackingLogicalChildNodes = (node) => {\n  const nodeData = shadyDataForNode(node);\n  return (nodeData && nodeData.firstChild !== undefined);\n}\n\nexport const isShadyRoot = (obj) => {\n  return Boolean(obj._localName === 'ShadyRoot');\n}\n\nexport const hasShadowRootWithSlot = (node) => {\n  const nodeData = shadyDataForNode(node);\n  let root = nodeData && nodeData.root;\n  return (root && root._hasInsertionPoint());\n}\n\nlet p = Element.prototype;\nlet matches = p.matches || p.matchesSelector ||\n  p.mozMatchesSelector || p.msMatchesSelector ||\n  p.oMatchesSelector || p.webkitMatchesSelector;\n\nexport const matchesSelector = (element, selector) => {\n  return matches.call(element, selector);\n}\n\nexport const mixin = (target, source) => {\n  for (var i in source) {\n    target[i] = source[i];\n  }\n  return target;\n}\n\n// NOTE, prefer MutationObserver over Promise for microtask timing\n// for consistency x-platform.\nlet twiddle = document.createTextNode('');\nlet content = 0;\nlet queue = [];\nnew MutationObserver(() => {\n  while (queue.length) {\n    // catch errors in user code...\n    try {\n      queue.shift()();\n    } catch(e) {\n      // enqueue another record and throw\n      twiddle.textContent = content++;\n      throw(e);\n    }\n  }\n}).observe(twiddle, {characterData: true});\n\n// use MutationObserver to get microtask async timing.\nexport const microtask = (callback) => {\n  queue.push(callback);\n  twiddle.textContent = content++;\n}\n\nexport const hasDocumentContains = Boolean(document.contains);\n\nexport const contains = (container, node) => {\n  while (node) {\n    if (node == container) {\n      return true;\n    }\n    node = node[SHADY_PREFIX + 'parentNode'];\n  }\n  return false;\n}\n\nconst getNodeHTMLCollectionName = (node) =>\n    node.getAttribute('id') || node.getAttribute('name');\n\nconst isValidHTMLCollectionName = (name) => name !== 'length' && isNaN(name);\n\nexport const createPolyfilledHTMLCollection = (nodes) => {\n  // Note: loop in reverse so that the first named item matches the named property\n  for (let l = nodes.length - 1; l >= 0; l--) {\n    const node = nodes[l];\n    const name = getNodeHTMLCollectionName(node);\n\n    if (name && isValidHTMLCollectionName(name)) {\n      nodes[name] = node;\n    }\n  }\n  nodes.item = function(index) {\n    return nodes[index];\n  }\n  nodes.namedItem = function(name) {\n    if (isValidHTMLCollectionName(name) && nodes[name]) {\n      return nodes[name];\n    }\n\n    for (const node of nodes) {\n      const nodeName = getNodeHTMLCollectionName(node);\n\n      if (nodeName == name) {\n        return node;\n      }\n    }\n\n    return null;\n  };\n  return nodes;\n}\n\nexport const NATIVE_PREFIX = '__shady_native_';\nexport const SHADY_PREFIX = '__shady_';\n\n\n\n/**\n * Patch a group of accessors on an object only if it exists or if the `force`\n * argument is true.\n * @param {!Object} proto\n * @param {!Object} descriptors\n * @param {string=} prefix\n * @param {Array=} disallowedPatches\n */\nexport const patchProperties = (proto, descriptors, prefix = '', disallowedPatches) => {\n  for (let p in descriptors) {\n    const newDescriptor = descriptors[p];\n    if (disallowedPatches && disallowedPatches.indexOf(p) >= 0) {\n      continue;\n    }\n    newDescriptor.configurable = true;\n    const name = prefix + p;\n    // NOTE: we prefer writing directly because some browsers\n    // have descriptors that are writable but not configurable (e.g.\n    // `appendChild` on older browsers)\n    if (newDescriptor.value) {\n      proto[name] = newDescriptor.value;\n    } else {\n      // NOTE: this can throw if 'force' is used so catch the error.\n      try {\n        Object.defineProperty(proto, name, newDescriptor);\n      } catch(e) {\n        // this error is harmless so we just trap it.\n      }\n    }\n  }\n}\n\n/** @type {!function(new:HTMLElement)} */\nexport const NativeHTMLElement =\n    (window['customElements'] && window['customElements']['nativeHTMLElement']) ||\n    HTMLElement;\n\n// note, this is not a perfect polyfill since it doesn't include symbols\n/** @return {!Object<!ObjectPropertyDescriptor>} */\nexport const getOwnPropertyDescriptors = (obj) => {\n  const descriptors = {};\n  Object.getOwnPropertyNames(obj).forEach((name) => {\n    descriptors[name] = Object.getOwnPropertyDescriptor(obj, name);\n  });\n  return descriptors;\n};\n","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\nimport * as utils from './utils.js';\n\n// render enqueuer/flusher\nlet flushList = [];\nlet scheduled;\nexport function enqueue(callback) {\n  if (!scheduled) {\n    scheduled = true;\n    utils.microtask(flush);\n  }\n  flushList.push(callback);\n}\n\nexport function flush() {\n  scheduled = false;\n  let didFlush = Boolean(flushList.length);\n  while (flushList.length) {\n    flushList.shift()();\n  }\n  return didFlush;\n}\n\nflush['list'] = flushList;\n","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\nimport * as utils from './utils.js';\nimport {ensureShadyDataForNode} from './shady-data.js';\n\nclass AsyncObserver {\n\n  constructor() {\n    this._scheduled = false;\n    this.addedNodes = [];\n    this.removedNodes = [];\n    this.callbacks = new Set();\n  }\n\n  schedule() {\n    if (!this._scheduled) {\n      this._scheduled = true;\n      utils.microtask(() => {\n        this.flush();\n      });\n    }\n  }\n\n  flush() {\n    if (this._scheduled) {\n      this._scheduled = false;\n      let mutations = this.takeRecords();\n      if (mutations.length) {\n        this.callbacks.forEach(function(cb) {\n          cb(mutations);\n        });\n      }\n    }\n  }\n\n  takeRecords() {\n    if (this.addedNodes.length || this.removedNodes.length) {\n      let mutations = [{\n        addedNodes: this.addedNodes,\n        removedNodes: this.removedNodes\n      }];\n      this.addedNodes = [];\n      this.removedNodes = [];\n      return mutations;\n    }\n    return [];\n  }\n\n}\n\n// TODO(sorvell): consider instead polyfilling MutationObserver\n// directly so that users do not have to fork their code.\n// Supporting the entire api may be challenging: e.g. filtering out\n// removed nodes in the wrong scope and seeing non-distributing\n// subtree child mutations.\nexport let observeChildren = function(node, callback) {\n  const sd = ensureShadyDataForNode(node);\n  if (!sd.observer) {\n    sd.observer = new AsyncObserver();\n  }\n  sd.observer.callbacks.add(callback);\n  let observer = sd.observer;\n  return {\n    _callback: callback,\n    _observer: observer,\n    _node: node,\n    takeRecords() {\n      return observer.takeRecords()\n    }\n  };\n}\n\nexport let unobserveChildren = function(handle) {\n  let observer = handle && handle._observer;\n  if (observer) {\n    observer.callbacks.delete(handle._callback);\n    if (!observer.callbacks.size) {\n      ensureShadyDataForNode(handle._node).observer = null;\n    }\n  }\n}\n\nexport function filterMutations(mutations, target) {\n  /** @const {Node} */\n  const targetRootNode = target.getRootNode();\n  return mutations.map(function(mutation) {\n    /** @const {boolean} */\n    const mutationInScope = (targetRootNode === mutation.target.getRootNode());\n    if (mutationInScope && mutation.addedNodes) {\n      let nodes = Array.from(mutation.addedNodes).filter(function(n) {\n        return (targetRootNode === n.getRootNode());\n      });\n      if (nodes.length) {\n        mutation = Object.create(mutation);\n        Object.defineProperty(mutation, 'addedNodes', {\n          value: nodes,\n          configurable: true\n        });\n        return mutation;\n      }\n    } else if (mutationInScope) {\n      return mutation;\n    }\n  }).filter(function(m) { return m});\n}\n","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n// Cribbed from ShadowDOM polyfill\n// https://github.com/webcomponents/webcomponentsjs/blob/master/src/ShadowDOM/wrappers/HTMLElement.js#L28\n/////////////////////////////////////////////////////////////////////////////\n// innerHTML and outerHTML\n\n// http://www.whatwg.org/specs/web-apps/current-work/multipage/the-end.html#escapingString\nlet escapeAttrRegExp = /[&\\u00A0\"]/g;\nlet escapeDataRegExp = /[&\\u00A0<>]/g;\n\nfunction escapeReplace(c) {\n  switch (c) {\n    case '&':\n      return '&amp;';\n    case '<':\n      return '&lt;';\n    case '>':\n      return '&gt;';\n    case '\"':\n      return '&quot;';\n    case '\\u00A0':\n      return '&nbsp;';\n  }\n}\n\nfunction escapeAttr(s) {\n  return s.replace(escapeAttrRegExp, escapeReplace);\n}\n\nfunction escapeData(s) {\n  return s.replace(escapeDataRegExp, escapeReplace);\n}\n\nfunction makeSet(arr) {\n  let set = {};\n  for (let i = 0; i < arr.length; i++) {\n    set[arr[i]] = true;\n  }\n  return set;\n}\n\n// http://www.whatwg.org/specs/web-apps/current-work/#void-elements\nlet voidElements = makeSet([\n  'area',\n  'base',\n  'br',\n  'col',\n  'command',\n  'embed',\n  'hr',\n  'img',\n  'input',\n  'keygen',\n  'link',\n  'meta',\n  'param',\n  'source',\n  'track',\n  'wbr'\n]);\n\nlet plaintextParents = makeSet([\n  'style',\n  'script',\n  'xmp',\n  'iframe',\n  'noembed',\n  'noframes',\n  'plaintext',\n  'noscript'\n]);\n\n/**\n * @param {Node} node\n * @param {Node} parentNode\n * @param {Function=} callback\n */\nexport function getOuterHTML(node, parentNode, callback) {\n  switch (node.nodeType) {\n    case Node.ELEMENT_NODE: {\n      let tagName = node.localName;\n      let s = '<' + tagName;\n      let attrs = node.attributes;\n      for (let i = 0, attr; (attr = attrs[i]); i++) {\n        s += ' ' + attr.name + '=\"' + escapeAttr(attr.value) + '\"';\n      }\n      s += '>';\n      if (voidElements[tagName]) {\n        return s;\n      }\n      return s + getInnerHTML(node, callback) + '</' + tagName + '>';\n    }\n    case Node.TEXT_NODE: {\n      let data = /** @type {Text} */ (node).data;\n      if (parentNode && plaintextParents[parentNode.localName]) {\n        return data;\n      }\n      return escapeData(data);\n    }\n    case Node.COMMENT_NODE: {\n      return '<!--' + /** @type {Comment} */ (node).data + '-->';\n    }\n    default: {\n      window.console.error(node);\n      throw new Error('not implemented');\n    }\n  }\n}\n\n/**\n * @param {Node} node\n * @param {Function=} callback\n */\nexport function getInnerHTML(node, callback) {\n  if (node.localName === 'template') {\n    node =  /** @type {HTMLTemplateElement} */ (node).content;\n  }\n  let s = '';\n  let c$ = callback ? callback(node) : node.childNodes;\n  for (let i=0, l=c$.length, child; (i<l) && (child=c$[i]); i++) {\n    s += getOuterHTML(child, node, callback);\n  }\n  return s;\n}\n","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\nimport * as utils from './utils.js';\nimport {patchProperties} from './utils.js';\nimport {getInnerHTML} from './innerHTML.js';\n\nconst hasDescriptors = utils.settings.hasDescriptors;\nexport const NATIVE_PREFIX = utils.NATIVE_PREFIX;\n\n// Object on which raw native methods are stored.\n// e.g. `nativeMethods.querySelector.call(node, selector)`\n// same as `node.querySelector(selector)`\nexport const nativeMethods = {\n  /** @this {Element} */\n  querySelector(selector) {\n    return this[NATIVE_PREFIX + 'querySelector'](selector);\n  },\n  /** @this {Element} */\n  querySelectorAll(selector) {\n    return this[NATIVE_PREFIX + 'querySelectorAll'](selector);\n  }\n};\n// Object on which raw native accessors are available via `accessorName(node)`.\n// e.g. `nativeTree.firstChild(node)`\n// same as `node.firstChild`\nexport const nativeTree = {};\n\nconst installNativeAccessor = (name) => {\n  nativeTree[name] = (node) => node[NATIVE_PREFIX + name];\n}\n\nconst installNativeMethod = (name, fn) => {\n  if (!nativeMethods[name]) {\n    nativeMethods[name] = fn;\n  }\n}\n\n\nconst defineNativeAccessors = (proto, descriptors) => {\n  patchProperties(proto, descriptors, NATIVE_PREFIX);\n  // make native accessors available to users\n  for (let prop in descriptors) {\n    installNativeAccessor(prop);\n  }\n}\n\nconst copyProperties = (proto, list = []) => {\n  for (let i = 0; i < list.length; i++) {\n    const name = list[i];\n    const descriptor = Object.getOwnPropertyDescriptor(proto, name);\n    if (descriptor) {\n      Object.defineProperty(proto, NATIVE_PREFIX + name, descriptor);\n      // make native methods/accessors available to users\n      if (descriptor.value) {\n        installNativeMethod(name, descriptor.value);\n      } else {\n        installNativeAccessor(name);\n\n      }\n    }\n  }\n}\n\n/** @type {!TreeWalker} */\nconst nodeWalker = document.createTreeWalker(document, NodeFilter.SHOW_ALL,\n  null, false);\n\n/** @type {!TreeWalker} */\nconst elementWalker = document.createTreeWalker(document, NodeFilter.SHOW_ELEMENT,\n  null, false);\n\n/** @type {!Document} */\nconst inertDoc = document.implementation.createHTMLDocument('inert');\n\nconst clearNode = node => {\n  let firstChild;\n  while ((firstChild = node[NATIVE_PREFIX + 'firstChild'])) {\n    node[NATIVE_PREFIX + 'removeChild'](firstChild);\n  }\n}\n\nconst ParentNodeAccessors = [\n  'firstElementChild',\n  'lastElementChild',\n  'children',\n  'childElementCount',\n];\n\nconst ParentNodeMethods = [\n  'querySelector',\n  'querySelectorAll'\n  // 'append', 'prepend'\n];\n\nexport const addNativePrefixedProperties = () => {\n\n  // EventTarget\n  const eventProps = [\n    'dispatchEvent',\n    'addEventListener',\n    'removeEventListener'\n  ];\n  if (window.EventTarget) {\n    copyProperties(window.EventTarget.prototype, eventProps);\n  } else {\n    copyProperties(Node.prototype, eventProps);\n    copyProperties(Window.prototype, eventProps);\n  }\n\n\n  // Node\n  if (hasDescriptors) {\n    copyProperties(Node.prototype, [\n      'parentNode',\n      'firstChild',\n      'lastChild',\n      'previousSibling',\n      'nextSibling',\n      'childNodes',\n      'parentElement',\n      'textContent',\n    ]);\n  } else {\n    defineNativeAccessors(Node.prototype, {\n      parentNode: {\n        /** @this {Node} */\n        get() {\n          nodeWalker.currentNode = this;\n          return nodeWalker.parentNode();\n        }\n      },\n      firstChild: {\n        /** @this {Node} */\n        get() {\n          nodeWalker.currentNode = this;\n          return nodeWalker.firstChild();\n        }\n      },\n      lastChild: {\n        /** @this {Node} */\n        get() {\n          nodeWalker.currentNode = this;\n          return nodeWalker.lastChild();\n        }\n\n      },\n      previousSibling: {\n        /** @this {Node} */\n        get() {\n          nodeWalker.currentNode = this;\n          return nodeWalker.previousSibling();\n        }\n      },\n      nextSibling: {\n        /** @this {Node} */\n        get() {\n          nodeWalker.currentNode = this;\n          return nodeWalker.nextSibling();\n        }\n      },\n      // TODO(sorvell): make this a NodeList or whatever\n      childNodes: {\n        /** @this {Node} */\n        get() {\n          const nodes = [];\n          nodeWalker.currentNode = this;\n          let n = nodeWalker.firstChild();\n          while (n) {\n            nodes.push(n);\n            n = nodeWalker.nextSibling();\n          }\n          return nodes;\n        }\n      },\n      parentElement: {\n        /** @this {Node} */\n        get() {\n          elementWalker.currentNode = this;\n          return elementWalker.parentNode();\n        }\n      },\n      textContent: {\n        /** @this {Node} */\n        get() {\n          /* eslint-disable no-case-declarations */\n          switch (this.nodeType) {\n            case Node.ELEMENT_NODE:\n            case Node.DOCUMENT_FRAGMENT_NODE:\n              // TODO(sorvell): This cannot be a single TreeWalker that's reused\n              // at least for Safari 9, but it's unclear why.\n              const textWalker = document.createTreeWalker(this, NodeFilter.SHOW_TEXT,\n                null, false);\n              let content = '', n;\n              while ( (n = textWalker.nextNode()) ) {\n                // TODO(sorvell): can't use textContent since we patch it on Node.prototype!\n                // However, should probably patch it only on element.\n                content += n.nodeValue;\n              }\n              return content;\n            default:\n              return this.nodeValue;\n          }\n        },\n        // Needed on browsers that do not proper accessors (e.g. old versions of Chrome)\n        /** @this {Node} */\n        set(value) {\n          if (typeof value === 'undefined' || value === null) {\n            value = ''\n          }\n          switch (this.nodeType) {\n            case Node.ELEMENT_NODE:\n            case Node.DOCUMENT_FRAGMENT_NODE:\n              clearNode(this);\n              // Document fragments must have no childnodes if setting a blank string\n              if (value.length > 0 || this.nodeType === Node.ELEMENT_NODE) {\n                // Note: old Chrome versions require 2nd argument here\n                this[NATIVE_PREFIX + 'insertBefore'](document.createTextNode(value), undefined);\n              }\n              break;\n            default:\n              // TODO(sorvell): can't do this if patch nodeValue.\n              this.nodeValue = value;\n              break;\n          }\n        }\n      }\n    });\n  }\n\n  copyProperties(Node.prototype, [\n    'appendChild',\n    'insertBefore',\n    'removeChild',\n    'replaceChild',\n    'cloneNode',\n    'contains'\n  ]);\n\n  const ParentNodeWalkerDescriptors = {\n    firstElementChild: {\n      /** @this {ParentNode} */\n      get() {\n        elementWalker.currentNode = this;\n        return elementWalker.firstChild();\n      }\n    },\n    lastElementChild: {\n      /** @this {ParentNode} */\n      get() {\n        elementWalker.currentNode = this;\n        return elementWalker.lastChild();\n      }\n    },\n    children: {\n      /** @this {ParentNode} */\n      get() {\n        let nodes = [];\n        elementWalker.currentNode = this;\n        let n = elementWalker.firstChild();\n        while (n) {\n          nodes.push(n);\n          n = elementWalker.nextSibling();\n        }\n        return utils.createPolyfilledHTMLCollection(nodes);\n      }\n    },\n    childElementCount: {\n      /** @this {ParentNode} */\n      get() {\n        if (this.children) {\n          return this.children.length;\n        }\n        return 0;\n      }\n    }\n  };\n\n  // Element\n  if (hasDescriptors) {\n    copyProperties(Element.prototype, ParentNodeAccessors);\n\n    copyProperties(Element.prototype, [\n      'previousElementSibling',\n      'nextElementSibling',\n      'innerHTML'\n    ]);\n\n    // NOTE, on IE 11 / Edge 15 children and/or innerHTML are on HTMLElement instead of Element\n    if (Object.getOwnPropertyDescriptor(HTMLElement.prototype, 'children')) {\n      copyProperties(HTMLElement.prototype, [\n        'children'\n      ]);\n    }\n    if (Object.getOwnPropertyDescriptor(HTMLElement.prototype, 'innerHTML')) {\n      copyProperties(HTMLElement.prototype, [\n        'innerHTML'\n      ]);\n    }\n  } else {\n    defineNativeAccessors(Element.prototype, ParentNodeWalkerDescriptors);\n    defineNativeAccessors(Element.prototype, {\n      previousElementSibling: {\n        /** @this {Element} */\n        get() {\n          elementWalker.currentNode = this;\n          return elementWalker.previousSibling();\n        }\n      },\n      nextElementSibling: {\n        /** @this {Element} */\n        get() {\n          elementWalker.currentNode = this;\n          return elementWalker.nextSibling();\n        }\n      },\n      innerHTML: {\n        /** @this {Element} */\n        get() {\n          return getInnerHTML(this, n => n[NATIVE_PREFIX + 'childNodes']);\n        },\n        // Needed on browsers that do not proper accessors (e.g. old versions of Chrome)\n        /** @this {Element} */\n        set(value) {\n          const content = this.localName === 'template' ?\n          /** @type {HTMLTemplateElement} */(this).content : this;\n          clearNode(content);\n          const containerName = this.localName || 'div';\n          let htmlContainer;\n          if (!this.namespaceURI || this.namespaceURI === inertDoc.namespaceURI) {\n            htmlContainer = inertDoc.createElement(containerName);\n          } else {\n            htmlContainer = inertDoc.createElementNS(this.namespaceURI, containerName);\n          }\n          htmlContainer.innerHTML = value;\n          const newContent = this.localName === 'template' ?\n            /** @type {HTMLTemplateElement} */(htmlContainer).content : htmlContainer;\n          let firstChild;\n          while ((firstChild = newContent[NATIVE_PREFIX + 'firstChild'])) {\n            // Note: old Chrome versions require 2nd argument here\n            content[NATIVE_PREFIX + 'insertBefore'](firstChild, undefined);\n          }\n        }\n      }\n    });\n  }\n\n  copyProperties(Element.prototype, [\n    'setAttribute',\n    'getAttribute',\n    'hasAttribute',\n    'removeAttribute',\n    // on older Safari, these are on Element.\n    'focus',\n    'blur',\n  ]);\n  copyProperties(Element.prototype, ParentNodeMethods);\n\n  // HTMLElement\n  copyProperties(HTMLElement.prototype, [\n    'focus',\n    'blur',\n    // On IE these are on HTMLElement\n    'contains'\n  ]);\n\n  if (hasDescriptors) {\n    copyProperties(HTMLElement.prototype, [\n      'parentElement',\n      'children',\n      'innerHTML'\n    ]);\n  }\n\n  // HTMLTemplateElement\n  if (window.HTMLTemplateElement) {\n    copyProperties(window.HTMLTemplateElement.prototype, ['innerHTML']);\n  }\n\n  // DocumentFragment\n  if (hasDescriptors) {\n    // NOTE, IE 11 does not have on DocumentFragment\n    // firstElementChild\n    // lastElementChild\n    copyProperties(DocumentFragment.prototype, ParentNodeAccessors);\n  } else {\n    defineNativeAccessors(DocumentFragment.prototype, ParentNodeWalkerDescriptors);\n  }\n\n  copyProperties(DocumentFragment.prototype, ParentNodeMethods);\n\n  // Document\n  if (hasDescriptors) {\n    copyProperties(Document.prototype, ParentNodeAccessors);\n    copyProperties(Document.prototype, [\n      'activeElement'\n    ]);\n  } else {\n    defineNativeAccessors(Document.prototype, ParentNodeWalkerDescriptors);\n  }\n\n  copyProperties(Document.prototype, [\n    'importNode',\n    'getElementById'\n  ]);\n  copyProperties(Document.prototype, ParentNodeMethods);\n\n};\n","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\nimport * as utils from './utils.js';\nimport {ensureShadyDataForNode} from './shady-data.js';\n\nexport const InsideDescriptors = utils.getOwnPropertyDescriptors({\n\n  /** @this {Node} */\n  get childNodes() {\n    return this[utils.SHADY_PREFIX + 'childNodes'];\n  },\n\n  /** @this {Node} */\n  get firstChild() {\n    return this[utils.SHADY_PREFIX + 'firstChild'];\n  },\n\n  /** @this {Node} */\n  get lastChild() {\n    return this[utils.SHADY_PREFIX + 'lastChild'];\n  },\n\n  /** @this {Node} */\n  get textContent() {\n    return this[utils.SHADY_PREFIX + 'textContent'];\n  },\n\n  /** @this {Node} */\n  set textContent(value) {\n    this[utils.SHADY_PREFIX + 'textContent'] = value;\n  },\n\n  /** @this {Node} */\n  get childElementCount() {\n    return this[utils.SHADY_PREFIX + 'childElementCount'];\n  },\n\n  /** @this {Node} */\n  get children() {\n    return this[utils.SHADY_PREFIX + 'children'];\n  },\n\n  /** @this {Node} */\n  get firstElementChild() {\n    return this[utils.SHADY_PREFIX + 'firstElementChild'];\n  },\n\n  /** @this {Node} */\n  get lastElementChild() {\n    return this[utils.SHADY_PREFIX + 'lastElementChild'];\n  },\n\n  /** @this {Node} */\n  get innerHTML() {\n    return this[utils.SHADY_PREFIX + 'innerHTML'];\n  },\n\n  /** @this {Node} */\n  set innerHTML(value) {\n    return this[utils.SHADY_PREFIX + 'innerHTML'] = value;\n  },\n\n  /** @this {Node} */\n  get shadowRoot() {\n    return this[utils.SHADY_PREFIX + 'shadowRoot'];\n  }\n\n});\n\nexport const OutsideDescriptors = utils.getOwnPropertyDescriptors({\n\n  /** @this {Node} */\n  get parentElement() {\n    return this[utils.SHADY_PREFIX + 'parentElement'];\n  },\n\n  /** @this {Node} */\n  get parentNode() {\n    return this[utils.SHADY_PREFIX + 'parentNode'];\n  },\n\n  /** @this {Node} */\n  get nextSibling() {\n    return this[utils.SHADY_PREFIX + 'nextSibling'];\n  },\n\n  /** @this {Node} */\n  get previousSibling() {\n    return this[utils.SHADY_PREFIX + 'previousSibling'];\n  },\n\n  /** @this {Node} */\n  get nextElementSibling() {\n    return this[utils.SHADY_PREFIX + 'nextElementSibling'];\n  },\n\n  /** @this {Node} */\n  get previousElementSibling() {\n    return this[utils.SHADY_PREFIX + 'previousElementSibling'];\n  },\n\n  /** @this {Node} */\n  get className() {\n    return this[utils.SHADY_PREFIX + 'className'];\n  },\n\n  /** @this {Node} */\n  set className(value) {\n    return this[utils.SHADY_PREFIX + 'className'] = value;\n  }\n\n});\n\nfor (let prop in InsideDescriptors) {\n  InsideDescriptors[prop].enumerable = false;\n}\n\nfor (let prop in OutsideDescriptors) {\n  OutsideDescriptors[prop].enumerable = false;\n}\n\nconst noInstancePatching = utils.settings.hasDescriptors || utils.settings.noPatch;\n\n// ensure an element has patched \"outside\" accessors; no-op when not needed\nexport let patchOutsideElementAccessors = noInstancePatching ?\n  function() {} : function(element) {\n    const sd = ensureShadyDataForNode(element);\n    if (!sd.__outsideAccessors) {\n      sd.__outsideAccessors = true;\n      utils.patchProperties(element, OutsideDescriptors);\n    }\n  }\n\n// ensure an element has patched \"inside\" accessors; no-op when not needed\nexport let patchInsideElementAccessors = noInstancePatching ?\n  function() {} : function(element) {\n    const sd = ensureShadyDataForNode(element);\n    if (!sd.__insideAccessors) {\n      sd.__insideAccessors = true;\n      utils.patchProperties(element, InsideDescriptors);\n    }\n  }","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\nimport * as utils from './utils.js';\nimport {shadyDataForNode} from './shady-data.js';\n\n/*\nMake this name unique so it is unlikely to conflict with properties on objects passed to `addEventListener`\nhttps://github.com/webcomponents/shadydom/issues/173\n*/\nconst /** string */ eventWrappersName = `__eventWrappers${Date.now()}`;\n\n/** @type {?function(!Event): boolean} */\nconst composedGetter = (() => {\n  const composedProp = Object.getOwnPropertyDescriptor(Event.prototype, 'composed');\n  return composedProp ? (ev) => composedProp.get.call(ev) : null;\n})();\n\n// https://github.com/w3c/webcomponents/issues/513#issuecomment-224183937\nconst alwaysComposed = {\n  'blur': true,\n  'focus': true,\n  'focusin': true,\n  'focusout': true,\n  'click': true,\n  'dblclick': true,\n  'mousedown': true,\n  'mouseenter': true,\n  'mouseleave': true,\n  'mousemove': true,\n  'mouseout': true,\n  'mouseover': true,\n  'mouseup': true,\n  'wheel': true,\n  'beforeinput': true,\n  'input': true,\n  'keydown': true,\n  'keyup': true,\n  'compositionstart': true,\n  'compositionupdate': true,\n  'compositionend': true,\n  'touchstart': true,\n  'touchend': true,\n  'touchmove': true,\n  'touchcancel': true,\n  'pointerover': true,\n  'pointerenter': true,\n  'pointerdown': true,\n  'pointermove': true,\n  'pointerup': true,\n  'pointercancel': true,\n  'pointerout': true,\n  'pointerleave': true,\n  'gotpointercapture': true,\n  'lostpointercapture': true,\n  'dragstart': true,\n  'drag': true,\n  'dragenter': true,\n  'dragleave': true,\n  'dragover': true,\n  'drop': true,\n  'dragend': true,\n  'DOMActivate': true,\n  'DOMFocusIn': true,\n  'DOMFocusOut': true,\n  'keypress': true\n};\n\nconst unpatchedEvents = {\n  'DOMAttrModified': true,\n  'DOMAttributeNameChanged': true,\n  'DOMCharacterDataModified': true,\n  'DOMElementNameChanged': true,\n  'DOMNodeInserted': true,\n  'DOMNodeInsertedIntoDocument': true,\n  'DOMNodeRemoved': true,\n  'DOMNodeRemovedFromDocument': true,\n  'DOMSubtreeModified': true\n}\n\n/**\n * Some EventTarget subclasses are not Node subclasses, and you cannot call\n * `getRootNode()` on them.\n *\n * @param {!(Node|EventTarget)} eventTarget\n * @return {!(Node|EventTarget)}\n */\nfunction getRootNodeWithFallback(eventTarget) {\n  if (eventTarget instanceof Node) {\n    return eventTarget[utils.SHADY_PREFIX + 'getRootNode']();\n  } else {\n    return eventTarget;\n  }\n}\n\nfunction pathComposer(startNode, composed) {\n  let composedPath = [];\n  let current = startNode;\n  let startRoot = getRootNodeWithFallback(startNode);\n  while (current) {\n    composedPath.push(current);\n    if (current[utils.SHADY_PREFIX + 'assignedSlot']) {\n      current = current[utils.SHADY_PREFIX + 'assignedSlot'];\n    } else if (current.nodeType === Node.DOCUMENT_FRAGMENT_NODE && current.host && (composed || current !== startRoot)) {\n      current = current.host;\n    } else {\n      current = current[utils.SHADY_PREFIX + 'parentNode'];\n    }\n  }\n  // event composedPath includes window when startNode's ownerRoot is document\n  if (composedPath[composedPath.length - 1] === document) {\n    composedPath.push(window);\n  }\n  return composedPath;\n}\n\nexport const composedPath = (event) => {\n  if (!event.__composedPath) {\n    event.__composedPath = pathComposer(event.target, true);\n  }\n  return event.__composedPath;\n}\n\nfunction retarget(refNode, path) {\n  if (!utils.isShadyRoot) {\n    return refNode;\n  }\n  // If ANCESTOR's root is not a shadow root or ANCESTOR's root is BASE's\n  // shadow-including inclusive ancestor, return ANCESTOR.\n  let refNodePath = pathComposer(refNode, true);\n  let p$ = path;\n  for (let i=0, ancestor, lastRoot, root, rootIdx; i < p$.length; i++) {\n    ancestor = p$[i];\n    root = getRootNodeWithFallback(ancestor);\n    if (root !== lastRoot) {\n      rootIdx = refNodePath.indexOf(root);\n      lastRoot = root;\n    }\n    if (!utils.isShadyRoot(root) || rootIdx > -1) {\n      return ancestor;\n    }\n  }\n}\n\nlet EventPatches = {\n\n  /**\n   * @this {Event}\n   */\n  get composed() {\n    if (this.__composed === undefined) {\n      // if there's an original `composed` getter on the Event prototype, use that\n      if (composedGetter) {\n        // TODO(web-padawan): see https://github.com/webcomponents/shadydom/issues/275\n        this.__composed = this.type === 'focusin' || this.type === 'focusout' || composedGetter(this);\n      // If the event is trusted, or `isTrusted` is not supported, check the list of always composed events\n      } else if (this.isTrusted !== false) {\n        this.__composed = alwaysComposed[this.type];\n      }\n    }\n    return /** @type {!Event} */(this).__composed || false;\n  },\n\n  /**\n   * @this {Event}\n   */\n  composedPath() {\n    if (!this.__composedPath) {\n      this.__composedPath = pathComposer(this['__target'], this.composed);\n    }\n    return /** @type {!Event} */(this).__composedPath;\n  },\n\n  /**\n   * @this {Event}\n   */\n  get target() {\n    return retarget(this.currentTarget || this['__previousCurrentTarget'], this.composedPath());\n  },\n\n  // http://w3c.github.io/webcomponents/spec/shadow/#event-relatedtarget-retargeting\n  /**\n   * @this {Event}\n   */\n  get relatedTarget() {\n    if (!this.__relatedTarget) {\n      return null;\n    }\n    if (!this.__relatedTargetComposedPath) {\n      this.__relatedTargetComposedPath = pathComposer(this.__relatedTarget, true);\n    }\n    // find the deepest node in relatedTarget composed path that is in the same root with the currentTarget\n    return retarget(this.currentTarget || this['__previousCurrentTarget'], /** @type {!Event} */(this).__relatedTargetComposedPath);\n  },\n  /**\n   * @this {Event}\n   */\n  stopPropagation() {\n    Event.prototype.stopPropagation.call(this);\n    this.__propagationStopped = true;\n  },\n  /**\n   * @this {Event}\n   */\n  stopImmediatePropagation() {\n    Event.prototype.stopImmediatePropagation.call(this);\n    this.__immediatePropagationStopped = true;\n    this.__propagationStopped = true;\n  }\n\n};\n\nfunction mixinComposedFlag(Base) {\n  // NOTE: avoiding use of `class` here so that transpiled output does not\n  // try to do `Base.call` with a dom construtor.\n  let klazz = function(type, options) {\n    let event = new Base(type, options);\n    event.__composed = options && Boolean(options['composed']);\n    return event;\n  }\n  // put constructor properties on subclass\n  klazz.__proto__ = Base;\n  klazz.prototype = Base.prototype;\n  return klazz;\n}\n\nlet nonBubblingEventsToRetarget = {\n  'focus': true,\n  'blur': true\n};\n\n\n/**\n * Check if the event has been retargeted by comparing original `target`, and calculated `target`\n * @param {Event} event\n * @return {boolean} True if the original target and calculated target are the same\n */\nfunction hasRetargeted(event) {\n  return event['__target'] !== event.target || event.__relatedTarget !== event.relatedTarget;\n}\n\n/**\n *\n * @param {Event} event\n * @param {Node} node\n * @param {string} phase\n */\nfunction fireHandlers(event, node, phase) {\n  let hs = node.__handlers && node.__handlers[event.type] &&\n    node.__handlers[event.type][phase];\n  if (hs) {\n    for (let i = 0, fn; (fn = hs[i]); i++) {\n      if (hasRetargeted(event) && event.target === event.relatedTarget) {\n        return;\n      }\n      fn.call(node, event);\n      if (event.__immediatePropagationStopped) {\n        return;\n      }\n    }\n  }\n}\n\nfunction retargetNonBubblingEvent(e) {\n  let path = e.composedPath();\n  let node;\n  // override `currentTarget` to let patched `target` calculate correctly\n  Object.defineProperty(e, 'currentTarget', {\n    get: function() {\n      return node;\n    },\n    configurable: true\n  });\n  for (let i = path.length - 1; i >= 0; i--) {\n    node = path[i];\n    // capture phase fires all capture handlers\n    fireHandlers(e, node, 'capture');\n    if (e.__propagationStopped) {\n      return;\n    }\n  }\n\n  // set the event phase to `AT_TARGET` as in spec\n  Object.defineProperty(e, 'eventPhase', {get() { return Event.AT_TARGET }});\n\n  // the event only needs to be fired when owner roots change when iterating the event path\n  // keep track of the last seen owner root\n  let lastFiredRoot;\n  for (let i = 0; i < path.length; i++) {\n    node = path[i];\n    const nodeData = shadyDataForNode(node);\n    const root = nodeData && nodeData.root;\n    if (i === 0 || (root && root === lastFiredRoot)) {\n      fireHandlers(e, node, 'bubble');\n      // don't bother with window, it doesn't have `getRootNode` and will be last in the path anyway\n      if (node !== window) {\n        lastFiredRoot = node[utils.SHADY_PREFIX + 'getRootNode']();\n      }\n      if (e.__propagationStopped) {\n        return;\n      }\n    }\n  }\n}\n\nfunction listenerSettingsEqual(savedListener, node, type, capture, once, passive) {\n  let {\n    node: savedNode,\n    type: savedType,\n    capture: savedCapture,\n    once: savedOnce,\n    passive: savedPassive\n  } = savedListener;\n  return node === savedNode &&\n    type === savedType &&\n    capture === savedCapture &&\n    once === savedOnce &&\n    passive === savedPassive;\n}\n\nexport function findListener(wrappers, node, type, capture, once, passive) {\n  for (let i = 0; i < wrappers.length; i++) {\n    if (listenerSettingsEqual(wrappers[i], node, type, capture, once, passive)) {\n      return i;\n    }\n  }\n  return -1;\n}\n\n/**\n * Firefox can throw on accessing eventWrappers inside of `removeEventListener` during a selenium run\n * Try/Catch accessing eventWrappers to work around\n * https://bugzilla.mozilla.org/show_bug.cgi?id=1353074\n */\nfunction getEventWrappers(eventLike) {\n  let wrappers = null;\n  try {\n    wrappers = eventLike[eventWrappersName];\n  } catch (e) {} // eslint-disable-line no-empty\n  return wrappers;\n}\n\n/**\n * @this {EventTarget}\n */\nexport function addEventListener(type, fnOrObj, optionsOrCapture) {\n  if (!fnOrObj) {\n    return;\n  }\n\n  const handlerType = typeof fnOrObj;\n\n  // bail if `fnOrObj` is not a function, not an object\n  if (handlerType !== 'function' && handlerType !== 'object') {\n    return;\n  }\n\n  // bail if `fnOrObj` is an object without a `handleEvent` method\n  if (handlerType === 'object' && (!fnOrObj.handleEvent || typeof fnOrObj.handleEvent !== 'function')) {\n    return;\n  }\n\n  if (unpatchedEvents[type]) {\n    return this[utils.NATIVE_PREFIX + 'addEventListener'](type, fnOrObj, optionsOrCapture);\n  }\n\n  // The callback `fn` might be used for multiple nodes/events. Since we generate\n  // a wrapper function, we need to keep track of it when we remove the listener.\n  // It's more efficient to store the node/type/options information as Array in\n  // `fn` itself rather than the node (we assume that the same callback is used\n  // for few nodes at most, whereas a node will likely have many event listeners).\n  // NOTE(valdrin) invoking external functions is costly, inline has better perf.\n  let capture, once, passive;\n  if (optionsOrCapture && typeof optionsOrCapture === 'object') {\n    capture = Boolean(optionsOrCapture.capture);\n    once = Boolean(optionsOrCapture.once);\n    passive = Boolean(optionsOrCapture.passive);\n  } else {\n    capture = Boolean(optionsOrCapture);\n    once = false;\n    passive = false;\n  }\n  // hack to let ShadyRoots have event listeners\n  // event listener will be on host, but `currentTarget`\n  // will be set to shadyroot for event listener\n  let target = (optionsOrCapture && optionsOrCapture.__shadyTarget) || this;\n\n  let wrappers = fnOrObj[eventWrappersName];\n  if (wrappers) {\n    // Stop if the wrapper function has already been created.\n    if (findListener(wrappers, target, type, capture, once, passive) > -1) {\n      return;\n    }\n  } else {\n    fnOrObj[eventWrappersName] = [];\n  }\n\n  /**\n   * @this {HTMLElement}\n   * @param {Event} e\n   */\n  const wrapperFn = function(e) {\n    // Support `once` option.\n    if (once) {\n      this[utils.SHADY_PREFIX + 'removeEventListener'](type, fnOrObj, optionsOrCapture);\n    }\n    if (!e['__target']) {\n      patchEvent(e);\n    }\n    let lastCurrentTargetDesc;\n    if (target !== this) {\n      // replace `currentTarget` to make `target` and `relatedTarget` correct for inside the shadowroot\n      lastCurrentTargetDesc = Object.getOwnPropertyDescriptor(e, 'currentTarget');\n      Object.defineProperty(e, 'currentTarget', {get() { return target }, configurable: true});\n    }\n    e['__previousCurrentTarget'] = e['currentTarget'];\n    // Always check if a shadowRoot is in the current event path.\n    // If it is not, the event was generated on either the host of the shadowRoot\n    // or a children of the host.\n    if (utils.isShadyRoot(target) && e.composedPath().indexOf(target) == -1) {\n      return;\n    }\n    // There are two critera that should stop events from firing on this node\n    // 1. the event is not composed and the current node is not in the same root as the target\n    // 2. when bubbling, if after retargeting, relatedTarget and target point to the same node\n    if (e.composed || e.composedPath().indexOf(target) > -1) {\n      if (hasRetargeted(e) && e.target === e.relatedTarget) {\n        if (e.eventPhase === Event.BUBBLING_PHASE) {\n          e.stopImmediatePropagation();\n        }\n        return;\n      }\n      // prevent non-bubbling events from triggering bubbling handlers on shadowroot, but only if not in capture phase\n      if (e.eventPhase !== Event.CAPTURING_PHASE && !e.bubbles && e.target !== target && !(target instanceof Window)) {\n        return;\n      }\n      let ret = handlerType === 'function' ?\n        fnOrObj.call(target, e) :\n        (fnOrObj.handleEvent && fnOrObj.handleEvent(e));\n      if (target !== this) {\n        // replace the \"correct\" `currentTarget`\n        if (lastCurrentTargetDesc) {\n          Object.defineProperty(e, 'currentTarget', lastCurrentTargetDesc);\n          lastCurrentTargetDesc = null;\n        } else {\n          delete e['currentTarget'];\n        }\n      }\n      return ret;\n    }\n  };\n\n  // Store the wrapper information.\n  fnOrObj[eventWrappersName].push({\n    // note: use target here which is either a shadowRoot\n    // (when the host element is proxy'ing the event) or this element\n    node: target,\n    type: type,\n    capture: capture,\n    once: once,\n    passive: passive,\n    wrapperFn: wrapperFn\n  });\n\n  if (nonBubblingEventsToRetarget[type]) {\n    this.__handlers = this.__handlers || {};\n    this.__handlers[type] = this.__handlers[type] ||\n      {'capture': [], 'bubble': []};\n    this.__handlers[type][capture ? 'capture' : 'bubble'].push(wrapperFn);\n  } else {\n    this[utils.NATIVE_PREFIX + 'addEventListener'](type, wrapperFn, optionsOrCapture);\n  }\n}\n\n/**\n * @this {EventTarget}\n */\nexport function removeEventListener(type, fnOrObj, optionsOrCapture) {\n  if (!fnOrObj) {\n    return;\n  }\n  if (unpatchedEvents[type]) {\n    return this[utils.NATIVE_PREFIX + 'removeEventListener'](type, fnOrObj, optionsOrCapture);\n  }\n  // NOTE(valdrin) invoking external functions is costly, inline has better perf.\n  let capture, once, passive;\n  if (optionsOrCapture && typeof optionsOrCapture === 'object') {\n    capture = Boolean(optionsOrCapture.capture);\n    once = Boolean(optionsOrCapture.once);\n    passive = Boolean(optionsOrCapture.passive);\n  } else {\n    capture = Boolean(optionsOrCapture);\n    once = false;\n    passive = false;\n  }\n  let target = (optionsOrCapture && optionsOrCapture.__shadyTarget) || this;\n  // Search the wrapped function.\n  let wrapperFn = undefined;\n  let wrappers = getEventWrappers(fnOrObj);\n  if (wrappers) {\n    let idx = findListener(wrappers, target, type, capture, once, passive);\n    if (idx > -1) {\n      wrapperFn = wrappers.splice(idx, 1)[0].wrapperFn;\n      // Cleanup.\n      if (!wrappers.length) {\n        fnOrObj[eventWrappersName] = undefined;\n      }\n    }\n  }\n  this[utils.NATIVE_PREFIX + 'removeEventListener'](type, wrapperFn || fnOrObj, optionsOrCapture);\n  if (wrapperFn && nonBubblingEventsToRetarget[type] &&\n      this.__handlers && this.__handlers[type]) {\n    const arr = this.__handlers[type][capture ? 'capture' : 'bubble'];\n    const idx = arr.indexOf(wrapperFn);\n    if (idx > -1) {\n      arr.splice(idx, 1);\n    }\n  }\n}\n\nfunction activateFocusEventOverrides() {\n  for (let ev in nonBubblingEventsToRetarget) {\n    window[utils.NATIVE_PREFIX + 'addEventListener'](ev, function(e) {\n      if (!e['__target']) {\n        patchEvent(e);\n        retargetNonBubblingEvent(e);\n      }\n    }, true);\n  }\n}\n\nconst EventPatchesDescriptors = utils.getOwnPropertyDescriptors(EventPatches);\n\nconst SHADY_PROTO = '__shady_patchedProto';\nconst SHADY_SOURCE_PROTO = '__shady_sourceProto';\n\nfunction patchEvent(event) {\n  event['__target'] = event.target;\n  event.__relatedTarget = event.relatedTarget;\n  // attempt to patch prototype (via cache)\n  if (utils.settings.hasDescriptors) {\n    const proto = Object.getPrototypeOf(event);\n    if (!Object.hasOwnProperty(proto, SHADY_PROTO)) {\n      const patchedProto = Object.create(proto);\n      patchedProto[SHADY_SOURCE_PROTO] = proto;\n      utils.patchProperties(patchedProto, EventPatchesDescriptors);\n      proto[SHADY_PROTO] = patchedProto;\n    }\n    event.__proto__ = proto[SHADY_PROTO];\n  // and fallback to patching instance\n  } else {\n    utils.patchProperties(event, EventPatchesDescriptors);\n  }\n}\n\nlet PatchedEvent = mixinComposedFlag(Event);\nlet PatchedCustomEvent = mixinComposedFlag(CustomEvent);\nlet PatchedMouseEvent = mixinComposedFlag(MouseEvent);\n\n\nexport function patchEvents() {\n  activateFocusEventOverrides();\n  window.Event = PatchedEvent;\n  window.CustomEvent = PatchedCustomEvent;\n  window.MouseEvent = PatchedMouseEvent;\n}\n\nexport function patchClick() {\n  // Fix up `Element.prototype.click()` if `isTrusted` is supported, but `composed` isn't\n  if (!composedGetter && Object.getOwnPropertyDescriptor(Event.prototype, 'isTrusted')) {\n    /** @this {Element} */\n    const composedClickFn = function() {\n      const ev = new MouseEvent('click', {\n        bubbles: true,\n        cancelable: true,\n        composed: true\n      });\n      this[utils.SHADY_PREFIX + 'dispatchEvent'](ev);\n    };\n    if (Element.prototype.click) {\n      Element.prototype.click = composedClickFn;\n    } else if (HTMLElement.prototype.click) {\n      HTMLElement.prototype.click = composedClickFn;\n    }\n  }\n}\n\nexport const eventPropertyNames = Object.getOwnPropertyNames(Document.prototype)\n    .filter(name => name.substring(0,2) === 'on');\n","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\nfunction newSplice(index, removed, addedCount) {\n  return {\n    index: index,\n    removed: removed,\n    addedCount: addedCount\n  };\n}\n\nconst EDIT_LEAVE = 0;\nconst EDIT_UPDATE = 1;\nconst EDIT_ADD = 2;\nconst EDIT_DELETE = 3;\n\n// Note: This function is *based* on the computation of the Levenshtein\n// \"edit\" distance. The one change is that \"updates\" are treated as two\n// edits - not one. With Array splices, an update is really a delete\n// followed by an add. By retaining this, we optimize for \"keeping\" the\n// maximum array items in the original array. For example:\n//\n//   'xxxx123' -> '123yyyy'\n//\n// With 1-edit updates, the shortest path would be just to update all seven\n// characters. With 2-edit updates, we delete 4, leave 3, and add 4. This\n// leaves the substring '123' intact.\nfunction calcEditDistances(current, currentStart, currentEnd,\n                            old, oldStart, oldEnd) {\n  // \"Deletion\" columns\n  let rowCount = oldEnd - oldStart + 1;\n  let columnCount = currentEnd - currentStart + 1;\n  let distances = new Array(rowCount);\n\n  // \"Addition\" rows. Initialize null column.\n  for (let i = 0; i < rowCount; i++) {\n    distances[i] = new Array(columnCount);\n    distances[i][0] = i;\n  }\n\n  // Initialize null row\n  for (let j = 0; j < columnCount; j++)\n    distances[0][j] = j;\n\n  for (let i = 1; i < rowCount; i++) {\n    for (let j = 1; j < columnCount; j++) {\n      if (equals(current[currentStart + j - 1], old[oldStart + i - 1]))\n        distances[i][j] = distances[i - 1][j - 1];\n      else {\n        let north = distances[i - 1][j] + 1;\n        let west = distances[i][j - 1] + 1;\n        distances[i][j] = north < west ? north : west;\n      }\n    }\n  }\n\n  return distances;\n}\n\n// This starts at the final weight, and walks \"backward\" by finding\n// the minimum previous weight recursively until the origin of the weight\n// matrix.\nfunction spliceOperationsFromEditDistances(distances) {\n  let i = distances.length - 1;\n  let j = distances[0].length - 1;\n  let current = distances[i][j];\n  let edits = [];\n  while (i > 0 || j > 0) {\n    if (i == 0) {\n      edits.push(EDIT_ADD);\n      j--;\n      continue;\n    }\n    if (j == 0) {\n      edits.push(EDIT_DELETE);\n      i--;\n      continue;\n    }\n    let northWest = distances[i - 1][j - 1];\n    let west = distances[i - 1][j];\n    let north = distances[i][j - 1];\n\n    let min;\n    if (west < north)\n      min = west < northWest ? west : northWest;\n    else\n      min = north < northWest ? north : northWest;\n\n    if (min == northWest) {\n      if (northWest == current) {\n        edits.push(EDIT_LEAVE);\n      } else {\n        edits.push(EDIT_UPDATE);\n        current = northWest;\n      }\n      i--;\n      j--;\n    } else if (min == west) {\n      edits.push(EDIT_DELETE);\n      i--;\n      current = west;\n    } else {\n      edits.push(EDIT_ADD);\n      j--;\n      current = north;\n    }\n  }\n\n  edits.reverse();\n  return edits;\n}\n\n/**\n * Splice Projection functions:\n *\n * A splice map is a representation of how a previous array of items\n * was transformed into a new array of items. Conceptually it is a list of\n * tuples of\n *\n *   <index, removed, addedCount>\n *\n * which are kept in ascending index order of. The tuple represents that at\n * the |index|, |removed| sequence of items were removed, and counting forward\n * from |index|, |addedCount| items were added.\n */\n\n/**\n * Lacking individual splice mutation information, the minimal set of\n * splices can be synthesized given the previous state and final state of an\n * array. The basic approach is to calculate the edit distance matrix and\n * choose the shortest path through it.\n *\n * Complexity: O(l * p)\n *   l: The length of the current array\n *   p: The length of the old array\n */\nfunction calcSplices(current, currentStart, currentEnd,\n                      old, oldStart, oldEnd) {\n  let prefixCount = 0;\n  let suffixCount = 0;\n  let splice;\n\n  let minLength = Math.min(currentEnd - currentStart, oldEnd - oldStart);\n  if (currentStart == 0 && oldStart == 0)\n    prefixCount = sharedPrefix(current, old, minLength);\n\n  if (currentEnd == current.length && oldEnd == old.length)\n    suffixCount = sharedSuffix(current, old, minLength - prefixCount);\n\n  currentStart += prefixCount;\n  oldStart += prefixCount;\n  currentEnd -= suffixCount;\n  oldEnd -= suffixCount;\n\n  if (currentEnd - currentStart == 0 && oldEnd - oldStart == 0)\n    return [];\n\n  if (currentStart == currentEnd) {\n    splice = newSplice(currentStart, [], 0);\n    while (oldStart < oldEnd)\n      splice.removed.push(old[oldStart++]);\n\n    return [ splice ];\n  } else if (oldStart == oldEnd)\n    return [ newSplice(currentStart, [], currentEnd - currentStart) ];\n\n  let ops = spliceOperationsFromEditDistances(\n      calcEditDistances(current, currentStart, currentEnd,\n                             old, oldStart, oldEnd));\n\n  splice = undefined;\n  let splices = [];\n  let index = currentStart;\n  let oldIndex = oldStart;\n  for (let i = 0; i < ops.length; i++) {\n    switch(ops[i]) {\n      case EDIT_LEAVE:\n        if (splice) {\n          splices.push(splice);\n          splice = undefined;\n        }\n\n        index++;\n        oldIndex++;\n        break;\n      case EDIT_UPDATE:\n        if (!splice)\n          splice = newSplice(index, [], 0);\n\n        splice.addedCount++;\n        index++;\n\n        splice.removed.push(old[oldIndex]);\n        oldIndex++;\n        break;\n      case EDIT_ADD:\n        if (!splice)\n          splice = newSplice(index, [], 0);\n\n        splice.addedCount++;\n        index++;\n        break;\n      case EDIT_DELETE:\n        if (!splice)\n          splice = newSplice(index, [], 0);\n\n        splice.removed.push(old[oldIndex]);\n        oldIndex++;\n        break;\n    }\n  }\n\n  if (splice) {\n    splices.push(splice);\n  }\n  return splices;\n}\n\nfunction sharedPrefix(current, old, searchLength) {\n  for (let i = 0; i < searchLength; i++)\n    if (!equals(current[i], old[i]))\n      return i;\n  return searchLength;\n}\n\nfunction sharedSuffix(current, old, searchLength) {\n  let index1 = current.length;\n  let index2 = old.length;\n  let count = 0;\n  while (count < searchLength && equals(current[--index1], old[--index2]))\n    count++;\n\n  return count;\n}\n\nfunction equals(currentValue, previousValue) {\n  return currentValue === previousValue;\n}\n\nexport function calculateSplices(current, previous) {\n  return calcSplices(current, 0, current.length, previous, 0,\n                          previous.length);\n}\n\n","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\nimport * as utils from './utils.js';\nimport {shadyDataForNode, ensureShadyDataForNode} from './shady-data.js';\nimport {patchInsideElementAccessors, patchOutsideElementAccessors} from './patch-instances.js';\n\nfunction linkNode(node, container, ref_node) {\n  patchOutsideElementAccessors(node);\n  ref_node = ref_node || null;\n  const nodeData = ensureShadyDataForNode(node);\n  const containerData = ensureShadyDataForNode(container);\n  const ref_nodeData = ref_node ? ensureShadyDataForNode(ref_node) : null;\n  // update ref_node.previousSibling <-> node\n  nodeData.previousSibling = ref_node ? ref_nodeData.previousSibling :\n    container[utils.SHADY_PREFIX + 'lastChild'];\n  let psd = shadyDataForNode(nodeData.previousSibling);\n  if (psd) {\n    psd.nextSibling = node;\n  }\n  // update node <-> ref_node\n  let nsd = shadyDataForNode(nodeData.nextSibling = ref_node);\n  if (nsd) {\n    nsd.previousSibling = node;\n  }\n  // update node <-> container\n  nodeData.parentNode = container;\n  if (ref_node) {\n    if (ref_node === containerData.firstChild) {\n      containerData.firstChild = node;\n    }\n  } else {\n    containerData.lastChild = node;\n    if (!containerData.firstChild) {\n      containerData.firstChild = node;\n    }\n  }\n  // remove caching of childNodes\n  containerData.childNodes = null;\n}\n\nexport const recordInsertBefore = (node, container, ref_node) => {\n  patchInsideElementAccessors(container);\n  const containerData = ensureShadyDataForNode(container);\n  if (containerData.firstChild !== undefined) {\n    containerData.childNodes = null;\n  }\n  // handle document fragments\n  if (node.nodeType === Node.DOCUMENT_FRAGMENT_NODE) {\n    let c$ = node[utils.SHADY_PREFIX + 'childNodes'];\n    for (let i=0; i < c$.length; i++) {\n      linkNode(c$[i], container, ref_node);\n    }\n    // cleanup logical dom in doc fragment.\n    const nodeData = ensureShadyDataForNode(node);\n    let resetTo = (nodeData.firstChild !== undefined) ? null : undefined;\n    nodeData.firstChild = nodeData.lastChild = resetTo;\n    nodeData.childNodes = resetTo;\n  } else {\n    linkNode(node, container, ref_node);\n  }\n}\n\nexport const recordRemoveChild = (node, container) => {\n  const nodeData = ensureShadyDataForNode(node);\n  const containerData = ensureShadyDataForNode(container);\n  if (node === containerData.firstChild) {\n    containerData.firstChild = nodeData.nextSibling;\n  }\n  if (node === containerData.lastChild) {\n    containerData.lastChild = nodeData.previousSibling;\n  }\n  let p = nodeData.previousSibling;\n  let n = nodeData.nextSibling;\n  if (p) {\n    ensureShadyDataForNode(p).nextSibling = n;\n  }\n  if (n) {\n    ensureShadyDataForNode(n).previousSibling = p;\n  }\n  // When an element is removed, logical data is no longer tracked.\n  // Explicitly set `undefined` here to indicate this. This is disginguished\n  // from `null` which is set if info is null.\n  nodeData.parentNode = nodeData.previousSibling =\n  nodeData.nextSibling = undefined;\n  if (containerData.childNodes !== undefined) {\n    // remove caching of childNodes\n    containerData.childNodes = null;\n  }\n}\n\n/**\n * @param  {!Node} node\n */\nexport const recordChildNodes = (node) => {\n  const nodeData = ensureShadyDataForNode(node);\n  if (nodeData.firstChild === undefined) {\n    // remove caching of childNodes\n    nodeData.childNodes = null;\n    const first = nodeData.firstChild = node[utils.NATIVE_PREFIX + 'firstChild'] || null;\n    nodeData.lastChild = node[utils.NATIVE_PREFIX + 'lastChild'] || null;\n    patchInsideElementAccessors(node);\n    for (let n = first, previous; n; (n = n[utils.NATIVE_PREFIX + 'nextSibling'])) {\n      const sd = ensureShadyDataForNode(n);\n      sd.parentNode = node;\n      sd.nextSibling = n[utils.NATIVE_PREFIX + 'nextSibling'] || null;\n      sd.previousSibling = previous || null;\n      previous = n;\n      patchOutsideElementAccessors(n);\n    }\n  }\n}\n","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\nimport * as utils from './utils.js';\n\nlet scopingShim = null;\n\nexport function getScopingShim() {\n  if (!scopingShim) {\n    scopingShim = window['ShadyCSS'] && window['ShadyCSS']['ScopingShim'];\n  }\n  return scopingShim || null;\n}\n\n/**\n * @param {!Node} node\n * @param {string} attr\n * @param {string} value\n */\nexport function scopeClassAttribute(node, attr, value) {\n  const scopingShim = getScopingShim();\n  if (scopingShim && attr === 'class') {\n    scopingShim['setElementClass'](node, value);\n    return true;\n  }\n  return false;\n}\n\n/**\n * @param {!Node} node\n * @param {string} newScopeName\n */\nexport function addShadyScoping(node, newScopeName) {\n  const scopingShim = getScopingShim();\n  if (!scopingShim) {\n    return;\n  }\n  scopingShim['scopeNode'](node, newScopeName);\n}\n\n/**\n * @param {!Node} node\n * @param {string} currentScopeName\n */\nexport function removeShadyScoping(node, currentScopeName) {\n  const scopingShim = getScopingShim();\n  if (!scopingShim) {\n    return;\n  }\n  scopingShim['unscopeNode'](node, currentScopeName);\n}\n\n/**\n * @param {!Node} node\n * @param {string} newScopeName\n * @param {string} oldScopeName\n */\nexport function replaceShadyScoping(node, newScopeName, oldScopeName) {\n  const scopingShim = getScopingShim();\n  if (!scopingShim) {\n    return;\n  }\n  if (oldScopeName) {\n    removeShadyScoping(node, oldScopeName);\n  }\n  addShadyScoping(node, newScopeName);\n}\n\n/**\n * @param {!Node} node\n * @param {string} newScopeName\n * @return {boolean}\n */\nexport function currentScopeIsCorrect(node, newScopeName) {\n  const scopingShim = getScopingShim();\n  if (!scopingShim) {\n    return true;\n  }\n  if (node.nodeType === Node.DOCUMENT_FRAGMENT_NODE) {\n    // NOTE: as an optimization, only check that all the top-level children\n    // have the correct scope.\n    let correctScope = true;\n    const childNodes = node[utils.SHADY_PREFIX + 'childNodes'];\n    for (let idx = 0; correctScope && (idx < childNodes.length); idx++) {\n      correctScope = correctScope &&\n        currentScopeIsCorrect(childNodes[idx], newScopeName);\n    }\n    return correctScope;\n  }\n  if (node.nodeType !== Node.ELEMENT_NODE) {\n    return true;\n  }\n  const currentScope = scopingShim['currentScopeForNode'](node);\n  return currentScope === newScopeName;\n}\n\n/**\n * @param {!Node} node\n * @return {string}\n */\nexport function currentScopeForNode(node) {\n  if (node.nodeType !== Node.ELEMENT_NODE) {\n    return '';\n  }\n  const scopingShim = getScopingShim();\n  if (!scopingShim) {\n    return '';\n  }\n  return scopingShim['currentScopeForNode'](node);\n}\n\n/**\n * Walk over a node's tree and apply visitorFn to each element node\n *\n * @param {Node} node\n * @param {function(!Node):void} visitorFn\n */\nexport function treeVisitor(node, visitorFn) {\n  if (!node) {\n    return;\n  }\n  // this check is necessary if `node` is a Document Fragment\n  if (node.nodeType === Node.ELEMENT_NODE) {\n    visitorFn(node);\n  }\n  const childNodes = node[utils.SHADY_PREFIX + 'childNodes'];\n  for (let idx = 0, n; idx < childNodes.length; idx++) {\n    n = childNodes[idx];\n    if (n.nodeType === Node.ELEMENT_NODE) {\n      treeVisitor(n, visitorFn);\n    }\n  }\n}","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\nimport * as utils from '../utils.js';\nimport {getScopingShim, removeShadyScoping, replaceShadyScoping,\n  treeVisitor, currentScopeForNode, currentScopeIsCorrect } from '../style-scoping.js';\nimport {shadyDataForNode, ensureShadyDataForNode} from '../shady-data.js';\nimport {recordInsertBefore, recordRemoveChild} from '../link-nodes.js';\nimport {ownerShadyRootForNode} from '../attach-shadow.js';\n\nconst doc = window.document;\n\nconst preferPerformance = utils.settings.preferPerformance;\n\nconst nativeIsConnectedAccessors =\n/** @type {ObjectPropertyDescriptor} */(\n  Object.getOwnPropertyDescriptor(Node.prototype, 'isConnected')\n);\n\nconst nativeIsConnected = nativeIsConnectedAccessors && nativeIsConnectedAccessors.get;\n\nexport function clearNode(node) {\n  let firstChild;\n  while ((firstChild = node[utils.SHADY_PREFIX + 'firstChild'])) {\n    node[utils.SHADY_PREFIX + 'removeChild'](firstChild);\n  }\n}\n\nfunction removeOwnerShadyRoot(node) {\n  // optimization: only reset the tree if node is actually in a root\n  if (hasCachedOwnerRoot(node)) {\n    let c$ = node[utils.SHADY_PREFIX + 'childNodes'];\n    for (let i=0, l=c$.length, n; (i<l) && (n=c$[i]); i++) {\n      removeOwnerShadyRoot(n);\n    }\n  }\n  const nodeData = shadyDataForNode(node);\n  if (nodeData) {\n    nodeData.ownerShadyRoot = undefined;\n  }\n}\n\nfunction hasCachedOwnerRoot(node) {\n  const nodeData = shadyDataForNode(node);\n  return Boolean(nodeData && nodeData.ownerShadyRoot !== undefined);\n}\n\n/**\n * Finds the first flattened node that is composed in the node's parent.\n * If the given node is a slot, then the first flattened node is returned\n * if it exists, otherwise advance to the node's nextSibling.\n * @param {Node} node within which to find first composed node\n * @returns {Node} first composed node\n */\nfunction firstComposedNode(node) {\n  let composed = node;\n  if (node && node.localName === 'slot') {\n    const nodeData = shadyDataForNode(node);\n    const flattened = nodeData && nodeData.flattenedNodes;\n    composed = flattened && flattened.length ? flattened[0] :\n      firstComposedNode(node[utils.SHADY_PREFIX + 'nextSibling']);\n  }\n  return composed;\n}\n\n/**\n * @param {Node} node\n * @param {Node=} addedNode\n * @param {Node=} removedNode\n */\nfunction scheduleObserver(node, addedNode, removedNode) {\n  const nodeData = shadyDataForNode(node);\n  const observer = nodeData && nodeData.observer;\n  if (observer) {\n    if (addedNode) {\n      observer.addedNodes.push(addedNode);\n    }\n    if (removedNode) {\n      observer.removedNodes.push(removedNode);\n    }\n    observer.schedule();\n  }\n}\n\nexport const NodePatches = utils.getOwnPropertyDescriptors({\n\n  /** @this {Node} */\n  get parentNode() {\n    const nodeData = shadyDataForNode(this);\n    const l = nodeData && nodeData.parentNode;\n    return l !== undefined ? l : this[utils.NATIVE_PREFIX + 'parentNode'];\n  },\n\n  /** @this {Node} */\n  get firstChild() {\n    const nodeData = shadyDataForNode(this);\n    const l = nodeData && nodeData.firstChild;\n    return l !== undefined ? l : this[utils.NATIVE_PREFIX + 'firstChild'];\n  },\n\n  /** @this {Node} */\n  get lastChild() {\n    const nodeData = shadyDataForNode(this);\n    const l = nodeData && nodeData.lastChild;\n    return l !== undefined ? l : this[utils.NATIVE_PREFIX + 'lastChild'];\n  },\n\n  /** @this {Node} */\n  get nextSibling() {\n    const nodeData = shadyDataForNode(this);\n    const l = nodeData && nodeData.nextSibling;\n    return l !== undefined ? l : this[utils.NATIVE_PREFIX + 'nextSibling'];\n  },\n\n  /** @this {Node} */\n  get previousSibling() {\n    const nodeData = shadyDataForNode(this);\n    const l = nodeData && nodeData.previousSibling;\n    return l !== undefined ? l : this[utils.NATIVE_PREFIX + 'previousSibling'];\n  },\n\n  /** @this {Node} */\n  get childNodes() {\n    let childNodes;\n    if (utils.isTrackingLogicalChildNodes(this)) {\n      const nodeData = shadyDataForNode(this);\n      if (!nodeData.childNodes) {\n        nodeData.childNodes = [];\n        for (let n=this[utils.SHADY_PREFIX + 'firstChild']; n; n=n[utils.SHADY_PREFIX + 'nextSibling']) {\n          nodeData.childNodes.push(n);\n        }\n      }\n      childNodes = nodeData.childNodes;\n    } else {\n      childNodes = this[utils.NATIVE_PREFIX + 'childNodes'];\n    }\n    childNodes.item = function(index) {\n      return childNodes[index];\n    }\n    return childNodes;\n  },\n\n  /** @this {Node} */\n  get parentElement() {\n    const nodeData = shadyDataForNode(this);\n    let l = nodeData && nodeData.parentNode;\n    if (l && l.nodeType !== Node.ELEMENT_NODE) {\n      l = null;\n    }\n    return l !== undefined ? l : this[utils.NATIVE_PREFIX + 'parentElement'];\n  },\n\n  /** @this {Node} */\n  get isConnected() {\n    if (nativeIsConnected && nativeIsConnected.call(this)) {\n      return true;\n    }\n    if (this.nodeType == Node.DOCUMENT_FRAGMENT_NODE) {\n      return false;\n    }\n    // Fast path for distributed nodes.\n    const ownerDocument = this.ownerDocument;\n    if (utils.hasDocumentContains) {\n      if (ownerDocument[utils.NATIVE_PREFIX + 'contains'](this)) {\n        return true;\n      }\n    } else if (ownerDocument.documentElement &&\n      ownerDocument.documentElement[utils.NATIVE_PREFIX + 'contains'](this)) {\n      return true;\n    }\n    // Slow path for non-distributed nodes.\n    let node = this;\n    while (node && !(node instanceof Document)) {\n      node = node[utils.SHADY_PREFIX + 'parentNode'] || (utils.isShadyRoot(node) ? /** @type {ShadowRoot} */(node).host : undefined);\n    }\n    return !!(node && node instanceof Document);\n  },\n\n  /** @this {Node} */\n  get textContent() {\n    if (utils.isTrackingLogicalChildNodes(this)) {\n      let tc = [];\n      for (let i = 0, cn = this[utils.SHADY_PREFIX + 'childNodes'], c; (c = cn[i]); i++) {\n        if (c.nodeType !== Node.COMMENT_NODE) {\n          tc.push(c[utils.SHADY_PREFIX + 'textContent']);\n        }\n      }\n      return tc.join('');\n    } else {\n      return this[utils.NATIVE_PREFIX + 'textContent'];\n    }\n  },\n\n  /**\n   * @this {Node}\n   * @param {string} value\n   */\n  set textContent(value) {\n    if (typeof value === 'undefined' || value === null) {\n      value = ''\n    }\n    switch (this.nodeType) {\n      case Node.ELEMENT_NODE:\n      case Node.DOCUMENT_FRAGMENT_NODE:\n        if (!utils.isTrackingLogicalChildNodes(this) && utils.settings.hasDescriptors) {\n          // may be removing a nested slot but fast path if we know we are not.\n          const firstChild = this[utils.SHADY_PREFIX + 'firstChild'];\n          if (firstChild != this[utils.SHADY_PREFIX + 'lastChild'] ||\n            (firstChild && firstChild.nodeType != Node.TEXT_NODE)) {\n            clearNode(this);\n          }\n          this[utils.NATIVE_PREFIX + 'textContent'] = value;\n        } else {\n          clearNode(this);\n          // Document fragments must have no childNodes if setting a blank string\n          if (value.length > 0 || this.nodeType === Node.ELEMENT_NODE) {\n            this[utils.SHADY_PREFIX + 'insertBefore'](document.createTextNode(value))\n          }\n        }\n        break;\n      default:\n        // Note, be wary of patching `nodeValue`.\n        this.nodeValue = value;\n        break;\n    }\n  },\n\n  // Patched `insertBefore`. Note that all mutations that add nodes are routed\n  // here. When a <slot> is added or a node is added to a host with a shadowRoot\n  // with a slot, a standard dom `insert` call is aborted and `_asyncRender`\n  // is called on the relevant shadowRoot. In all other cases, a standard dom\n  // `insert` can be made, but the location and ref_node may need to be changed.\n  /**\n   * @this {Node}\n   * @param {Node} node\n   * @param {Node=} ref_node\n   */\n  insertBefore(node, ref_node) {\n    // optimization: assume native insertBefore is ok if the nodes are not in the document.\n    if (this.ownerDocument !== doc && node.ownerDocument !== doc) {\n      this[utils.NATIVE_PREFIX + 'insertBefore'](node, ref_node);\n      return node;\n    }\n    if (node === this) {\n      throw Error(`Failed to execute 'appendChild' on 'Node': The new child element contains the parent.`);\n    }\n    if (ref_node) {\n      const refData = shadyDataForNode(ref_node);\n      const p = refData && refData.parentNode;\n      if ((p !== undefined && p !== this) ||\n        (p === undefined && ref_node[utils.NATIVE_PREFIX + 'parentNode'] !== this)) {\n        throw Error(`Failed to execute 'insertBefore' on 'Node': The node ` +\n        `before which the new node is to be inserted is not a child of this node.`);\n      }\n    }\n    if (ref_node === node) {\n      return node;\n    }\n    /** @type {!Array<!HTMLSlotElement>} */\n    const slotsAdded = [];\n    const ownerRoot = ownerShadyRootForNode(this);\n    /** @type {string} */\n    const newScopeName = ownerRoot ? ownerRoot.host.localName : currentScopeForNode(this);\n    /** @type {string} */\n    let oldScopeName;\n    // remove from existing location\n    const parentNode = node[utils.SHADY_PREFIX + 'parentNode'];\n    if (parentNode) {\n      oldScopeName = currentScopeForNode(node);\n      parentNode[utils.SHADY_PREFIX + 'removeChild'](node,\n        Boolean(ownerRoot) || !ownerShadyRootForNode(node));\n    }\n    // add to new parent\n    let allowNativeInsert = true;\n    const needsScoping = (!preferPerformance || node['__noInsertionPoint'] === undefined) &&\n        !currentScopeIsCorrect(node, newScopeName);\n    const needsSlotFinding = ownerRoot && !node['__noInsertionPoint'] &&\n        (!preferPerformance || node.nodeType === Node.DOCUMENT_FRAGMENT_NODE);\n    if (needsSlotFinding || needsScoping) {\n      // NOTE: avoid node.removeChild as this *can* trigger another patched\n      // method (e.g. custom elements) and we want only the shady method to run.\n      // The following table describes what style scoping actions should happen as a result of this insertion.\n      // document -> shadowRoot: replace\n      // shadowRoot -> shadowRoot: replace\n      // shadowRoot -> shadowRoot of same type: do nothing\n      // shadowRoot -> document: allow unscoping\n      // document -> document: do nothing\n      // The \"same type of shadowRoot\" and \"document to document cases rely on `currentScopeIsCorrect` returning true\n      if (needsScoping) {\n        // in a document or disconnected tree, replace scoping if necessary\n        oldScopeName = oldScopeName || currentScopeForNode(node);\n      }\n      treeVisitor(node, (node) => {\n        if (needsSlotFinding && node.localName === 'slot') {\n          slotsAdded.push(/** @type {!HTMLSlotElement} */(node));\n        }\n        if (needsScoping) {\n          replaceShadyScoping(node, newScopeName, oldScopeName);\n        }\n      });\n    }\n    // if a slot is added, must render containing root.\n    if (this.localName === 'slot' || slotsAdded.length) {\n      if (slotsAdded.length) {\n        ownerRoot._addSlots(slotsAdded);\n      }\n      if (ownerRoot) {\n        ownerRoot._asyncRender();\n      }\n    }\n    if (utils.isTrackingLogicalChildNodes(this)) {\n      recordInsertBefore(node, this, ref_node);\n      // when inserting into a host with a shadowRoot with slot, use\n      // `shadowRoot._asyncRender()` via `attach-shadow` module\n      const parentData = shadyDataForNode(this);\n      if (utils.hasShadowRootWithSlot(this)) {\n        parentData.root._asyncRender();\n        allowNativeInsert = false;\n      // when inserting into a host with shadowRoot with NO slot, do nothing\n      // as the node should not be added to composed dome anywhere.\n      } else if (parentData.root) {\n        allowNativeInsert = false;\n      }\n    }\n    if (allowNativeInsert) {\n      // if adding to a shadyRoot, add to host instead\n      let container = utils.isShadyRoot(this) ?\n        /** @type {ShadowRoot} */(this).host : this;\n      // if ref_node, get the ref_node that's actually in composed dom.\n      if (ref_node) {\n        ref_node = firstComposedNode(ref_node);\n        container[utils.NATIVE_PREFIX + 'insertBefore'](node, ref_node);\n      } else {\n        container[utils.NATIVE_PREFIX + 'appendChild'](node);\n      }\n    // Since ownerDocument is not patched, it can be incorrect after this call\n    // if the node is physically appended via distribution. This can result\n    // in the custom elements polyfill not upgrading the node if it's in an inert doc.\n    // We correct this by calling `adoptNode`.\n    } else if (node.ownerDocument !== this.ownerDocument) {\n      this.ownerDocument.adoptNode(node);\n    }\n    scheduleObserver(this, node);\n    return node;\n  },\n\n  /**\n   * @this {Node}\n   * @param {Node} node\n   */\n  appendChild(node) {\n    return this[utils.SHADY_PREFIX + 'insertBefore'](node);\n  },\n\n  /**\n   * Patched `removeChild`. Note that all dom \"removals\" are routed here.\n   * Removes the given `node` from the element's `children`.\n   * This method also performs dom composition.\n   * @this {Node}\n   * @param {Node} node\n   * @param {boolean=} skipUnscoping\n   */\n  removeChild(node, skipUnscoping = false) {\n    if (this.ownerDocument !== doc) {\n      return this[utils.NATIVE_PREFIX + 'removeChild'](node);\n    }\n    if (node[utils.SHADY_PREFIX + 'parentNode'] !== this) {\n      throw Error('The node to be removed is not a child of this node: ' +\n        node);\n    }\n    let preventNativeRemove;\n    let ownerRoot = ownerShadyRootForNode(node);\n    const removingInsertionPoint = ownerRoot && ownerRoot._removeContainedSlots(node);\n    const parentData = shadyDataForNode(this);\n    if (utils.isTrackingLogicalChildNodes(this)) {\n      recordRemoveChild(node, this);\n      if (utils.hasShadowRootWithSlot(this)) {\n        parentData.root._asyncRender();\n        preventNativeRemove = true;\n      }\n    }\n    // unscope a node leaving a ShadowRoot if ShadyCSS is present, and this node\n    // is not going to be rescoped in `insertBefore`\n    if (getScopingShim() && !skipUnscoping && ownerRoot) {\n      const oldScopeName = currentScopeForNode(node);\n      treeVisitor(node, (node) => {\n        removeShadyScoping(node, oldScopeName);\n      });\n    }\n    removeOwnerShadyRoot(node);\n    // if removing slot, must render containing root\n    if (ownerRoot) {\n      let changeSlotContent = this && this.localName === 'slot';\n      if (changeSlotContent) {\n        preventNativeRemove = true;\n      }\n      if (removingInsertionPoint || changeSlotContent) {\n        ownerRoot._asyncRender();\n      }\n    }\n    if (!preventNativeRemove) {\n      // if removing from a shadyRoot, remove from host instead\n      let container = utils.isShadyRoot(this) ?\n        /** @type {ShadowRoot} */(this).host :\n        this;\n      // not guaranteed to physically be in container; e.g.\n      // (1) if parent has a shadyRoot, element may or may not at distributed\n      // location (could be undistributed)\n      // (2) if parent is a slot, element may not ben in composed dom\n      if (!(parentData.root || node.localName === 'slot') ||\n        (container === node[utils.NATIVE_PREFIX + 'parentNode'])) {\n        container[utils.NATIVE_PREFIX + 'removeChild'](node);\n      }\n    }\n    scheduleObserver(this, null, node);\n    return node;\n  },\n\n  /**\n   * @this {Node}\n   * @param {Node} node\n   * @param {Node=} ref_node\n   */\n  replaceChild(node, ref_node) {\n    this[utils.SHADY_PREFIX + 'insertBefore'](node, ref_node);\n    this[utils.SHADY_PREFIX + 'removeChild'](ref_node);\n    return node;\n  },\n\n  /**\n   * @this {Node}\n   * @param {boolean=} deep\n   */\n  cloneNode(deep) {\n    if (this.localName == 'template') {\n      return this[utils.NATIVE_PREFIX + 'cloneNode'](deep);\n    } else {\n      const n = this[utils.NATIVE_PREFIX + 'cloneNode'](false);\n      // Attribute nodes historically had childNodes, but they have later\n      // been removed from the spec.\n      // Make sure we do not do a deep clone on them for old browsers (IE11)\n      if (deep && n.nodeType !== Node.ATTRIBUTE_NODE) {\n        let c$ = this[utils.SHADY_PREFIX + 'childNodes'];\n        for (let i=0, nc; i < c$.length; i++) {\n          nc = c$[i][utils.SHADY_PREFIX + 'cloneNode'](true);\n          n[utils.SHADY_PREFIX + 'appendChild'](nc);\n        }\n      }\n      return n;\n    }\n  },\n\n  /**\n   * @this {Node}\n   * @param {Object=} options\n   */\n  // TODO(sorvell): implement `options` e.g. `{ composed: boolean }`\n  getRootNode(options) { // eslint-disable-line no-unused-vars\n    if (!this || !this.nodeType) {\n      return;\n    }\n    const nodeData = ensureShadyDataForNode(this);\n    let root = nodeData.ownerShadyRoot;\n    if (root === undefined) {\n      if (utils.isShadyRoot(this)) {\n        root = this;\n        nodeData.ownerShadyRoot = root;\n      } else {\n        let parent = this[utils.SHADY_PREFIX + 'parentNode'];\n        root = parent ? parent[utils.SHADY_PREFIX + 'getRootNode'](options) : this;\n        // memo-ize result for performance but only memo-ize\n        // result if node is in the document. This avoids a problem where a root\n        // can be cached while an element is inside a fragment.\n        // If this happens and we cache the result, the value can become stale\n        // because for perf we avoid processing the subtree of added fragments.\n        if (document.documentElement[utils.NATIVE_PREFIX + 'contains'](this)) {\n          nodeData.ownerShadyRoot = root;\n        }\n      }\n\n    }\n    return root;\n  },\n\n  /** @this {Node} */\n  contains(node) {\n    return utils.contains(this, node);\n  }\n\n});\n","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\nimport * as utils from '../utils.js';\nimport {shadyDataForNode} from '../shady-data.js';\n\n/**\n * @param {Node} node\n * @param {Function} matcher\n * @param {Function=} halter\n */\nexport function query(node, matcher, halter) {\n  let list = [];\n  queryElements(node[utils.SHADY_PREFIX + 'childNodes'], matcher,\n    halter, list);\n  return list;\n}\n\nfunction queryElements(elements, matcher, halter, list) {\n  for (let i=0, l=elements.length, c; (i<l) && (c=elements[i]); i++) {\n    if (c.nodeType === Node.ELEMENT_NODE &&\n        queryElement(c, matcher, halter, list)) {\n      return true;\n    }\n  }\n}\n\nfunction queryElement(node, matcher, halter, list) {\n  let result = matcher(node);\n  if (result) {\n    list.push(node);\n  }\n  if (halter && halter(result)) {\n    return result;\n  }\n  queryElements(node[utils.SHADY_PREFIX + 'childNodes'], matcher,\n    halter, list);\n}\n\n// Needed on Element, DocumentFragment, Document\nexport const ParentNodePatches = utils.getOwnPropertyDescriptors({\n\n  /** @this {Element} */\n  get firstElementChild() {\n    const nodeData = shadyDataForNode(this);\n    if (nodeData && nodeData.firstChild !== undefined) {\n      let n = this[utils.SHADY_PREFIX + 'firstChild'];\n      while (n && n.nodeType !== Node.ELEMENT_NODE) {\n        n = n[utils.SHADY_PREFIX + 'nextSibling'];\n      }\n      return n;\n    } else {\n      return this[utils.NATIVE_PREFIX + 'firstElementChild'];\n    }\n  },\n\n  /** @this {Element} */\n  get lastElementChild() {\n    const nodeData = shadyDataForNode(this);\n    if (nodeData && nodeData.lastChild !== undefined) {\n      let n = this[utils.SHADY_PREFIX + 'lastChild'];\n      while (n && n.nodeType !== Node.ELEMENT_NODE) {\n        n = n[utils.SHADY_PREFIX + 'previousSibling'];\n      }\n      return n;\n    } else {\n      return this[utils.NATIVE_PREFIX + 'lastElementChild'];\n    }\n  },\n\n  /** @this {Element} */\n  get children() {\n    if (!utils.isTrackingLogicalChildNodes(this)) {\n      return this[utils.NATIVE_PREFIX + 'children'];\n    }\n    return utils.createPolyfilledHTMLCollection(Array.prototype.filter.call(\n        this[utils.SHADY_PREFIX + 'childNodes'], function(n) {\n      return (n.nodeType === Node.ELEMENT_NODE);\n    }));\n  },\n\n  /** @this {Element} */\n  get childElementCount() {\n    let children = this[utils.SHADY_PREFIX + 'children'];\n    if(children) {\n      return children.length;\n    }\n    return 0;\n  }\n\n});\n\nexport const QueryPatches = utils.getOwnPropertyDescriptors({\n  // TODO(sorvell): consider doing native QSA and filtering results.\n  /**\n   * @this {Element}\n   * @param  {string} selector\n   */\n  querySelector(selector) {\n    // match selector and halt on first result.\n    let result = query(this, function(n) {\n      return utils.matchesSelector(n, selector);\n    }, function(n) {\n      return Boolean(n);\n    })[0];\n    return result || null;\n  },\n\n  /**\n   * @this {Element}\n   * @param  {string} selector\n   * @param  {boolean} useNative\n   */\n  // TODO(sorvell): `useNative` option relies on native querySelectorAll and\n  // misses distributed nodes, see\n  // https://github.com/webcomponents/shadydom/pull/210#issuecomment-361435503\n  querySelectorAll(selector, useNative) {\n    if (useNative) {\n      const o = Array.prototype.slice.call(this[utils.NATIVE_PREFIX + 'querySelectorAll'](selector));\n      const root = this[utils.SHADY_PREFIX + 'getRootNode']();\n      return o.filter(e => e[utils.SHADY_PREFIX + 'getRootNode']() == root);\n    }\n    return query(this, function(n) {\n      return utils.matchesSelector(n, selector);\n    });\n  }\n\n});\n\n// Create a custom `ParentNodeDocumentOrFragment` that optionally does not\n// mixin querySelector/All; this is a performance optimization.\nexport const ParentNodeDocumentOrFragmentPatches = utils.settings.preferPerformance ?\n  Object.assign({}, ParentNodePatches) : ParentNodePatches;\n\nObject.assign(ParentNodePatches, QueryPatches);","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\nimport * as utils from '../utils.js';\nimport { query } from './ParentNode.js';\n\nexport const DocumentOrFragmentPatches = utils.getOwnPropertyDescriptors({\n\n  /**\n   * @this {Element}\n   * @param {string} id\n   */\n  getElementById(id) {\n    if (id === '') {\n      return null;\n    }\n    let result = query(this, function(n) {\n      return n.id == id;\n    }, function(n) {\n      return Boolean(n);\n    })[0];\n    return result || null;\n  }\n\n});","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\nimport * as utils from '../utils.js';\nimport {ownerShadyRootForNode} from '../attach-shadow.js';\n\nfunction getDocumentActiveElement() {\n  if (utils.settings.hasDescriptors) {\n    return document[utils.NATIVE_PREFIX + 'activeElement'];\n  } else {\n    return document.activeElement;\n  }\n}\n\nexport const DocumentOrShadowRootPatches = utils.getOwnPropertyDescriptors({\n\n  /** @this {Document|ShadowRoot} */\n  get activeElement() {\n    let active = getDocumentActiveElement();\n    // In IE11, activeElement might be an empty object if the document is\n    // contained in an iframe.\n    // https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/10998788/\n    if (!active || !active.nodeType) {\n      return null;\n    }\n    let isShadyRoot = !!(utils.isShadyRoot(this));\n    if (this !== document) {\n      // If this node isn't a document or shady root, then it doesn't have\n      // an active element.\n      if (!isShadyRoot) {\n        return null;\n      }\n      // If this shady root's host is the active element or the active\n      // element is not a descendant of the host (in the composed tree),\n      // then it doesn't have an active element.\n      if (this.host === active ||\n          !this.host[utils.NATIVE_PREFIX + 'contains'](active)) {\n        return null;\n      }\n    }\n    // This node is either the document or a shady root of which the active\n    // element is a (composed) descendant of its host; iterate upwards to\n    // find the active element's most shallow host within it.\n    let activeRoot = ownerShadyRootForNode(active);\n    while (activeRoot && activeRoot !== this) {\n      active = activeRoot.host;\n      activeRoot = ownerShadyRootForNode(active);\n    }\n    if (this === document) {\n      // This node is the document, so activeRoot should be null.\n      return activeRoot ? null : active;\n    } else {\n      // This node is a non-document shady root, and it should be\n      // activeRoot.\n      return activeRoot === this ? active : null;\n    }\n  }\n});\n","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\nimport * as utils from '../utils.js';\nimport {getInnerHTML} from '../innerHTML.js';\nimport {clearNode} from './Node.js';\n\n/** @type {!Document} */\nconst inertDoc = document.implementation.createHTMLDocument('inert');\n\nexport const ElementOrShadowRootPatches = utils.getOwnPropertyDescriptors({\n\n  /** @this {Element} */\n  get innerHTML() {\n    if (utils.isTrackingLogicalChildNodes(this)) {\n      const content = this.localName === 'template' ?\n      /** @type {HTMLTemplateElement} */(this).content : this;\n      return getInnerHTML(content, (e) => e[utils.SHADY_PREFIX + 'childNodes']);\n    } else {\n      return this[utils.NATIVE_PREFIX + 'innerHTML'];\n    }\n  },\n\n  /**\n   * @this {Element}\n   * @param {string} value\n   */\n  set innerHTML(value) {\n    if (this.localName === 'template') {\n      this[utils.NATIVE_PREFIX + 'innerHTML'] = value;\n    } else {\n      clearNode(this);\n      const containerName = this.localName || 'div';\n      let htmlContainer;\n      if (!this.namespaceURI || this.namespaceURI === inertDoc.namespaceURI) {\n        htmlContainer = inertDoc.createElement(containerName);\n      } else {\n        htmlContainer = inertDoc.createElementNS(this.namespaceURI, containerName);\n      }\n      if (utils.settings.hasDescriptors) {\n        htmlContainer[utils.NATIVE_PREFIX + 'innerHTML'] = value;\n      } else {\n        htmlContainer.innerHTML = value;\n      }\n      let firstChild;\n      while ((firstChild = htmlContainer[utils.SHADY_PREFIX + 'firstChild'])) {\n        this[utils.SHADY_PREFIX + 'insertBefore'](firstChild);\n      }\n    }\n  }\n\n});\n","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\nimport * as utils from '../utils.js';\n\nexport const ShadowRootPatches = utils.getOwnPropertyDescriptors({\n\n  /**\n   * @this {ShadowRoot}\n   * @param {string} type\n   * @param {Function} fn\n   * @param {Object|boolean=} optionsOrCapture\n   */\n  addEventListener(type, fn, optionsOrCapture) {\n    if (typeof optionsOrCapture !== 'object') {\n      optionsOrCapture = {\n        capture: Boolean(optionsOrCapture)\n      }\n    }\n    optionsOrCapture.__shadyTarget = this;\n    this.host[utils.SHADY_PREFIX + 'addEventListener'](type, fn, optionsOrCapture);\n  },\n\n  /**\n   * @this {ShadowRoot}\n   * @param {string} type\n   * @param {Function} fn\n   * @param {Object|boolean=} optionsOrCapture\n   */\n  removeEventListener(type, fn, optionsOrCapture) {\n    if (typeof optionsOrCapture !== 'object') {\n      optionsOrCapture = {\n        capture: Boolean(optionsOrCapture)\n      }\n    }\n    optionsOrCapture.__shadyTarget = this;\n    this.host[utils.SHADY_PREFIX + 'removeEventListener'](type, fn, optionsOrCapture);\n  }\n\n});\n","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\nimport * as utils from './utils.js';\nimport {NodePatches} from './patches/Node.js';\nimport {OutsideDescriptors, InsideDescriptors} from './patch-instances.js';\nimport {ParentNodePatches} from './patches/ParentNode.js';\nimport {DocumentOrFragmentPatches} from './patches/DocumentOrFragment.js';\nimport {DocumentOrShadowRootPatches} from './patches/DocumentOrShadowRoot.js';\nimport {ElementOrShadowRootPatches} from './patches/ElementOrShadowRoot.js';\nimport {ShadowRootPatches} from './patches/ShadowRoot.js';\n\n/**\n * @param {!Object} proto\n * @param {string=} prefix\n */\nconst patchShadyAccessors = (proto, prefix) => {\n  utils.patchProperties(proto, ShadowRootPatches, prefix);\n  utils.patchProperties(proto, DocumentOrShadowRootPatches, prefix);\n  utils.patchProperties(proto, ElementOrShadowRootPatches, prefix);\n  // We ensure ParentNode accessors since these do not exist in Edge/IE on DocumentFragments.\n  utils.patchProperties(proto, ParentNodePatches, prefix);\n  // Ensure `shadowRoot` has basic descriptors when we cannot rely\n  // on them coming from DocumentFragment.\n  //\n  // Case 1, noPatching: Because we want noPatch ShadyRoots to have native property\n  // names so that they do not have to be wrapped...\n  // When we do *not* patch Node/DocumentFragment.prototype\n  // we must manually install those properties on ShadyRoot's prototype.\n  // Note, it's important to only install these in this mode so as not to stomp\n  // over CustomElements polyfill's patches on Node/DocumentFragment methods.\n  if (utils.settings.noPatch && !prefix) {\n    utils.patchProperties(proto, NodePatches, prefix);\n    utils.patchProperties(proto, DocumentOrFragmentPatches, prefix);\n  // Case 2, bad descriptors: Ensure accessors are on ShadowRoot.\n  // These descriptors are normally used for instance patching but because\n  // ShadyRoot can always be patched, just do it to the prototype.\n  } else if (!utils.settings.hasDescriptors) {\n    utils.patchProperties(proto, OutsideDescriptors);\n    utils.patchProperties(proto, InsideDescriptors);\n  }\n}\n\nexport const patchShadyRoot = (proto) => {\n  proto.__proto__ = DocumentFragment.prototype;\n\n  // patch both prefixed and not, even when noPatch == true.\n  patchShadyAccessors(proto, utils.SHADY_PREFIX);\n  patchShadyAccessors(proto);\n\n  // Ensure native properties are all safely wrapped since ShadowRoot is not an\n  // actual DocumentFragment instance.\n  Object.defineProperties(proto, {\n    nodeType: {\n      value: Node.DOCUMENT_FRAGMENT_NODE,\n      configurable: true\n    },\n    nodeName: {\n      value: '#document-fragment',\n      configurable: true\n    },\n    nodeValue: {\n      value: null,\n      configurable: true\n    }\n  });\n\n  // make undefined\n  [\n    'localName',\n    'namespaceURI',\n    'prefix'\n  ].forEach((prop) => {\n    Object.defineProperty(proto, prop, {\n      value: undefined,\n      configurable: true\n    });\n  });\n\n  // defer properties to host\n  [\n    'ownerDocument',\n    'baseURI',\n    'isConnected'\n  ].forEach((prop) => {\n    Object.defineProperty(proto, prop, {\n      /** @this {ShadowRoot} */\n      get() {\n        return this.host[prop];\n      },\n      configurable: true\n    });\n  });\n}\n","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\nimport {calculateSplices} from './array-splice.js';\nimport * as utils from './utils.js';\nimport {enqueue} from './flush.js';\nimport {ensureShadyDataForNode, shadyDataForNode} from './shady-data.js';\nimport {recordChildNodes} from './link-nodes.js';\nimport {patchShadyRoot} from './patch-shadyRoot.js';\n\n// Do not export this object. It must be passed as the first argument to the\n// ShadyRoot constructor in `attachShadow` to prevent the constructor from\n// throwing. This prevents the user from being able to manually construct a\n// ShadyRoot (i.e. `new ShadowRoot()`).\nconst ShadyRootConstructionToken = {};\n\nconst CATCHALL_NAME = '__catchall';\nconst SHADYROOT_NAME = 'ShadyRoot';\n\nconst MODE_CLOSED = 'closed';\n\nlet isRendering = utils.settings['deferConnectionCallbacks'] && document.readyState === 'loading';\nlet rootRendered;\n\nfunction ancestorList(node) {\n  let ancestors = [];\n  do {\n    ancestors.unshift(node);\n  } while ((node = node[utils.SHADY_PREFIX + 'parentNode']));\n  return ancestors;\n}\n\n/**\n * @extends {ShadowRoot}\n */\nclass ShadyRoot {\n\n  constructor(token, host, options) {\n    if (token !== ShadyRootConstructionToken) {\n      throw new TypeError('Illegal constructor');\n    }\n    // NOTE: set a fake local name so this element can be\n    // distinguished from a DocumentFragment when patching.\n    // FF doesn't allow this to be `localName`\n    this._localName = SHADYROOT_NAME;\n    // root <=> host\n    this.host = host;\n    /** @type {!string|undefined} */\n    this.mode = options && options.mode;\n    recordChildNodes(host);\n    const hostData = ensureShadyDataForNode(host);\n    /** @type {!ShadyRoot} */\n    hostData.root = this;\n    hostData.publicRoot = this.mode !== MODE_CLOSED ? this : null;\n    // setup root\n    const rootData = ensureShadyDataForNode(this);\n    rootData.firstChild = rootData.lastChild =\n        rootData.parentNode = rootData.nextSibling =\n        rootData.previousSibling = null;\n    rootData.childNodes = [];\n    // state flags\n    this._renderPending = false;\n    this._hasRendered = false;\n    // marsalled lazily\n    this._slotList = null;\n    /** @type {Object<string, Array<HTMLSlotElement>>} */\n    this._slotMap = null;\n    this._pendingSlots = null;\n    // NOTE: optimization flag, only require an asynchronous render\n    // to record parsed children if flag is not set.\n    if (utils.settings['preferPerformance']) {\n      let n;\n      while ((n = host[utils.NATIVE_PREFIX + 'firstChild'])) {\n        host[utils.NATIVE_PREFIX + 'removeChild'](n);\n      }\n    } else {\n      this._asyncRender();\n    }\n  }\n\n  _asyncRender() {\n    if (!this._renderPending) {\n      this._renderPending = true;\n      enqueue(() => this._render());\n    }\n  }\n\n  // returns the oldest renderPending ancestor root.\n  _getPendingDistributionRoot() {\n    let renderRoot;\n    let root = this;\n    while (root) {\n      if (root._renderPending) {\n        renderRoot = root;\n      }\n      root = root._getDistributionParent();\n    }\n    return renderRoot;\n  }\n\n  // Returns the shadyRoot `this.host` if `this.host`\n  // has children that require distribution.\n  _getDistributionParent() {\n    let root = this.host[utils.SHADY_PREFIX + 'getRootNode']();\n    if (!utils.isShadyRoot(root)) {\n      return;\n    }\n    const nodeData = shadyDataForNode(this.host);\n    if (nodeData && nodeData.__childSlotCount > 0) {\n      return root;\n    }\n  }\n\n  // Renders the top most render pending shadowRoot in the distribution tree.\n  // This is safe because when a distribution parent renders, all children render.\n  _render() {\n    // If this root is not pending, it needs no rendering work. Any pending\n    // parent that needs to render wll cause this root to render.\n    const root = this._renderPending && this._getPendingDistributionRoot();\n    if (root) {\n      root._renderSelf();\n    }\n  }\n\n  _flushInitial() {\n    if (!this._hasRendered && this._renderPending) {\n      this._render();\n    }\n  }\n\n  /** @override */\n  _renderSelf() {\n    // track rendering state.\n    const wasRendering = isRendering;\n    isRendering = true;\n    this._renderPending = false;\n    if (this._slotList) {\n      this._distribute();\n      this._compose();\n    }\n    // NOTE: optimization flag, only process parsed children\n    // if optimization flag is not set.\n    // on initial render remove any undistributed children.\n    if (!utils.settings['preferPerformance'] && !this._hasRendered) {\n      const c$ = this.host[utils.SHADY_PREFIX + 'childNodes'];\n      for (let i=0, l=c$.length; i < l; i++) {\n        const child = c$[i];\n        const data = shadyDataForNode(child);\n        if (child[utils.NATIVE_PREFIX + 'parentNode'] === this.host &&\n            (child.localName === 'slot' || !data.assignedSlot)) {\n          this.host[utils.NATIVE_PREFIX + 'removeChild'](child);\n        }\n      }\n    }\n    this._hasRendered = true;\n    isRendering = wasRendering;\n    if (rootRendered) {\n      rootRendered();\n    }\n  }\n\n  _distribute() {\n    this._validateSlots();\n    // capture # of previously assigned nodes to help determine if dirty.\n    for (let i=0, slot; i < this._slotList.length; i++) {\n      slot = this._slotList[i];\n      this._clearSlotAssignedNodes(slot);\n    }\n    // distribute host children.\n    for (let n=this.host[utils.SHADY_PREFIX + 'firstChild']; n; n=n[utils.SHADY_PREFIX + 'nextSibling']) {\n      this._distributeNodeToSlot(n);\n    }\n    // fallback content, slotchange, and dirty roots\n    for (let i=0; i < this._slotList.length; i++) {\n      const slot = this._slotList[i];\n      const slotData = shadyDataForNode(slot);\n      // distribute fallback content\n      if (!slotData.assignedNodes.length) {\n        for (let n=slot[utils.SHADY_PREFIX + 'firstChild']; n; n=n[utils.SHADY_PREFIX + 'nextSibling']) {\n          this._distributeNodeToSlot(n, slot);\n        }\n      }\n      const slotParentData = shadyDataForNode(slot[utils.SHADY_PREFIX + 'parentNode']);\n      const slotParentRoot = slotParentData && slotParentData.root;\n      if (slotParentRoot && (slotParentRoot._hasInsertionPoint() || slotParentRoot._renderPending)) {\n        slotParentRoot._renderSelf();\n      }\n      this._addAssignedToFlattenedNodes(slotData.flattenedNodes,\n        slotData.assignedNodes);\n      let prevAssignedNodes = slotData._previouslyAssignedNodes;\n      if (prevAssignedNodes) {\n        for (let i=0; i < prevAssignedNodes.length; i++) {\n          shadyDataForNode(prevAssignedNodes[i])._prevAssignedSlot = null;\n        }\n        slotData._previouslyAssignedNodes = null;\n        // dirty if previously less assigned nodes than previously assigned.\n        if (prevAssignedNodes.length > slotData.assignedNodes.length) {\n          slotData.dirty = true;\n        }\n      }\n      /* Note: A slot is marked dirty whenever a node is newly assigned to it\n      or a node is assigned to a different slot (done in `_distributeNodeToSlot`)\n      or if the number of nodes assigned to the slot has decreased (done above);\n      */\n      if (slotData.dirty) {\n        slotData.dirty = false;\n        this._fireSlotChange(slot);\n      }\n    }\n  }\n\n  /**\n   * Distributes given `node` to the appropriate slot based on its `slot`\n   * attribute. If `forcedSlot` is given, then the node is distributed to the\n   * `forcedSlot`.\n   * Note: slot to which the node is assigned will be marked dirty for firing\n   * `slotchange`.\n   * @param {Node} node\n   * @param {Node=} forcedSlot\n   *\n   */\n  _distributeNodeToSlot(node, forcedSlot) {\n    const nodeData = ensureShadyDataForNode(node);\n    let oldSlot = nodeData._prevAssignedSlot;\n    nodeData._prevAssignedSlot = null;\n    let slot = forcedSlot;\n    if (!slot) {\n      let name = node[utils.SHADY_PREFIX + 'slot'] || CATCHALL_NAME;\n      const list = this._slotMap[name];\n      slot = list && list[0];\n    }\n    if (slot) {\n      const slotData = ensureShadyDataForNode(slot);\n      slotData.assignedNodes.push(node);\n      nodeData.assignedSlot = slot;\n    } else {\n      nodeData.assignedSlot = undefined;\n    }\n    if (oldSlot !== nodeData.assignedSlot) {\n      if (nodeData.assignedSlot) {\n        ensureShadyDataForNode(nodeData.assignedSlot).dirty = true;\n      }\n    }\n  }\n\n  /**\n   * Clears the assignedNodes tracking data for a given `slot`. Note, the current\n   * assigned node data is tracked (via _previouslyAssignedNodes and\n   * _prevAssignedSlot) to see if `slotchange` should fire. This data may be out\n   *  of date at this time because the assigned nodes may have already been\n   * distributed to another root. This is ok since this data is only used to\n   * track changes.\n   * @param {HTMLSlotElement} slot\n   */\n  _clearSlotAssignedNodes(slot) {\n    const slotData = shadyDataForNode(slot);\n    let n$ = slotData.assignedNodes;\n    slotData.assignedNodes = [];\n    slotData.flattenedNodes = [];\n    slotData._previouslyAssignedNodes = n$;\n    if (n$) {\n      for (let i=0; i < n$.length; i++) {\n        let n = shadyDataForNode(n$[i]);\n        n._prevAssignedSlot = n.assignedSlot;\n        // only clear if it was previously set to this slot;\n        // this helps ensure that if the node has otherwise been distributed\n        // ignore it.\n        if (n.assignedSlot === slot) {\n          n.assignedSlot = null;\n        }\n      }\n    }\n  }\n\n  _addAssignedToFlattenedNodes(flattened, assigned) {\n    for (let i=0, n; (i<assigned.length) && (n=assigned[i]); i++) {\n      if (n.localName == 'slot') {\n        const nestedAssigned = shadyDataForNode(n).assignedNodes;\n        if (nestedAssigned && nestedAssigned.length) {\n          this._addAssignedToFlattenedNodes(flattened, nestedAssigned);\n        }\n      } else {\n        flattened.push(assigned[i]);\n      }\n    }\n  }\n\n  _fireSlotChange(slot) {\n    // NOTE: cannot bubble correctly here so not setting bubbles: true\n    // Safari tech preview does not bubble but chrome does\n    // Spec says it bubbles (https://dom.spec.whatwg.org/#mutation-observers)\n    slot[utils.NATIVE_PREFIX + 'dispatchEvent'](new Event('slotchange'));\n    const slotData = shadyDataForNode(slot);\n    if (slotData.assignedSlot) {\n      this._fireSlotChange(slotData.assignedSlot);\n    }\n  }\n\n  // Reify dom such that it is at its correct rendering position\n  // based on logical distribution.\n  // NOTE: here we only compose parents of <slot> elements and not the\n  // shadowRoot into the host. The latter is performend via a fast path\n  // in the `logical-mutation`.insertBefore.\n  _compose() {\n    const slots = this._slotList;\n    let composeList = [];\n    for (let i=0; i < slots.length; i++) {\n      const parent = slots[i][utils.SHADY_PREFIX + 'parentNode'];\n      /* compose node only if:\n        (1) parent does not have a shadowRoot since shadowRoot has already\n        composed into the host\n        (2) we're not already composing it\n        [consider (n^2) but rare better than Set]\n      */\n      const parentData = shadyDataForNode(parent);\n      if (!(parentData && parentData.root) &&\n        composeList.indexOf(parent) < 0) {\n        composeList.push(parent);\n      }\n    }\n    for (let i=0; i < composeList.length; i++) {\n      const node = composeList[i];\n      const targetNode = node === this ? this.host : node;\n      this._updateChildNodes(targetNode, this._composeNode(node));\n    }\n  }\n\n  // Returns the list of nodes which should be rendered inside `node`.\n  _composeNode(node) {\n    let children = [];\n    let c$ = node[utils.SHADY_PREFIX + 'childNodes'];\n    for (let i = 0; i < c$.length; i++) {\n      let child = c$[i];\n      // Note: if we see a slot here, the nodes are guaranteed to need to be\n      // composed here. This is because if there is redistribution, it has\n      // already been handled by this point.\n      if (this._isInsertionPoint(child)) {\n        let flattenedNodes = shadyDataForNode(child).flattenedNodes;\n        for (let j = 0; j < flattenedNodes.length; j++) {\n          let distributedNode = flattenedNodes[j];\n            children.push(distributedNode);\n        }\n      } else {\n        children.push(child);\n      }\n    }\n    return children;\n  }\n\n  _isInsertionPoint(node) {\n      return node.localName == 'slot';\n    }\n\n  // Ensures that the rendered node list inside `container` is `children`.\n  _updateChildNodes(container, children) {\n    let composed = Array.prototype.slice.call(container[utils.NATIVE_PREFIX + 'childNodes']);\n    let splices = calculateSplices(children, composed);\n    // process removals\n    for (let i=0, d=0, s; (i<splices.length) && (s=splices[i]); i++) {\n      for (let j=0, n; (j < s.removed.length) && (n=s.removed[j]); j++) {\n        // check if the node is still where we expect it is before trying\n        // to remove it; this can happen if we move a node and\n        // then schedule its previous host for distribution resulting in\n        // the node being removed here.\n        if (n[utils.NATIVE_PREFIX + 'parentNode'] === container) {\n          container[utils.NATIVE_PREFIX + 'removeChild'](n);\n        }\n        // TODO(sorvell): avoid the need for splicing here.\n        composed.splice(s.index + d, 1);\n      }\n      d -= s.addedCount;\n    }\n    // process adds\n    for (let i=0, s, next; (i<splices.length) && (s=splices[i]); i++) { //eslint-disable-line no-redeclare\n      next = composed[s.index];\n      for (let j=s.index, n; j < s.index + s.addedCount; j++) {\n        n = children[j];\n        container[utils.NATIVE_PREFIX + 'insertBefore'](n, next);\n        composed.splice(j, 0, n);\n      }\n    }\n  }\n\n  _ensureSlotData() {\n    this._pendingSlots = this._pendingSlots || [];\n    this._slotList = this._slotList || [];\n    this._slotMap = this._slotMap || {};\n  }\n\n  _addSlots(slots) {\n    this._ensureSlotData();\n    this._pendingSlots.push(...slots);\n  }\n\n  _validateSlots() {\n    if (this._pendingSlots && this._pendingSlots.length) {\n      this._mapSlots(this._pendingSlots);\n      this._pendingSlots = [];\n    }\n  }\n\n  /**\n   * Adds the given slots. Slots are maintained in an dom-ordered list.\n   * In addition a map of name to slot is updated.\n   */\n  _mapSlots(slots) {\n    let slotNamesToSort;\n    for (let i=0; i < slots.length; i++) {\n      const slot = slots[i];\n      // ensure insertionPoints's and their parents have logical dom info.\n      // save logical tree info\n      // a. for shadyRoot\n      // b. for insertion points (fallback)\n      // c. for parents of insertion points\n      recordChildNodes(slot);\n      const slotParent = slot[utils.SHADY_PREFIX + 'parentNode'];\n      recordChildNodes(slotParent);\n      const slotParentData = shadyDataForNode(slotParent);\n      slotParentData.__childSlotCount = (slotParentData.__childSlotCount || 0) + 1;\n      let name = this._nameForSlot(slot);\n      if (this._slotMap[name]) {\n        slotNamesToSort = slotNamesToSort || {};\n        slotNamesToSort[name] = true;\n        this._slotMap[name].push(slot);\n      } else {\n        this._slotMap[name] = [slot];\n      }\n      this._slotList.push(slot);\n    }\n    if (slotNamesToSort) {\n      for (let n in slotNamesToSort) {\n        this._slotMap[n] = this._sortSlots(this._slotMap[n]);\n      }\n    }\n  }\n\n  _nameForSlot(slot) {\n    const name = slot['name'] || slot.getAttribute('name') || CATCHALL_NAME;\n    slot.__slotName = name;\n    return name;\n  }\n\n  /**\n   * Slots are kept in an ordered list. Slots with the same name\n   * are sorted here by tree order.\n   */\n  _sortSlots(slots) {\n    // NOTE: Cannot use `compareDocumentPosition` because it's not polyfilled,\n    // but the code here could be used to polyfill the preceeding/following info\n    // in `compareDocumentPosition`.\n    return slots.sort((a, b) => {\n      let listA = ancestorList(a);\n      let listB = ancestorList(b);\n      for (var i=0; i < listA.length; i++) {\n        let nA = listA[i];\n        let nB = listB[i];\n        if (nA !== nB) {\n          let c$ = Array.from(nA[utils.SHADY_PREFIX + 'parentNode'][utils.SHADY_PREFIX + 'childNodes']);\n          return c$.indexOf(nA) - c$.indexOf(nB);\n        }\n      }\n    });\n  }\n\n  /**\n   * Removes from tracked slot data any slots contained within `container` and\n   * then updates the tracked data (_slotList and _slotMap).\n   * Any removed slots also have their `assignedNodes` removed from comopsed dom.\n   */\n  _removeContainedSlots(container) {\n    if (!this._slotList) {\n      return;\n    }\n    this._validateSlots();\n    let didRemove;\n    const map = this._slotMap;\n    for (let n in map) {\n      const slots = map[n];\n      for (let i=0; i < slots.length; i++) {\n        const slot = slots[i];\n        if (utils.contains(container, slot)) {\n          slots.splice(i, 1);\n          const x = this._slotList.indexOf(slot);\n          if (x >= 0) {\n            this._slotList.splice(x, 1);\n            const slotParentData = shadyDataForNode(slot[utils.SHADY_PREFIX + 'parentNode']);\n            if (slotParentData && slotParentData.__childSlotCount) {\n              slotParentData.__childSlotCount--;\n            }\n          }\n          i--;\n          this._removeFlattenedNodes(slot);\n          didRemove = true;\n        }\n      }\n    }\n    return didRemove;\n  }\n\n  _updateSlotName(slot) {\n    if (!this._slotList) {\n      return;\n    }\n    // make sure slotMap is initialized with this slot\n    this._validateSlots();\n    const oldName = slot.__slotName;\n    const name = this._nameForSlot(slot);\n    if (name === oldName) {\n      return;\n    }\n    // remove from existing tracking\n    let slots = this._slotMap[oldName];\n    const i = slots.indexOf(slot);\n    if (i >= 0) {\n      slots.splice(i, 1);\n    }\n    // add to new location and sort if nedessary\n    let list = this._slotMap[name] || (this._slotMap[name] = []);\n    list.push(slot);\n    if (list.length > 1) {\n      this._slotMap[name] = this._sortSlots(list);\n    }\n  }\n\n  _removeFlattenedNodes(slot) {\n    const data = shadyDataForNode(slot);\n    let n$ = data.flattenedNodes;\n    if (n$) {\n      for (let i=0; i<n$.length; i++) {\n        let node = n$[i];\n        let parent = node[utils.NATIVE_PREFIX + 'parentNode'];\n        if (parent) {\n          parent[utils.NATIVE_PREFIX + 'removeChild'](node);\n        }\n      }\n    }\n    data.flattenedNodes = [];\n    data.assignedNodes = [];\n  }\n\n  _hasInsertionPoint() {\n    this._validateSlots();\n    return Boolean(this._slotList && this._slotList.length);\n  }\n}\n\npatchShadyRoot(ShadyRoot.prototype);\nexport {ShadyRoot};\n\n/**\n  Implements a pared down version of ShadowDOM's scoping, which is easy to\n  polyfill across browsers.\n*/\nexport const attachShadow = (host, options) => {\n  if (!host) {\n    throw new Error('Must provide a host.');\n  }\n  if (!options) {\n    throw new Error('Not enough arguments.');\n  }\n  return new ShadyRoot(ShadyRootConstructionToken, host, options);\n}\n\n// Mitigate connect/disconnect spam by wrapping custom element classes.\nif (window['customElements'] && utils.settings.inUse && !utils.settings['preferPerformance']) {\n\n  // process connect/disconnect after roots have rendered to avoid\n  // issues with reaction stack.\n  let connectMap = new Map();\n  rootRendered = function() {\n    // allow elements to connect\n    // save map state (without needing polyfills on IE11)\n    const r = [];\n    connectMap.forEach((v, k) => {\n      r.push([k, v]);\n    });\n    connectMap.clear();\n    for (let i=0; i < r.length; i++) {\n      const e = r[i][0], value = r[i][1];\n      if (value) {\n        e.__shadydom_connectedCallback();\n      } else {\n        e.__shadydom_disconnectedCallback();\n      }\n    }\n  }\n\n  // Document is in loading state and flag is set (deferConnectionCallbacks)\n  // so process connection stack when `readystatechange` fires.\n  if (isRendering) {\n    document.addEventListener('readystatechange', () => {\n      isRendering = false;\n      rootRendered();\n    }, {once: true});\n  }\n\n  /*\n   * (1) elements can only be connected/disconnected if they are in the expected\n   * state.\n   * (2) never run connect/disconnect during rendering to avoid reaction stack issues.\n   */\n  const ManageConnect = (base, connected, disconnected) => {\n    let counter = 0;\n    const connectFlag = `__isConnected${counter++}`;\n    if (connected || disconnected) {\n\n      /** @this {!HTMLElement} */\n      base.prototype.connectedCallback = base.prototype.__shadydom_connectedCallback = function() {\n        // if rendering defer connected\n        // otherwise connect only if we haven't already\n        if (isRendering) {\n          connectMap.set(this, true);\n        } else if (!this[connectFlag]) {\n          this[connectFlag] = true;\n          if (connected) {\n            connected.call(this);\n          }\n        }\n      }\n\n      /** @this {!HTMLElement} */\n      base.prototype.disconnectedCallback = base.prototype.__shadydom_disconnectedCallback = function() {\n        // if rendering, cancel a pending connection and queue disconnect,\n        // otherwise disconnect only if a connection has been allowed\n        if (isRendering) {\n          // This is necessary only because calling removeChild\n          // on a node that requires distribution leaves it in the DOM tree\n          // until distribution.\n          // NOTE: remember this is checking the patched isConnected to determine\n          // if the node is in the logical tree.\n          if (!this.isConnected) {\n            connectMap.set(this, false);\n          }\n        } else if (this[connectFlag]) {\n          this[connectFlag] = false;\n          if (disconnected) {\n            disconnected.call(this);\n          }\n        }\n      }\n    }\n\n    return base;\n  }\n\n  const define = window['customElements']['define'];\n  // NOTE: Instead of patching customElements.define,\n  // re-define on the CustomElementRegistry.prototype.define\n  // for Safari 10 compatibility (it's flakey otherwise).\n  Object.defineProperty(window['CustomElementRegistry'].prototype, 'define', {\n    value: function(name, constructor) {\n      const connected = constructor.prototype.connectedCallback;\n      const disconnected = constructor.prototype.disconnectedCallback;\n      define.call(window['customElements'], name,\n          ManageConnect(constructor, connected, disconnected));\n      // unpatch connected/disconnected on class; custom elements tears this off\n      // so the patch is maintained, but if the user calls these methods for\n      // e.g. testing, they will be as expected.\n      constructor.prototype.connectedCallback = connected;\n      constructor.prototype.disconnectedCallback = disconnected;\n    }\n  });\n\n}\n\n/** @return {!ShadyRoot|undefined} */\nexport const ownerShadyRootForNode = (node) => {\n  let root = node[utils.SHADY_PREFIX + 'getRootNode']();\n  if (utils.isShadyRoot(root)) {\n    return root;\n  }\n}\n","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\nimport * as utils from './utils.js';\nimport {eventPropertyNames} from './patch-events.js';\n\n/** @implements {IWrapper} */\nclass Wrapper {\n\n  /** @param {!Node} node */\n  constructor(node) {\n    this.node = node;\n  }\n\n  // node\n  addEventListener(name, fn, options) {\n    return this.node[utils.SHADY_PREFIX + 'addEventListener'](name, fn, options);\n  }\n\n  removeEventListener(name, fn, options) {\n    return this.node[utils.SHADY_PREFIX + 'removeEventListener'](name, fn, options);\n  }\n\n  appendChild(node) {\n    return this.node[utils.SHADY_PREFIX + 'appendChild'](node);\n  }\n\n  insertBefore(node, ref_node) {\n    return this.node[utils.SHADY_PREFIX + 'insertBefore'](node, ref_node);\n  }\n\n  removeChild(node) {\n    return this.node[utils.SHADY_PREFIX + 'removeChild'](node);\n  }\n\n  replaceChild(node, ref_node) {\n    return this.node[utils.SHADY_PREFIX + 'replaceChild'](node, ref_node);\n  }\n\n  cloneNode(deep) {\n    return this.node[utils.SHADY_PREFIX + 'cloneNode'](deep);\n  }\n\n  getRootNode(options) {\n    return this.node[utils.SHADY_PREFIX + 'getRootNode'](options);\n  }\n\n  contains(node) {\n    return this.node[utils.SHADY_PREFIX + 'contains'](node);\n  }\n\n  dispatchEvent(event) {\n    return this.node[utils.SHADY_PREFIX + 'dispatchEvent'](event);\n  }\n\n  // element\n  setAttribute(name, value) {\n    this.node[utils.SHADY_PREFIX + 'setAttribute'](name, value);\n  }\n\n  // NOTE: not needed, just here for balance\n  getAttribute(name) {\n    return this.node[utils.NATIVE_PREFIX + 'getAttribute'](name);\n  }\n\n  // NOTE: not needed, just here for balance\n  hasAttribute(name) {\n    return this.node[utils.NATIVE_PREFIX + 'hasAttribute'](name);\n  }\n\n  removeAttribute(name) {\n    this.node[utils.SHADY_PREFIX + 'removeAttribute'](name);\n  }\n\n  attachShadow(options) {\n    return this.node[utils.SHADY_PREFIX + 'attachShadow'](options);\n  }\n\n  /** @return {!Node|undefined} */\n  get activeElement() {\n    if (utils.isShadyRoot(this.node) || this.node.nodeType === Node.DOCUMENT_NODE) {\n      const e = this.node[utils.SHADY_PREFIX + 'activeElement'];\n      return e;\n    }\n  }\n\n  /**\n   * Installed for compatibility with browsers (older Chrome/Safari) that do\n   * not have a configurable `activeElement` accessor. Enables noPatch and\n   * patch mode both to consistently use ShadyDOM.wrap(document)._activeElement.\n   * @override\n   * @return {!Node|undefined}\n   */\n  get _activeElement() {\n    return this.activeElement;\n  }\n\n  // NOTE: not needed, just here for balance\n  /** @override */\n  focus() {\n    this.node[utils.NATIVE_PREFIX + 'focus']();\n  }\n\n  blur() {\n    this.node[utils.SHADY_PREFIX + 'blur']();\n  }\n\n  // document\n  importNode(node, deep) {\n    if (this.node.nodeType === Node.DOCUMENT_NODE) {\n      return this.node[utils.SHADY_PREFIX + 'importNode'](node, deep);\n    }\n  }\n\n  getElementById(id) {\n    if (this.node.nodeType === Node.DOCUMENT_NODE) {\n      return this.node[utils.SHADY_PREFIX + 'getElementById'](id);\n    }\n  }\n\n  // query\n  querySelector(selector) {\n    return this.node[utils.SHADY_PREFIX + 'querySelector'](selector);\n  }\n\n  querySelectorAll(selector, useNative) {\n    return this.node[utils.SHADY_PREFIX + 'querySelectorAll'](selector, useNative);\n  }\n\n  // slot\n  assignedNodes(options) {\n    if (this.node.localName === 'slot') {\n      return this.node[utils.SHADY_PREFIX + 'assignedNodes'](options);\n    }\n  }\n\n  get host() {\n    if (utils.isShadyRoot(this.node)) {\n      return /** @type {!ShadowRoot} */(this.node).host;\n    }\n  }\n\n  get parentNode() {\n    return this.node[utils.SHADY_PREFIX + 'parentNode'];\n  }\n\n  get firstChild() {\n    return this.node[utils.SHADY_PREFIX + 'firstChild'];\n  }\n\n  get lastChild() {\n    return this.node[utils.SHADY_PREFIX + 'lastChild'];\n  }\n\n  get nextSibling() {\n    return this.node[utils.SHADY_PREFIX + 'nextSibling'];\n  }\n\n  get previousSibling() {\n    return this.node[utils.SHADY_PREFIX + 'previousSibling'];\n  }\n\n  get childNodes() {\n    return this.node[utils.SHADY_PREFIX + 'childNodes'];\n  }\n\n  get parentElement() {\n    return this.node[utils.SHADY_PREFIX + 'parentElement'];\n  }\n\n  get firstElementChild() {\n    return this.node[utils.SHADY_PREFIX + 'firstElementChild'];\n  }\n\n  get lastElementChild() {\n    return this.node[utils.SHADY_PREFIX + 'lastElementChild'];\n  }\n\n  get nextElementSibling() {\n    return this.node[utils.SHADY_PREFIX + 'nextElementSibling'];\n  }\n\n  get previousElementSibling() {\n    return this.node[utils.SHADY_PREFIX + 'previousElementSibling'];\n  }\n\n  get children() {\n    return this.node[utils.SHADY_PREFIX + 'children'];\n  }\n\n  get childElementCount() {\n    return this.node[utils.SHADY_PREFIX + 'childElementCount'];\n  }\n\n  get shadowRoot() {\n    return this.node[utils.SHADY_PREFIX + 'shadowRoot'];\n  }\n\n  get assignedSlot() {\n    return this.node[utils.SHADY_PREFIX + 'assignedSlot'];\n  }\n\n  get isConnected() {\n    return this.node[utils.SHADY_PREFIX + 'isConnected'];\n  }\n\n  get innerHTML() {\n    return this.node[utils.SHADY_PREFIX + 'innerHTML'];\n  }\n\n  set innerHTML(value) {\n    this.node[utils.SHADY_PREFIX + 'innerHTML'] = value;\n  }\n\n  get textContent() {\n    return this.node[utils.SHADY_PREFIX + 'textContent'];\n  }\n\n  set textContent(value) {\n    this.node[utils.SHADY_PREFIX + 'textContent'] = value;\n  }\n\n  get slot() {\n    return this.node[utils.SHADY_PREFIX + 'slot'];\n  }\n\n  set slot(value) {\n    this.node[utils.SHADY_PREFIX + 'slot'] = value;\n  }\n\n}\n\neventPropertyNames.forEach(name => {\n  Object.defineProperty(Wrapper.prototype, name, {\n    /** @this {Wrapper} */\n    get() {\n      return this.node[utils.SHADY_PREFIX + name];\n    },\n    /** @this {Wrapper} */\n    set(value) {\n      this.node[utils.SHADY_PREFIX + name] = value;\n    },\n    configurable: true\n  });\n\n});\n\nexport {Wrapper};\n\nconst wrapperMap = new WeakMap();\n\nexport function wrap(obj) {\n  if (utils.isShadyRoot(obj) || obj instanceof Wrapper) {\n    return obj;\n  }\n  let wrapper = wrapperMap.get(obj)\n  if (!wrapper) {\n    wrapper = new Wrapper(obj);\n    wrapperMap.set(obj, wrapper);\n  }\n  return wrapper;\n}\n","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\nimport * as utils from '../utils.js';\nimport {flush} from '../flush.js';\nimport {addEventListener, removeEventListener} from '../patch-events.js';\n\nexport const EventTargetPatches = utils.getOwnPropertyDescriptors({\n\n  /** @this {Node} */\n  dispatchEvent(event) {\n    flush();\n    return this[utils.NATIVE_PREFIX + 'dispatchEvent'](event);\n  },\n\n  addEventListener,\n\n  removeEventListener\n\n});","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\nimport * as utils from '../utils.js';\nimport {shadyDataForNode} from '../shady-data.js';\n\nexport const SlotablePatches = utils.getOwnPropertyDescriptors({\n\n  /** @this {Node} */\n  get assignedSlot() {\n    // Force any parent's shadowRoot to flush so that distribution occurs\n    // and this node has an assignedSlot.\n    const parent = this[utils.SHADY_PREFIX + 'parentNode'];\n    const ownerRoot = parent && parent[utils.SHADY_PREFIX + 'shadowRoot'];\n    if (ownerRoot) {\n      ownerRoot._render();\n    }\n    const nodeData = shadyDataForNode(this);\n    return nodeData && nodeData.assignedSlot || null;\n  }\n\n});\n","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\nimport * as utils from '../utils.js';\nimport {scopeClassAttribute} from '../style-scoping.js';\nimport {shadyDataForNode} from '../shady-data.js';\nimport {attachShadow, ownerShadyRootForNode} from '../attach-shadow.js';\n\nconst doc = window.document;\n\n/**\n * Should be called whenever an attribute changes. If the `slot` attribute\n * changes, provokes rendering if necessary. If a `<slot>` element's `name`\n * attribute changes, updates the root's slot map and renders.\n * @param {Node} node\n * @param {string} name\n */\nfunction distributeAttributeChange(node, name) {\n  if (name === 'slot') {\n    const parent = node[utils.SHADY_PREFIX + 'parentNode'];\n    if (utils.hasShadowRootWithSlot(parent)) {\n      shadyDataForNode(parent).root._asyncRender();\n    }\n  } else if (node.localName === 'slot' && name === 'name') {\n    let root = ownerShadyRootForNode(node);\n    if (root) {\n      root._updateSlotName(node);\n      root._asyncRender();\n    }\n  }\n}\n\nexport const ElementPatches = utils.getOwnPropertyDescriptors({\n\n  /** @this {Element} */\n  get previousElementSibling() {\n    const nodeData = shadyDataForNode(this);\n    if (nodeData && nodeData.previousSibling !== undefined) {\n      let n = this[utils.SHADY_PREFIX + 'previousSibling'];\n      while (n && n.nodeType !== Node.ELEMENT_NODE) {\n        n = n[utils.SHADY_PREFIX + 'previousSibling'];\n      }\n      return n;\n    } else {\n      return this[utils.NATIVE_PREFIX + 'previousElementSibling'];\n    }\n  },\n\n  /** @this {Element} */\n  get nextElementSibling() {\n    const nodeData = shadyDataForNode(this);\n    if (nodeData && nodeData.nextSibling !== undefined) {\n      let n = this[utils.SHADY_PREFIX + 'nextSibling'];\n      while (n && n.nodeType !== Node.ELEMENT_NODE) {\n        n = n[utils.SHADY_PREFIX + 'nextSibling'];\n      }\n      return n;\n    } else {\n      return this[utils.NATIVE_PREFIX + 'nextElementSibling'];\n    }\n  },\n\n  /** @this {Element} */\n  get slot() {\n    return this.getAttribute('slot');\n  },\n\n  /** @this {Element} */\n  set slot(value) {\n    this[utils.SHADY_PREFIX + 'setAttribute']('slot', value);\n  },\n\n  // Note: Can be patched on element prototype on all browsers.\n  // Must be patched on instance on browsers that support native Shadow DOM\n  // but do not have builtin accessors (old Chrome).\n  /** @this {Element} */\n  get shadowRoot() {\n    const nodeData = shadyDataForNode(this);\n    return nodeData && nodeData.publicRoot || null;\n  },\n\n  /** @this {Element} */\n  get className() {\n    return this.getAttribute('class') || '';\n  },\n\n  /**\n   * @this {Element}\n   * @param {string} value\n   */\n  set className(value) {\n    this[utils.SHADY_PREFIX + 'setAttribute']('class', value);\n  },\n\n  /**\n   * @this {Element}\n   * @param {string} attr\n   * @param {string} value\n   */\n  setAttribute(attr, value) {\n    if (this.ownerDocument !== doc) {\n      this[utils.NATIVE_PREFIX + 'setAttribute'](attr, value);\n    } else if (!scopeClassAttribute(this, attr, value)) {\n      this[utils.NATIVE_PREFIX + 'setAttribute'](attr, value);\n      distributeAttributeChange(this, attr);\n    }\n  },\n\n  /**\n   * @this {Element}\n   * @param {string} attr\n   */\n  removeAttribute(attr) {\n    this[utils.NATIVE_PREFIX + 'removeAttribute'](attr);\n    distributeAttributeChange(this, attr);\n  },\n\n  /**\n   * @this {Element}\n   * @param {!{mode: string}} options\n   */\n  attachShadow(options) {\n    return attachShadow(this, options);\n  }\n\n});\n","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\nimport * as utils from '../utils.js';\nimport {eventPropertyNames} from '../patch-events.js';\nimport {shadyDataForNode, ensureShadyDataForNode} from '../shady-data.js';\n\nexport const HTMLElementPatches = utils.getOwnPropertyDescriptors({\n\n  /** @this {HTMLElement} */\n  blur() {\n    const nodeData = shadyDataForNode(this);\n    let root = nodeData && nodeData.root;\n    let shadowActive = root && root.activeElement;\n    if (shadowActive) {\n      shadowActive[utils.SHADY_PREFIX + 'blur']();\n    } else {\n      this[utils.NATIVE_PREFIX + 'blur']();\n    }\n  }\n\n});\n\neventPropertyNames.forEach(property => {\n  HTMLElementPatches[property] = {\n    /** @this {HTMLElement} */\n    set: function(fn) {\n      const shadyData = ensureShadyDataForNode(this);\n      const eventName = property.substring(2);\n      shadyData.__onCallbackListeners[property] && this.removeEventListener(eventName, shadyData.__onCallbackListeners[property]);\n      this[utils.SHADY_PREFIX + 'addEventListener'](eventName, fn);\n      shadyData.__onCallbackListeners[property] = fn;\n    },\n    /** @this {HTMLElement} */\n    get() {\n      const shadyData = shadyDataForNode(this);\n      return shadyData && shadyData.__onCallbackListeners[property];\n    },\n    configurable: true\n  };\n});\n\n","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\nimport * as utils from '../utils.js';\nimport {shadyDataForNode} from '../shady-data.js';\n\nexport const SlotPatches = utils.getOwnPropertyDescriptors({\n\n  /**\n   * @this {HTMLSlotElement}\n   * @param {Object=} options\n   */\n  assignedNodes(options) {\n    if (this.localName === 'slot') {\n      // Force any containing shadowRoot to flush so that distribution occurs\n      // and this node has assignedNodes.\n      const root = this[utils.SHADY_PREFIX + 'getRootNode']();\n      if (root && utils.isShadyRoot(root)) {\n        root._render();\n      }\n      const nodeData = shadyDataForNode(this);\n      return nodeData ?\n        ((options && options.flatten ? nodeData.flattenedNodes :\n          nodeData.assignedNodes) || []) :\n        [];\n    }\n  }\n\n});\n","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\nimport * as utils from '../utils.js';\n\nconst doc = window.document;\n\nexport const DocumentPatches = utils.getOwnPropertyDescriptors({\n\n  // note: Though not technically correct, we fast path `importNode`\n  // when called on a node not owned by the main document.\n  // This allows, for example, elements that cannot\n  // contain custom elements and are therefore not likely to contain shadowRoots\n  // to cloned natively. This is a fairly significant performance win.\n  /**\n   * @this {Document}\n   * @param {Node} node\n   * @param {boolean} deep\n   */\n  importNode(node, deep) {\n    // A template element normally has no children with shadowRoots, so make\n    // sure we always make a deep copy to correctly construct the template.content\n    if (node.ownerDocument !== doc || node.localName === 'template') {\n      return this[utils.NATIVE_PREFIX + 'importNode'](node, deep);\n    }\n    let n = this[utils.NATIVE_PREFIX + 'importNode'](node, false);\n    if (deep) {\n      let c$ = node[utils.SHADY_PREFIX + 'childNodes'];\n      for (let i=0, nc; i < c$.length; i++) {\n        nc = this[utils.SHADY_PREFIX + 'importNode'](c$[i], true);\n        n[utils.SHADY_PREFIX + 'appendChild'](nc);\n      }\n    }\n    return n;\n  }\n\n});","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\nimport * as utils from '../utils.js';\nimport {addEventListener, removeEventListener} from '../patch-events.js';\n\nexport const WindowPatches = utils.getOwnPropertyDescriptors({\n\n  // NOTE: ensure these methods are bound to `window` so that `this` is correct\n  // when called directly from global context without a receiver; e.g.\n  // `addEventListener(...)`.\n  addEventListener: addEventListener.bind(window),\n\n  removeEventListener: removeEventListener.bind(window)\n\n});","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\nimport * as utils from './utils.js';\nimport {EventTargetPatches} from './patches/EventTarget.js';\nimport {NodePatches} from './patches/Node.js';\nimport {SlotablePatches} from './patches/Slotable.js';\nimport {ParentNodePatches, ParentNodeDocumentOrFragmentPatches} from './patches/ParentNode.js';\nimport {ElementPatches} from './patches/Element.js';\nimport {ElementOrShadowRootPatches} from './patches/ElementOrShadowRoot.js';\nimport {HTMLElementPatches} from './patches/HTMLElement.js';\nimport {SlotPatches} from './patches/Slot.js';\nimport {DocumentOrFragmentPatches} from './patches/DocumentOrFragment.js';\nimport {DocumentOrShadowRootPatches} from './patches/DocumentOrShadowRoot.js';\nimport {DocumentPatches} from './patches/Document.js';\nimport {WindowPatches} from './patches/Window.js';\n\n// Some browsers (IE/Edge) have non-standard HTMLElement accessors.\nconst NonStandardHTMLElement = {};\n\nif (Object.getOwnPropertyDescriptor(HTMLElement.prototype, 'parentElement')) {\n  NonStandardHTMLElement.parentElement = NodePatches.parentElement;\n}\n\nif (Object.getOwnPropertyDescriptor(HTMLElement.prototype, 'contains')) {\n  NonStandardHTMLElement.contains = NodePatches.contains;\n}\n\nif (Object.getOwnPropertyDescriptor(HTMLElement.prototype, 'children')) {\n  NonStandardHTMLElement.children = ParentNodePatches.children;\n}\n\nif (Object.getOwnPropertyDescriptor(HTMLElement.prototype, 'innerHTML')) {\n  NonStandardHTMLElement.innerHTML = ElementOrShadowRootPatches.innerHTML;\n}\n\nif (Object.getOwnPropertyDescriptor(HTMLElement.prototype, 'className')) {\n  NonStandardHTMLElement.className = ElementPatches.className;\n}\n\n// Avoid patching `innerHTML` if it does not exist on Element (IE)\n// and we can patch accessors (hasDescriptors).\nconst ElementShouldHaveInnerHTML = !utils.settings.hasDescriptors || 'innerHTML' in Element.prototype;\n\n// setup patching\nconst patchMap = {\n  EventTarget: [EventTargetPatches],\n  Node: [NodePatches, !window.EventTarget ? EventTargetPatches : null],\n  Text: [SlotablePatches],\n  Element: [ElementPatches, ParentNodePatches, SlotablePatches,\n    ElementShouldHaveInnerHTML ? ElementOrShadowRootPatches : null,\n    !window.HTMLSlotElement ? SlotPatches : null],\n  HTMLElement: [HTMLElementPatches, NonStandardHTMLElement],\n  HTMLSlotElement: [SlotPatches],\n  DocumentFragment: [ParentNodeDocumentOrFragmentPatches, DocumentOrFragmentPatches],\n  Document: [DocumentPatches, ParentNodeDocumentOrFragmentPatches, DocumentOrFragmentPatches, DocumentOrShadowRootPatches],\n  Window: [WindowPatches]\n}\n\nconst getPatchPrototype = (name) => window[name] && window[name].prototype;\n\n// Note, must avoid patching accessors on prototypes when descriptors are not correct\n// because the CustomElements polyfill checks if these exist before patching instances.\n// CustomElements polyfill *only* cares about these accessors.\nconst disallowedNativePatches = utils.settings.hasDescriptors ? null : ['innerHTML', 'textContent'];\n\n/** @param {string=} prefix */\nexport const applyPatches = (prefix) => {\n  const disallowed = prefix ? null : disallowedNativePatches;\n  for (let p in patchMap) {\n    const proto = getPatchPrototype(p);\n    patchMap[p].forEach(patch => proto && patch &&\n        utils.patchProperties(proto, patch, prefix, disallowed));\n  }\n}\n\nexport const addShadyPrefixedProperties = () => {\n  // perform shady patches\n  applyPatches(utils.SHADY_PREFIX);\n\n  // install `_activeElement` because some browsers (older Chrome/Safari) do not have\n  // a 'configurable' `activeElement` accesssor.\n  const descriptor = DocumentOrShadowRootPatches.activeElement;\n  Object.defineProperty(document, '_activeElement', descriptor);\n\n  // On Window, we're patching `addEventListener` which is a weird auto-bound\n  // property that is not directly on the Window prototype.\n  utils.patchProperties(Window.prototype, WindowPatches, utils.SHADY_PREFIX);\n};\n","/**\n@license\nCopyright (c) 2016 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n/**\n * Patches elements that interacts with ShadyDOM\n * such that tree traversal and mutation apis act like they would under\n * ShadowDOM.\n *\n * This import enables seemless interaction with ShadyDOM powered\n * custom elements, enabling better interoperation with 3rd party code,\n * libraries, and frameworks that use DOM tree manipulation apis.\n */\n\nimport * as utils from './utils.js';\nimport {flush, enqueue} from './flush.js';\nimport {observeChildren, unobserveChildren, filterMutations} from './observe-changes.js';\nimport {addNativePrefixedProperties, nativeMethods, nativeTree} from './patch-native.js';\nimport {patchInsideElementAccessors, patchOutsideElementAccessors} from './patch-instances.js';\nimport {patchEvents, patchClick, composedPath} from './patch-events.js';\nimport {ShadyRoot} from './attach-shadow.js';\nimport {wrap, Wrapper} from './wrapper.js';\nimport {addShadyPrefixedProperties, applyPatches} from './patch-prototypes.js';\n\nif (utils.settings.inUse) {\n  let ShadyDOM = {\n    // TODO(sorvell): remove when Polymer does not depend on this.\n    'inUse': utils.settings.inUse,\n    // NOTE: old browsers without prototype accessors (very old Chrome\n    // and Safari) need manually patched accessors to properly set\n    // `innerHTML` and `textContent` when an element is:\n    // (1) inside a shadowRoot\n    // (2) does not have special (slot) children itself\n    // (3) and setting the property needs to provoke distribution (because\n    // a nested slot is added/removed)\n    'patch': (node) => {\n      patchInsideElementAccessors(node);\n      patchOutsideElementAccessors(node);\n      return node;\n    },\n    'isShadyRoot': utils.isShadyRoot,\n    'enqueue': enqueue,\n    'flush': flush,\n    'flushInitial': (root) => {\n      root._flushInitial();\n    },\n    'settings': utils.settings,\n    'filterMutations': filterMutations,\n    'observeChildren': observeChildren,\n    'unobserveChildren': unobserveChildren,\n    // Set to true to defer native custom elements connection until the\n    // document has fully parsed. This enables custom elements that create\n    // shadowRoots to be defined while the document is loading. Elements\n    // customized as they are created by the parser will successfully\n    // render with this flag on.\n    'deferConnectionCallbacks': utils.settings['deferConnectionCallbacks'],\n    // Set to true to speed up the polyfill slightly at the cost of correctness\n    // * does not patch querySelector/All on Document or DocumentFragment\n    // * does not wrap connected/disconnected callbacks to de-dup these\n    // when using native customElements\n    // * does not wait to process children of elements with shadowRoots\n    // meaning shadowRoots should not be created while an element is parsing\n    // (e.g. if a custom element that creates a shadowRoot is defined before\n    // a candidate element in the document below it.\n    'preferPerformance': utils.settings['preferPerformance'],\n    // Integration point with ShadyCSS to disable styling MutationObserver,\n    // as ShadyDOM will now handle dynamic scoping.\n    'handlesDynamicScoping': true,\n    'wrap': utils.settings.noPatch ? wrap : (n) => n,\n    'Wrapper': Wrapper,\n    'composedPath': composedPath,\n    // Set to true to avoid patching regular platform property names. When set,\n    // Shadow DOM compatible behavior is only available when accessing DOM\n    // API using `ShadyDOM.wrap`, e.g. `ShadyDOM.wrap(element).shadowRoot`.\n    // This setting provides a small performance boost, but requires all DOM API\n    // access that requires Shadow DOM behavior to be proxied via `ShadyDOM.wrap`.\n    'noPatch': utils.settings.noPatch,\n    'nativeMethods': nativeMethods,\n    'nativeTree': nativeTree\n  };\n\n  window['ShadyDOM'] = ShadyDOM;\n\n  // Modifies native prototypes for Node, Element, etc. to\n  // make native platform behavior available at prefixed names, e.g.\n  // `utils.NATIVE_PREFIX + 'firstChild'` or `__shady_native_firstChild`.\n  // This allows the standard names to be safely patched while retaining the\n  // ability for native behavior to be used. This polyfill manipulates DOM\n  // by using this saved native behavior.\n  // Note, some browsers do not have proper element descriptors for\n  // accessors; in this case, native behavior for these accessors is simulated\n  // via a TreeWalker.\n  addNativePrefixedProperties();\n\n  // Modifies native prototypes for Node, Element, etc. to make ShadowDOM\n  // behavior available at prefixed names, e.g.\n  // `utils.SHADY_PREFIX + 'firstChild` or `__shady_firstChild`. This is done\n  // so this polyfill can perform Shadow DOM style DOM manipulation.\n  // Because patching normal platform property names is optional, these prefixed\n  // names are used internally.\n  addShadyPrefixedProperties();\n\n  // Modifies native prototypes for Node, Element, etc. to patch\n  // regular platform property names to have Shadow DOM compatible API behavior.\n  // This applies the utils.SHADY_PREFIX behavior to normal names. For example,\n  // if `noPatch` is not set, then `el.__shady_firstChild` is equivalent to\n  // `el.firstChild`.\n  // NOTE, on older browsers (old Chrome/Safari) native accessors cannot be\n  // patched on prototypes (e.g. Node.prototype.firstChild cannot be modified).\n  // On these browsers, instance level patching is performed where needed; this\n  // instance patching is only done when `noPatch` is *not* set.\n  if (!utils.settings.noPatch) {\n    applyPatches();\n    // Patch click event behavior only if we're patching\n    patchClick()\n  }\n\n  // For simplicity, patch events unconditionally.\n  // Patches the event system to have Shadow DOM compatible behavior (e.g.\n  // event retargeting). When `noPatch` is set, retargeting is only available\n  // when adding event listeners and dispatching events via `ShadyDOM.wrap`\n  // (e.g. `ShadyDOM.wrap(element).addEventListener(...)`).\n  patchEvents();\n\n  window.ShadowRoot = /** @type {function(new:ShadowRoot)} */(ShadyRoot);\n}\n","const reservedTagList = new Set([\n  'annotation-xml',\n  'color-profile',\n  'font-face',\n  'font-face-src',\n  'font-face-uri',\n  'font-face-format',\n  'font-face-name',\n  'missing-glyph',\n]);\n\n/**\n * @param {string} localName\n * @returns {boolean}\n */\nexport function isValidCustomElementName(localName) {\n  const reserved = reservedTagList.has(localName);\n  const validForm = /^[a-z][.0-9_a-z]*-[\\-.0-9_a-z]*$/.test(localName);\n  return !reserved && validForm;\n}\n\n/**\n * @private\n * @param {!Node} node\n * @return {boolean}\n */\nexport function isConnected(node) {\n  // Use `Node#isConnected`, if defined.\n  const nativeValue = node.isConnected;\n  if (nativeValue !== undefined) {\n    return nativeValue;\n  }\n\n  /** @type {?Node|undefined} */\n  let current = node;\n  while (current && !(current.__CE_isImportDocument || current instanceof Document)) {\n    current = current.parentNode || (window.ShadowRoot && current instanceof ShadowRoot ? current.host : undefined);\n  }\n  return !!(current && (current.__CE_isImportDocument || current instanceof Document));\n}\n\n/**\n * @param {!Node} root\n * @param {!Node} start\n * @return {?Node}\n */\nfunction nextSiblingOrAncestorSibling(root, start) {\n  let node = start;\n  while (node && node !== root && !node.nextSibling) {\n    node = node.parentNode;\n  }\n  return (!node || node === root) ? null : node.nextSibling;\n}\n\n/**\n * @param {!Node} root\n * @param {!Node} start\n * @return {?Node}\n */\nfunction nextNode(root, start) {\n  return start.firstChild ? start.firstChild : nextSiblingOrAncestorSibling(root, start);\n}\n\n/**\n * @param {!Node} root\n * @param {!function(!Element)} callback\n * @param {!Set<Node>=} visitedImports\n */\nexport function walkDeepDescendantElements(root, callback, visitedImports = new Set()) {\n  let node = root;\n  while (node) {\n    if (node.nodeType === Node.ELEMENT_NODE) {\n      const element = /** @type {!Element} */(node);\n\n      callback(element);\n\n      const localName = element.localName;\n      if (localName === 'link' && element.getAttribute('rel') === 'import') {\n        // If this import (polyfilled or not) has it's root node available,\n        // walk it.\n        const importNode = /** @type {!Node} */ (element.import);\n        if (importNode instanceof Node && !visitedImports.has(importNode)) {\n          // Prevent multiple walks of the same import root.\n          visitedImports.add(importNode);\n\n          for (let child = importNode.firstChild; child; child = child.nextSibling) {\n            walkDeepDescendantElements(child, callback, visitedImports);\n          }\n        }\n\n        // Ignore descendants of import links to prevent attempting to walk the\n        // elements created by the HTML Imports polyfill that we just walked\n        // above.\n        node = nextSiblingOrAncestorSibling(root, element);\n        continue;\n      } else if (localName === 'template') {\n        // Ignore descendants of templates. There shouldn't be any descendants\n        // because they will be moved into `.content` during construction in\n        // browsers that support template but, in case they exist and are still\n        // waiting to be moved by a polyfill, they will be ignored.\n        node = nextSiblingOrAncestorSibling(root, element);\n        continue;\n      }\n\n      // Walk shadow roots.\n      const shadowRoot = element.__CE_shadowRoot;\n      if (shadowRoot) {\n        for (let child = shadowRoot.firstChild; child; child = child.nextSibling) {\n          walkDeepDescendantElements(child, callback, visitedImports);\n        }\n      }\n    }\n\n    node = nextNode(root, node);\n  }\n}\n\n/**\n * Used to suppress Closure's \"Modifying the prototype is only allowed if the\n * constructor is in the same scope\" warning without using\n * `@suppress {newCheckTypes, duplicate}` because `newCheckTypes` is too broad.\n *\n * @param {!Object} destination\n * @param {string} name\n * @param {*} value\n */\nexport function setPropertyUnchecked(destination, name, value) {\n  destination[name] = value;\n}\n","/**\n * @enum {number}\n */\nconst CustomElementState = {\n  custom: 1,\n  failed: 2,\n};\n\nexport default CustomElementState;\n","import * as Utilities from './Utilities.js';\nimport CEState from './CustomElementState.js';\n\nexport default class CustomElementInternals {\n  constructor() {\n    /** @type {!Map<string, !CustomElementDefinition>} */\n    this._localNameToDefinition = new Map();\n\n    /** @type {!Map<!Function, !CustomElementDefinition>} */\n    this._constructorToDefinition = new Map();\n\n    /** @type {!Array<!function(!Node)>} */\n    this._patches = [];\n\n    /** @type {boolean} */\n    this._hasPatches = false;\n  }\n\n  /**\n   * @param {string} localName\n   * @param {!CustomElementDefinition} definition\n   */\n  setDefinition(localName, definition) {\n    this._localNameToDefinition.set(localName, definition);\n    this._constructorToDefinition.set(definition.constructorFunction, definition);\n  }\n\n  /**\n   * @param {string} localName\n   * @return {!CustomElementDefinition|undefined}\n   */\n  localNameToDefinition(localName) {\n    return this._localNameToDefinition.get(localName);\n  }\n\n  /**\n   * @param {!Function} constructor\n   * @return {!CustomElementDefinition|undefined}\n   */\n  constructorToDefinition(constructor) {\n    return this._constructorToDefinition.get(constructor);\n  }\n\n  /**\n   * @param {!function(!Node)} listener\n   */\n  addPatch(listener) {\n    this._hasPatches = true;\n    this._patches.push(listener);\n  }\n\n  /**\n   * @param {!Node} node\n   */\n  patchTree(node) {\n    if (!this._hasPatches) return;\n\n    Utilities.walkDeepDescendantElements(node, element => this.patch(element));\n  }\n\n  /**\n   * @param {!Node} node\n   */\n  patch(node) {\n    if (!this._hasPatches) return;\n\n    if (node.__CE_patched) return;\n    node.__CE_patched = true;\n\n    for (let i = 0; i < this._patches.length; i++) {\n      this._patches[i](node);\n    }\n  }\n\n  /**\n   * @param {!Node} root\n   */\n  connectTree(root) {\n    const elements = [];\n\n    Utilities.walkDeepDescendantElements(root, element => elements.push(element));\n\n    for (let i = 0; i < elements.length; i++) {\n      const element = elements[i];\n      if (element.__CE_state === CEState.custom) {\n        this.connectedCallback(element);\n      } else {\n        this.upgradeElement(element);\n      }\n    }\n  }\n\n  /**\n   * @param {!Node} root\n   */\n  disconnectTree(root) {\n    const elements = [];\n\n    Utilities.walkDeepDescendantElements(root, element => elements.push(element));\n\n    for (let i = 0; i < elements.length; i++) {\n      const element = elements[i];\n      if (element.__CE_state === CEState.custom) {\n        this.disconnectedCallback(element);\n      }\n    }\n  }\n\n  /**\n   * Upgrades all uncustomized custom elements at and below a root node for\n   * which there is a definition. When custom element reaction callbacks are\n   * assumed to be called synchronously (which, by the current DOM / HTML spec\n   * definitions, they are *not*), callbacks for both elements customized\n   * synchronously by the parser and elements being upgraded occur in the same\n   * relative order.\n   *\n   * NOTE: This function, when used to simulate the construction of a tree that\n   * is already created but not customized (i.e. by the parser), does *not*\n   * prevent the element from reading the 'final' (true) state of the tree. For\n   * example, the element, during truly synchronous parsing / construction would\n   * see that it contains no children as they have not yet been inserted.\n   * However, this function does not modify the tree, the element will\n   * (incorrectly) have children. Additionally, self-modification restrictions\n   * for custom element constructors imposed by the DOM spec are *not* enforced.\n   *\n   *\n   * The following nested list shows the steps extending down from the HTML\n   * spec's parsing section that cause elements to be synchronously created and\n   * upgraded:\n   *\n   * The \"in body\" insertion mode:\n   * https://html.spec.whatwg.org/multipage/syntax.html#parsing-main-inbody\n   * - Switch on token:\n   *   .. other cases ..\n   *   -> Any other start tag\n   *      - [Insert an HTML element](below) for the token.\n   *\n   * Insert an HTML element:\n   * https://html.spec.whatwg.org/multipage/syntax.html#insert-an-html-element\n   * - Insert a foreign element for the token in the HTML namespace:\n   *   https://html.spec.whatwg.org/multipage/syntax.html#insert-a-foreign-element\n   *   - Create an element for a token:\n   *     https://html.spec.whatwg.org/multipage/syntax.html#create-an-element-for-the-token\n   *     - Will execute script flag is true?\n   *       - (Element queue pushed to the custom element reactions stack.)\n   *     - Create an element:\n   *       https://dom.spec.whatwg.org/#concept-create-element\n   *       - Sync CE flag is true?\n   *         - Constructor called.\n   *         - Self-modification restrictions enforced.\n   *       - Sync CE flag is false?\n   *         - (Upgrade reaction enqueued.)\n   *     - Attributes appended to element.\n   *       (`attributeChangedCallback` reactions enqueued.)\n   *     - Will execute script flag is true?\n   *       - (Element queue popped from the custom element reactions stack.\n   *         Reactions in the popped stack are invoked.)\n   *   - (Element queue pushed to the custom element reactions stack.)\n   *   - Insert the element:\n   *     https://dom.spec.whatwg.org/#concept-node-insert\n   *     - Shadow-including descendants are connected. During parsing\n   *       construction, there are no shadow-*excluding* descendants.\n   *       However, the constructor may have validly attached a shadow\n   *       tree to itself and added descendants to that shadow tree.\n   *       (`connectedCallback` reactions enqueued.)\n   *   - (Element queue popped from the custom element reactions stack.\n   *     Reactions in the popped stack are invoked.)\n   *\n   * @param {!Node} root\n   * @param {{\n   *   visitedImports: (!Set<!Node>|undefined),\n   *   upgrade: (!function(!Element)|undefined),\n   * }=} options\n   */\n  patchAndUpgradeTree(root, options = {}) {\n    const visitedImports = options.visitedImports || new Set();\n    const upgrade = options.upgrade || (element => this.upgradeElement(element));\n\n    const elements = [];\n\n    const gatherElements = element => {\n      if (element.localName === 'link' && element.getAttribute('rel') === 'import') {\n        // The HTML Imports polyfill sets a descendant element of the link to\n        // the `import` property, specifically this is *not* a Document.\n        const importNode = /** @type {?Node} */ (element.import);\n\n        if (importNode instanceof Node) {\n          importNode.__CE_isImportDocument = true;\n          // Connected links are associated with the registry.\n          importNode.__CE_hasRegistry = true;\n        }\n\n        if (importNode && importNode.readyState === 'complete') {\n          importNode.__CE_documentLoadHandled = true;\n        } else {\n          // If this link's import root is not available, its contents can't be\n          // walked. Wait for 'load' and walk it when it's ready.\n          element.addEventListener('load', () => {\n            const importNode = /** @type {!Node} */ (element.import);\n\n            if (importNode.__CE_documentLoadHandled) return;\n            importNode.__CE_documentLoadHandled = true;\n\n            // Clone the `visitedImports` set that was populated sync during\n            // the `patchAndUpgradeTree` call that caused this 'load' handler to\n            // be added. Then, remove *this* link's import node so that we can\n            // walk that import again, even if it was partially walked later\n            // during the same `patchAndUpgradeTree` call.\n            const clonedVisitedImports = new Set(visitedImports);\n            clonedVisitedImports.delete(importNode);\n\n            this.patchAndUpgradeTree(importNode, {visitedImports: clonedVisitedImports, upgrade});\n          });\n        }\n      } else {\n        elements.push(element);\n      }\n    };\n\n    // `walkDeepDescendantElements` populates (and internally checks against)\n    // `visitedImports` when traversing a loaded import.\n    Utilities.walkDeepDescendantElements(root, gatherElements, visitedImports);\n\n    if (this._hasPatches) {\n      for (let i = 0; i < elements.length; i++) {\n        this.patch(elements[i]);\n      }\n    }\n\n    for (let i = 0; i < elements.length; i++) {\n      upgrade(elements[i]);\n    }\n  }\n\n  /**\n   * @param {!HTMLElement} element\n   */\n  upgradeElement(element) {\n    const currentState = element.__CE_state;\n    if (currentState !== undefined) return;\n\n    // Prevent elements created in documents without a browsing context from\n    // upgrading.\n    //\n    // https://html.spec.whatwg.org/multipage/custom-elements.html#look-up-a-custom-element-definition\n    //   \"If document does not have a browsing context, return null.\"\n    //\n    // https://html.spec.whatwg.org/multipage/window-object.html#dom-document-defaultview\n    //   \"The defaultView IDL attribute of the Document interface, on getting,\n    //   must return this Document's browsing context's WindowProxy object, if\n    //   this Document has an associated browsing context, or null otherwise.\"\n    const ownerDocument = element.ownerDocument;\n    if (\n      !ownerDocument.defaultView &&\n      !(ownerDocument.__CE_isImportDocument && ownerDocument.__CE_hasRegistry)\n    ) return;\n\n    const definition = this.localNameToDefinition(element.localName);\n    if (!definition) return;\n\n    definition.constructionStack.push(element);\n\n    const constructor = definition.constructorFunction;\n    try {\n      try {\n        let result = new (constructor)();\n        if (result !== element) {\n          throw new Error('The custom element constructor did not produce the element being upgraded.');\n        }\n      } finally {\n        definition.constructionStack.pop();\n      }\n    } catch (e) {\n      element.__CE_state = CEState.failed;\n      throw e;\n    }\n\n    element.__CE_state = CEState.custom;\n    element.__CE_definition = definition;\n\n    if (definition.attributeChangedCallback) {\n      const observedAttributes = definition.observedAttributes;\n      for (let i = 0; i < observedAttributes.length; i++) {\n        const name = observedAttributes[i];\n        const value = element.getAttribute(name);\n        if (value !== null) {\n          this.attributeChangedCallback(element, name, null, value, null);\n        }\n      }\n    }\n\n    if (Utilities.isConnected(element)) {\n      this.connectedCallback(element);\n    }\n  }\n\n  /**\n   * @param {!Element} element\n   */\n  connectedCallback(element) {\n    const definition = element.__CE_definition;\n    if (definition.connectedCallback) {\n      definition.connectedCallback.call(element);\n    }\n  }\n\n  /**\n   * @param {!Element} element\n   */\n  disconnectedCallback(element) {\n    const definition = element.__CE_definition;\n    if (definition.disconnectedCallback) {\n      definition.disconnectedCallback.call(element);\n    }\n  }\n\n  /**\n   * @param {!Element} element\n   * @param {string} name\n   * @param {?string} oldValue\n   * @param {?string} newValue\n   * @param {?string} namespace\n   */\n  attributeChangedCallback(element, name, oldValue, newValue, namespace) {\n    const definition = element.__CE_definition;\n    if (\n      definition.attributeChangedCallback &&\n      definition.observedAttributes.indexOf(name) > -1\n    ) {\n      definition.attributeChangedCallback.call(element, name, oldValue, newValue, namespace);\n    }\n  }\n}\n","import CustomElementInternals from './CustomElementInternals.js';\n\nexport default class DocumentConstructionObserver {\n  constructor(internals, doc) {\n    /**\n     * @type {!CustomElementInternals}\n     */\n    this._internals = internals;\n\n    /**\n     * @type {!Document}\n     */\n    this._document = doc;\n\n    /**\n     * @type {MutationObserver|undefined}\n     */\n    this._observer = undefined;\n\n\n    // Simulate tree construction for all currently accessible nodes in the\n    // document.\n    this._internals.patchAndUpgradeTree(this._document);\n\n    if (this._document.readyState === 'loading') {\n      this._observer = new MutationObserver(this._handleMutations.bind(this));\n\n      // Nodes created by the parser are given to the observer *before* the next\n      // task runs. Inline scripts are run in a new task. This means that the\n      // observer will be able to handle the newly parsed nodes before the inline\n      // script is run.\n      this._observer.observe(this._document, {\n        childList: true,\n        subtree: true,\n      });\n    }\n  }\n\n  disconnect() {\n    if (this._observer) {\n      this._observer.disconnect();\n    }\n  }\n\n  /**\n   * @param {!Array<!MutationRecord>} mutations\n   */\n  _handleMutations(mutations) {\n    // Once the document's `readyState` is 'interactive' or 'complete', all new\n    // nodes created within that document will be the result of script and\n    // should be handled by patching.\n    const readyState = this._document.readyState;\n    if (readyState === 'interactive' || readyState === 'complete') {\n      this.disconnect();\n    }\n\n    for (let i = 0; i < mutations.length; i++) {\n      const addedNodes = mutations[i].addedNodes;\n      for (let j = 0; j < addedNodes.length; j++) {\n        const node = addedNodes[j];\n        this._internals.patchAndUpgradeTree(node);\n      }\n    }\n  }\n}\n","/**\n * @template T\n */\nexport default class Deferred {\n  constructor() {\n    /**\n     * @private\n     * @type {T|undefined}\n     */\n    this._value = undefined;\n\n    /**\n     * @private\n     * @type {Function|undefined}\n     */\n    this._resolve = undefined;\n\n    /**\n     * @private\n     * @type {!Promise<T>}\n     */\n    this._promise = new Promise(resolve => {\n      this._resolve = resolve;\n\n      if (this._value) {\n        resolve(this._value);\n      }\n    });\n  }\n\n  /**\n   * @param {T} value\n   */\n  resolve(value) {\n    if (this._value) {\n      throw new Error('Already resolved.');\n    }\n\n    this._value = value;\n\n    if (this._resolve) {\n      this._resolve(value);\n    }\n  }\n\n  /**\n   * @return {!Promise<T>}\n   */\n  toPromise() {\n    return this._promise;\n  }\n}\n","import CustomElementInternals from './CustomElementInternals.js';\nimport DocumentConstructionObserver from './DocumentConstructionObserver.js';\nimport Deferred from './Deferred.js';\nimport * as Utilities from './Utilities.js';\n\n/**\n * @unrestricted\n */\nexport default class CustomElementRegistry {\n\n  /**\n   * @param {!CustomElementInternals} internals\n   */\n  constructor(internals) {\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this._elementDefinitionIsRunning = false;\n\n    /**\n     * @private\n     * @type {!CustomElementInternals}\n     */\n    this._internals = internals;\n\n    /**\n     * @private\n     * @type {!Map<string, !Deferred<undefined>>}\n     */\n    this._whenDefinedDeferred = new Map();\n\n    /**\n     * The default flush callback triggers the document walk synchronously.\n     * @private\n     * @type {!Function}\n     */\n    this._flushCallback = fn => fn();\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this._flushPending = false;\n\n    /**\n     * @private\n     * @type {!Array<!CustomElementDefinition>}\n     */\n    this._pendingDefinitions = [];\n\n    /**\n     * @private\n     * @type {!DocumentConstructionObserver}\n     */\n    this._documentConstructionObserver = new DocumentConstructionObserver(internals, document);\n  }\n\n  /**\n   * @param {string} localName\n   * @param {!Function} constructor\n   */\n  define(localName, constructor) {\n    if (!(constructor instanceof Function)) {\n      throw new TypeError('Custom element constructors must be functions.');\n    }\n\n    if (!Utilities.isValidCustomElementName(localName)) {\n      throw new SyntaxError(`The element name '${localName}' is not valid.`);\n    }\n\n    if (this._internals.localNameToDefinition(localName)) {\n      throw new Error(`A custom element with name '${localName}' has already been defined.`);\n    }\n\n    if (this._elementDefinitionIsRunning) {\n      throw new Error('A custom element is already being defined.');\n    }\n    this._elementDefinitionIsRunning = true;\n\n    let connectedCallback;\n    let disconnectedCallback;\n    let adoptedCallback;\n    let attributeChangedCallback;\n    let observedAttributes;\n    try {\n      /** @type {!Object} */\n      const prototype = constructor.prototype;\n      if (!(prototype instanceof Object)) {\n        throw new TypeError('The custom element constructor\\'s prototype is not an object.');\n      }\n\n      function getCallback(name) {\n        const callbackValue = prototype[name];\n        if (callbackValue !== undefined && !(callbackValue instanceof Function)) {\n          throw new Error(`The '${name}' callback must be a function.`);\n        }\n        return callbackValue;\n      }\n\n      connectedCallback = getCallback('connectedCallback');\n      disconnectedCallback = getCallback('disconnectedCallback');\n      adoptedCallback = getCallback('adoptedCallback');\n      attributeChangedCallback = getCallback('attributeChangedCallback');\n      observedAttributes = constructor['observedAttributes'] || [];\n    } catch (e) {\n      return;\n    } finally {\n      this._elementDefinitionIsRunning = false;\n    }\n\n    const definition = {\n      localName,\n      constructorFunction: constructor,\n      connectedCallback,\n      disconnectedCallback,\n      adoptedCallback,\n      attributeChangedCallback,\n      observedAttributes,\n      constructionStack: [],\n    };\n\n    this._internals.setDefinition(localName, definition);\n    this._pendingDefinitions.push(definition);\n\n    // If we've already called the flush callback and it hasn't called back yet,\n    // don't call it again.\n    if (!this._flushPending) {\n      this._flushPending = true;\n      this._flushCallback(() => this._flush());\n    }\n  }\n\n  upgrade(element) {\n    this._internals.patchAndUpgradeTree(element);\n  }\n\n  _flush() {\n    // If no new definitions were defined, don't attempt to flush. This could\n    // happen if a flush callback keeps the function it is given and calls it\n    // multiple times.\n    if (this._flushPending === false) return;\n    this._flushPending = false;\n\n    const pendingDefinitions = this._pendingDefinitions;\n\n    /**\n     * Unupgraded elements with definitions that were defined *before* the last\n     * flush, in document order.\n     * @type {!Array<!HTMLElement>}\n     */\n    const elementsWithStableDefinitions = [];\n\n    /**\n     * A map from `localName`s of definitions that were defined *after* the last\n     * flush to unupgraded elements matching that definition, in document order.\n     * @type {!Map<string, !Array<!HTMLElement>>}\n     */\n    const elementsWithPendingDefinitions = new Map();\n    for (let i = 0; i < pendingDefinitions.length; i++) {\n      elementsWithPendingDefinitions.set(pendingDefinitions[i].localName, []);\n    }\n\n    this._internals.patchAndUpgradeTree(document, {\n      upgrade: element => {\n        // Ignore the element if it has already upgraded or failed to upgrade.\n        if (element.__CE_state !== undefined) return;\n\n        const localName = element.localName;\n\n        // If there is an applicable pending definition for the element, add the\n        // element to the list of elements to be upgraded with that definition.\n        const pendingElements = elementsWithPendingDefinitions.get(localName);\n        if (pendingElements) {\n          pendingElements.push(element);\n        // If there is *any other* applicable definition for the element, add it\n        // to the list of elements with stable definitions that need to be upgraded.\n        } else if (this._internals.localNameToDefinition(localName)) {\n          elementsWithStableDefinitions.push(element);\n        }\n      },\n    });\n\n    // Upgrade elements with 'stable' definitions first.\n    for (let i = 0; i < elementsWithStableDefinitions.length; i++) {\n      this._internals.upgradeElement(elementsWithStableDefinitions[i]);\n    }\n\n    // Upgrade elements with 'pending' definitions in the order they were defined.\n    while (pendingDefinitions.length > 0) {\n      const definition = pendingDefinitions.shift();\n      const localName = definition.localName;\n\n      // Attempt to upgrade all applicable elements.\n      const pendingUpgradableElements = elementsWithPendingDefinitions.get(definition.localName);\n      for (let i = 0; i < pendingUpgradableElements.length; i++) {\n        this._internals.upgradeElement(pendingUpgradableElements[i]);\n      }\n\n      // Resolve any promises created by `whenDefined` for the definition.\n      const deferred = this._whenDefinedDeferred.get(localName);\n      if (deferred) {\n        deferred.resolve(undefined);\n      }\n    }\n  }\n\n  /**\n   * @param {string} localName\n   * @return {Function|undefined}\n   */\n  get(localName) {\n    const definition = this._internals.localNameToDefinition(localName);\n    if (definition) {\n      return definition.constructorFunction;\n    }\n\n    return undefined;\n  }\n\n  /**\n   * @param {string} localName\n   * @return {!Promise<undefined>}\n   */\n  whenDefined(localName) {\n    if (!Utilities.isValidCustomElementName(localName)) {\n      return Promise.reject(new SyntaxError(`'${localName}' is not a valid custom element name.`));\n    }\n\n    const prior = this._whenDefinedDeferred.get(localName);\n    if (prior) {\n      return prior.toPromise();\n    }\n\n    const deferred = new Deferred();\n    this._whenDefinedDeferred.set(localName, deferred);\n\n    const definition = this._internals.localNameToDefinition(localName);\n    // Resolve immediately only if the given local name has a definition *and*\n    // the full document walk to upgrade elements with that local name has\n    // already happened.\n    if (definition && !this._pendingDefinitions.some(d => d.localName === localName)) {\n      deferred.resolve(undefined);\n    }\n\n    return deferred.toPromise();\n  }\n\n  polyfillWrapFlushCallback(outer) {\n    this._documentConstructionObserver.disconnect();\n    const inner = this._flushCallback;\n    this._flushCallback = flush => outer(() => inner(flush));\n  }\n}\n\n// Closure compiler exports.\nwindow['CustomElementRegistry'] = CustomElementRegistry;\nCustomElementRegistry.prototype['define'] = CustomElementRegistry.prototype.define;\nCustomElementRegistry.prototype['upgrade'] = CustomElementRegistry.prototype.upgrade;\nCustomElementRegistry.prototype['get'] = CustomElementRegistry.prototype.get;\nCustomElementRegistry.prototype['whenDefined'] = CustomElementRegistry.prototype.whenDefined;\nCustomElementRegistry.prototype['polyfillWrapFlushCallback'] = CustomElementRegistry.prototype.polyfillWrapFlushCallback;\n","export default {\n  Document_createElement: window.Document.prototype.createElement,\n  Document_createElementNS: window.Document.prototype.createElementNS,\n  Document_importNode: window.Document.prototype.importNode,\n  Document_prepend: window.Document.prototype['prepend'],\n  Document_append: window.Document.prototype['append'],\n  DocumentFragment_prepend: window.DocumentFragment.prototype['prepend'],\n  DocumentFragment_append: window.DocumentFragment.prototype['append'],\n  Node_cloneNode: window.Node.prototype.cloneNode,\n  Node_appendChild: window.Node.prototype.appendChild,\n  Node_insertBefore: window.Node.prototype.insertBefore,\n  Node_removeChild: window.Node.prototype.removeChild,\n  Node_replaceChild: window.Node.prototype.replaceChild,\n  Node_textContent: Object.getOwnPropertyDescriptor(window.Node.prototype, 'textContent'),\n  Element_attachShadow: window.Element.prototype['attachShadow'],\n  Element_innerHTML: Object.getOwnPropertyDescriptor(window.Element.prototype, 'innerHTML'),\n  Element_getAttribute: window.Element.prototype.getAttribute,\n  Element_setAttribute: window.Element.prototype.setAttribute,\n  Element_removeAttribute: window.Element.prototype.removeAttribute,\n  Element_getAttributeNS: window.Element.prototype.getAttributeNS,\n  Element_setAttributeNS: window.Element.prototype.setAttributeNS,\n  Element_removeAttributeNS: window.Element.prototype.removeAttributeNS,\n  Element_insertAdjacentElement: window.Element.prototype['insertAdjacentElement'],\n  Element_insertAdjacentHTML: window.Element.prototype['insertAdjacentHTML'],\n  Element_prepend: window.Element.prototype['prepend'],\n  Element_append: window.Element.prototype['append'],\n  Element_before: window.Element.prototype['before'],\n  Element_after: window.Element.prototype['after'],\n  Element_replaceWith: window.Element.prototype['replaceWith'],\n  Element_remove: window.Element.prototype['remove'],\n  HTMLElement: window.HTMLElement,\n  HTMLElement_innerHTML: Object.getOwnPropertyDescriptor(window.HTMLElement.prototype, 'innerHTML'),\n  HTMLElement_insertAdjacentElement: window.HTMLElement.prototype['insertAdjacentElement'],\n  HTMLElement_insertAdjacentHTML: window.HTMLElement.prototype['insertAdjacentHTML'],\n};\n","/**\n * This class exists only to work around Closure's lack of a way to describe\n * singletons. It represents the 'already constructed marker' used in custom\n * element construction stacks.\n *\n * https://html.spec.whatwg.org/#concept-already-constructed-marker\n * @extends AlreadyConstructedMarkerType\n */\nclass AlreadyConstructedMarker {}\n\nexport default new AlreadyConstructedMarker();\n","import Native from './Native.js';\nimport CustomElementInternals from '../CustomElementInternals.js';\nimport CEState from '../CustomElementState.js';\nimport AlreadyConstructedMarker from '../AlreadyConstructedMarker.js';\n\n/**\n * @param {!CustomElementInternals} internals\n */\nexport default function(internals) {\n  window['HTMLElement'] = (function() {\n    /**\n     * @type {function(new: HTMLElement): !HTMLElement}\n     */\n    function HTMLElement() {\n      // This should really be `new.target` but `new.target` can't be emulated\n      // in ES5. Assuming the user keeps the default value of the constructor's\n      // prototype's `constructor` property, this is equivalent.\n      const constructor = /** @type {!Function} */ (this.constructor);\n\n      const definition = internals.constructorToDefinition(constructor);\n      if (!definition) {\n        throw new Error('The custom element being constructed was not registered with `customElements`.');\n      }\n\n      const constructionStack = definition.constructionStack;\n\n      if (constructionStack.length === 0) {\n        const element = /** @type {!HTMLElement} */ (Native.Document_createElement.call(document, definition.localName));\n        Object.setPrototypeOf(element, constructor.prototype);\n        element.__CE_state = CEState.custom;\n        element.__CE_definition = definition;\n        internals.patch(element);\n        return element;\n      }\n\n      const lastIndex = constructionStack.length - 1;\n      const element = constructionStack[lastIndex];\n      if (element === AlreadyConstructedMarker) {\n        throw new Error('The HTMLElement constructor was either called reentrantly for this constructor or called multiple times.');\n      }\n      const toConstructElement = /** @type {!HTMLElement} */ (element);\n      constructionStack[lastIndex] = AlreadyConstructedMarker;\n\n      Object.setPrototypeOf(toConstructElement, constructor.prototype);\n      internals.patch(toConstructElement);\n\n      return toConstructElement;\n    }\n\n    HTMLElement.prototype = Native.HTMLElement.prototype;\n    // Safari 9 has `writable: false` on the propertyDescriptor\n    // Make it writable so that TypeScript can patch up the\n    // constructor in the ES5 compiled code.\n    Object.defineProperty(HTMLElement.prototype, 'constructor', {\n      writable: true,\n      configurable: true,\n      enumerable: false,\n      value: HTMLElement\n    });\n\n    return HTMLElement;\n  })();\n};\n","import CustomElementInternals from '../../CustomElementInternals.js';\nimport * as Utilities from '../../Utilities.js';\n\n/**\n * @typedef {{\n *   prepend: !function(...(!Node|string)),\n  *  append: !function(...(!Node|string)),\n * }}\n */\nlet ParentNodeNativeMethods;\n\n/**\n * @param {!CustomElementInternals} internals\n * @param {!Object} destination\n * @param {!ParentNodeNativeMethods} builtIn\n */\nexport default function(internals, destination, builtIn) {\n  /**\n   * @param {!function(...(!Node|string))} builtInMethod\n   * @return {!function(...(!Node|string))}\n   */\n  function appendPrependPatch(builtInMethod) {\n    return function(...nodes) {\n      /**\n       * A copy of `nodes`, with any DocumentFragment replaced by its children.\n       * @type {!Array<!Node>}\n       */\n      const flattenedNodes = [];\n\n      /**\n       * Elements in `nodes` that were connected before this call.\n       * @type {!Array<!Node>}\n       */\n      const connectedElements = [];\n\n      for (var i = 0; i < nodes.length; i++) {\n        const node = nodes[i];\n\n        if (node instanceof Element && Utilities.isConnected(node)) {\n          connectedElements.push(node);\n        }\n\n        if (node instanceof DocumentFragment) {\n          for (let child = node.firstChild; child; child = child.nextSibling) {\n            flattenedNodes.push(child);\n          }\n        } else {\n          flattenedNodes.push(node);\n        }\n      }\n\n      builtInMethod.apply(this, nodes);\n\n      for (let i = 0; i < connectedElements.length; i++) {\n        internals.disconnectTree(connectedElements[i]);\n      }\n\n      if (Utilities.isConnected(this)) {\n        for (let i = 0; i < flattenedNodes.length; i++) {\n          const node = flattenedNodes[i];\n          if (node instanceof Element) {\n            internals.connectTree(node);\n          }\n        }\n      }\n    };\n  }\n\n  if (builtIn.prepend !== undefined) {\n    Utilities.setPropertyUnchecked(destination, 'prepend', appendPrependPatch(builtIn.prepend));\n  }\n\n  if (builtIn.append !== undefined) {\n    Utilities.setPropertyUnchecked(destination, 'append', appendPrependPatch(builtIn.append));\n  }\n};\n","import Native from './Native.js';\nimport CustomElementInternals from '../CustomElementInternals.js';\nimport * as Utilities from '../Utilities.js';\n\nimport PatchParentNode from './Interface/ParentNode.js';\n\n/**\n * @param {!CustomElementInternals} internals\n */\nexport default function(internals) {\n  Utilities.setPropertyUnchecked(Document.prototype, 'createElement',\n    /**\n     * @this {Document}\n     * @param {string} localName\n     * @return {!Element}\n     */\n    function(localName) {\n      // Only create custom elements if this document is associated with the registry.\n      if (this.__CE_hasRegistry) {\n        const definition = internals.localNameToDefinition(localName);\n        if (definition) {\n          return new (definition.constructorFunction)();\n        }\n      }\n\n      const result = /** @type {!Element} */\n        (Native.Document_createElement.call(this, localName));\n      internals.patch(result);\n      return result;\n    });\n\n  Utilities.setPropertyUnchecked(Document.prototype, 'importNode',\n    /**\n     * @this {Document}\n     * @param {!Node} node\n     * @param {boolean=} deep\n     * @return {!Node}\n     */\n    function(node, deep) {\n      const clone = /** @type {!Node} */ (Native.Document_importNode.call(this, node, !!deep));\n      // Only create custom elements if this document is associated with the registry.\n      if (!this.__CE_hasRegistry) {\n        internals.patchTree(clone);\n      } else {\n        internals.patchAndUpgradeTree(clone);\n      }\n      return clone;\n    });\n\n  const NS_HTML = \"http://www.w3.org/1999/xhtml\";\n\n  Utilities.setPropertyUnchecked(Document.prototype, 'createElementNS',\n    /**\n     * @this {Document}\n     * @param {?string} namespace\n     * @param {string} localName\n     * @return {!Element}\n     */\n    function(namespace, localName) {\n      // Only create custom elements if this document is associated with the registry.\n      if (this.__CE_hasRegistry && (namespace === null || namespace === NS_HTML)) {\n        const definition = internals.localNameToDefinition(localName);\n        if (definition) {\n          return new (definition.constructorFunction)();\n        }\n      }\n\n      const result = /** @type {!Element} */\n        (Native.Document_createElementNS.call(this, namespace, localName));\n      internals.patch(result);\n      return result;\n    });\n\n  PatchParentNode(internals, Document.prototype, {\n    prepend: Native.Document_prepend,\n    append: Native.Document_append,\n  });\n};\n","import CustomElementInternals from '../CustomElementInternals.js';\nimport Native from './Native.js';\nimport PatchParentNode from './Interface/ParentNode.js';\n\n/**\n * @param {!CustomElementInternals} internals\n */\nexport default function(internals) {\n  PatchParentNode(internals, DocumentFragment.prototype, {\n    prepend: Native.DocumentFragment_prepend,\n    append: Native.DocumentFragment_append,\n  });\n};\n","import Native from './Native.js';\nimport CustomElementInternals from '../CustomElementInternals.js';\nimport * as Utilities from '../Utilities.js';\n\n/**\n * @param {!CustomElementInternals} internals\n */\nexport default function(internals) {\n  // `Node#nodeValue` is implemented on `Attr`.\n  // `Node#textContent` is implemented on `Attr`, `Element`.\n\n  Utilities.setPropertyUnchecked(Node.prototype, 'insertBefore',\n    /**\n     * @this {Node}\n     * @param {!Node} node\n     * @param {?Node} refNode\n     * @return {!Node}\n     */\n    function(node, refNode) {\n      if (node instanceof DocumentFragment) {\n        const insertedNodes = Array.prototype.slice.apply(node.childNodes);\n        const nativeResult = Native.Node_insertBefore.call(this, node, refNode);\n\n        // DocumentFragments can't be connected, so `disconnectTree` will never\n        // need to be called on a DocumentFragment's children after inserting it.\n\n        if (Utilities.isConnected(this)) {\n          for (let i = 0; i < insertedNodes.length; i++) {\n            internals.connectTree(insertedNodes[i]);\n          }\n        }\n\n        return nativeResult;\n      }\n\n      const nodeWasConnected = Utilities.isConnected(node);\n      const nativeResult = Native.Node_insertBefore.call(this, node, refNode);\n\n      if (nodeWasConnected) {\n        internals.disconnectTree(node);\n      }\n\n      if (Utilities.isConnected(this)) {\n        internals.connectTree(node);\n      }\n\n      return nativeResult;\n    });\n\n  Utilities.setPropertyUnchecked(Node.prototype, 'appendChild',\n    /**\n     * @this {Node}\n     * @param {!Node} node\n     * @return {!Node}\n     */\n    function(node) {\n      if (node instanceof DocumentFragment) {\n        const insertedNodes = Array.prototype.slice.apply(node.childNodes);\n        const nativeResult = Native.Node_appendChild.call(this, node);\n\n        // DocumentFragments can't be connected, so `disconnectTree` will never\n        // need to be called on a DocumentFragment's children after inserting it.\n\n        if (Utilities.isConnected(this)) {\n          for (let i = 0; i < insertedNodes.length; i++) {\n            internals.connectTree(insertedNodes[i]);\n          }\n        }\n\n        return nativeResult;\n      }\n\n      const nodeWasConnected = Utilities.isConnected(node);\n      const nativeResult = Native.Node_appendChild.call(this, node);\n\n      if (nodeWasConnected) {\n        internals.disconnectTree(node);\n      }\n\n      if (Utilities.isConnected(this)) {\n        internals.connectTree(node);\n      }\n\n      return nativeResult;\n    });\n\n  Utilities.setPropertyUnchecked(Node.prototype, 'cloneNode',\n    /**\n     * @this {Node}\n     * @param {boolean=} deep\n     * @return {!Node}\n     */\n    function(deep) {\n      const clone = Native.Node_cloneNode.call(this, !!deep);\n      // Only create custom elements if this element's owner document is\n      // associated with the registry.\n      if (!this.ownerDocument.__CE_hasRegistry) {\n        internals.patchTree(clone);\n      } else {\n        internals.patchAndUpgradeTree(clone);\n      }\n      return clone;\n    });\n\n  Utilities.setPropertyUnchecked(Node.prototype, 'removeChild',\n    /**\n     * @this {Node}\n     * @param {!Node} node\n     * @return {!Node}\n     */\n    function(node) {\n      const nodeWasConnected = Utilities.isConnected(node);\n      const nativeResult = Native.Node_removeChild.call(this, node);\n\n      if (nodeWasConnected) {\n        internals.disconnectTree(node);\n      }\n\n      return nativeResult;\n    });\n\n  Utilities.setPropertyUnchecked(Node.prototype, 'replaceChild',\n    /**\n     * @this {Node}\n     * @param {!Node} nodeToInsert\n     * @param {!Node} nodeToRemove\n     * @return {!Node}\n     */\n    function(nodeToInsert, nodeToRemove) {\n      if (nodeToInsert instanceof DocumentFragment) {\n        const insertedNodes = Array.prototype.slice.apply(nodeToInsert.childNodes);\n        const nativeResult = Native.Node_replaceChild.call(this, nodeToInsert, nodeToRemove);\n\n        // DocumentFragments can't be connected, so `disconnectTree` will never\n        // need to be called on a DocumentFragment's children after inserting it.\n\n        if (Utilities.isConnected(this)) {\n          internals.disconnectTree(nodeToRemove);\n          for (let i = 0; i < insertedNodes.length; i++) {\n            internals.connectTree(insertedNodes[i]);\n          }\n        }\n\n        return nativeResult;\n      }\n\n      const nodeToInsertWasConnected = Utilities.isConnected(nodeToInsert);\n      const nativeResult = Native.Node_replaceChild.call(this, nodeToInsert, nodeToRemove);\n      const thisIsConnected = Utilities.isConnected(this);\n\n      if (thisIsConnected) {\n        internals.disconnectTree(nodeToRemove);\n      }\n\n      if (nodeToInsertWasConnected) {\n        internals.disconnectTree(nodeToInsert);\n      }\n\n      if (thisIsConnected) {\n        internals.connectTree(nodeToInsert);\n      }\n\n      return nativeResult;\n    });\n\n\n  function patch_textContent(destination, baseDescriptor) {\n    Object.defineProperty(destination, 'textContent', {\n      enumerable: baseDescriptor.enumerable,\n      configurable: true,\n      get: baseDescriptor.get,\n      set: /** @this {Node} */ function(assignedValue) {\n        // If this is a text node then there are no nodes to disconnect.\n        if (this.nodeType === Node.TEXT_NODE) {\n          baseDescriptor.set.call(this, assignedValue);\n          return;\n        }\n\n        let removedNodes = undefined;\n        // Checking for `firstChild` is faster than reading `childNodes.length`\n        // to compare with 0.\n        if (this.firstChild) {\n          // Using `childNodes` is faster than `children`, even though we only\n          // care about elements.\n          const childNodes = this.childNodes;\n          const childNodesLength = childNodes.length;\n          if (childNodesLength > 0 && Utilities.isConnected(this)) {\n            // Copying an array by iterating is faster than using slice.\n            removedNodes = new Array(childNodesLength);\n            for (let i = 0; i < childNodesLength; i++) {\n              removedNodes[i] = childNodes[i];\n            }\n          }\n        }\n\n        baseDescriptor.set.call(this, assignedValue);\n\n        if (removedNodes) {\n          for (let i = 0; i < removedNodes.length; i++) {\n            internals.disconnectTree(removedNodes[i]);\n          }\n        }\n      },\n    });\n  }\n\n  if (Native.Node_textContent && Native.Node_textContent.get) {\n    patch_textContent(Node.prototype, Native.Node_textContent);\n  } else {\n    internals.addPatch(function(element) {\n      patch_textContent(element, {\n        enumerable: true,\n        configurable: true,\n        // NOTE: This implementation of the `textContent` getter assumes that\n        // text nodes' `textContent` getter will not be patched.\n        get: /** @this {Node} */ function() {\n          /** @type {!Array<string>} */\n          const parts = [];\n\n          for (let i = 0; i < this.childNodes.length; i++) {\n            parts.push(this.childNodes[i].textContent);\n          }\n\n          return parts.join('');\n        },\n        set: /** @this {Node} */ function(assignedValue) {\n          while (this.firstChild) {\n            Native.Node_removeChild.call(this, this.firstChild);\n          }\n          Native.Node_appendChild.call(this, document.createTextNode(assignedValue));\n        },\n      });\n    });\n  }\n};\n","import CustomElementInternals from '../../CustomElementInternals.js';\nimport * as Utilities from '../../Utilities.js';\n\n/**\n * @typedef {{\n *   before: !function(...(!Node|string)),\n *   after: !function(...(!Node|string)),\n *   replaceWith: !function(...(!Node|string)),\n *   remove: !function(),\n * }}\n */\nlet ChildNodeNativeMethods;\n\n/**\n * @param {!CustomElementInternals} internals\n * @param {!Object} destination\n * @param {!ChildNodeNativeMethods} builtIn\n */\nexport default function(internals, destination, builtIn) {\n  /**\n   * @param {!function(...(!Node|string))} builtInMethod\n   * @return {!function(...(!Node|string))}\n   */\n  function beforeAfterPatch(builtInMethod) {\n    return function(...nodes) {\n      /**\n       * A copy of `nodes`, with any DocumentFragment replaced by its children.\n       * @type {!Array<!Node>}\n       */\n      const flattenedNodes = [];\n\n      /**\n       * Elements in `nodes` that were connected before this call.\n       * @type {!Array<!Node>}\n       */\n      const connectedElements = [];\n\n      for (var i = 0; i < nodes.length; i++) {\n        const node = nodes[i];\n\n        if (node instanceof Element && Utilities.isConnected(node)) {\n          connectedElements.push(node);\n        }\n\n        if (node instanceof DocumentFragment) {\n          for (let child = node.firstChild; child; child = child.nextSibling) {\n            flattenedNodes.push(child);\n          }\n        } else {\n          flattenedNodes.push(node);\n        }\n      }\n\n      builtInMethod.apply(this, nodes);\n\n      for (let i = 0; i < connectedElements.length; i++) {\n        internals.disconnectTree(connectedElements[i]);\n      }\n\n      if (Utilities.isConnected(this)) {\n        for (let i = 0; i < flattenedNodes.length; i++) {\n          const node = flattenedNodes[i];\n          if (node instanceof Element) {\n            internals.connectTree(node);\n          }\n        }\n      }\n    };\n  }\n\n  if (builtIn.before !== undefined) {\n    Utilities.setPropertyUnchecked(destination, 'before', beforeAfterPatch(builtIn.before));\n  }\n\n  if (builtIn.before !== undefined) {\n    Utilities.setPropertyUnchecked(destination, 'after', beforeAfterPatch(builtIn.after));\n  }\n\n  if (builtIn.replaceWith !== undefined) {\n    Utilities.setPropertyUnchecked(destination, 'replaceWith',\n      /**\n       * @param {...(!Node|string)} nodes\n       */\n      function(...nodes) {\n        /**\n         * A copy of `nodes`, with any DocumentFragment replaced by its children.\n         * @type {!Array<!Node|string>}\n         */\n        const flattenedNodes = [];\n\n        /**\n         * Elements in `nodes` that were connected before this call.\n         * @type {!Array<!Node>}\n         */\n        const connectedElements = [];\n\n        for (var i = 0; i < nodes.length; i++) {\n          const node = nodes[i];\n\n          if (node instanceof Element && Utilities.isConnected(node)) {\n            connectedElements.push(node);\n          }\n\n          if (node instanceof DocumentFragment) {\n            for (let child = node.firstChild; child; child = child.nextSibling) {\n              flattenedNodes.push(child);\n            }\n          } else {\n            flattenedNodes.push(node);\n          }\n        }\n\n        const wasConnected = Utilities.isConnected(this);\n\n        builtIn.replaceWith.apply(this, nodes);\n\n        for (let i = 0; i < connectedElements.length; i++) {\n          internals.disconnectTree(connectedElements[i]);\n        }\n\n        if (wasConnected) {\n          internals.disconnectTree(this);\n          for (let i = 0; i < flattenedNodes.length; i++) {\n            const node = flattenedNodes[i];\n            if (node instanceof Element) {\n              internals.connectTree(node);\n            }\n          }\n        }\n      });\n    }\n\n  if (builtIn.remove !== undefined) {\n    Utilities.setPropertyUnchecked(destination, 'remove',\n      function() {\n        const wasConnected = Utilities.isConnected(this);\n\n        builtIn.remove.call(this);\n\n        if (wasConnected) {\n          internals.disconnectTree(this);\n        }\n      });\n  }\n};\n","import Native from './Native.js';\nimport CustomElementInternals from '../CustomElementInternals.js';\nimport CEState from '../CustomElementState.js';\nimport * as Utilities from '../Utilities.js';\n\nimport PatchParentNode from './Interface/ParentNode.js';\nimport PatchChildNode from './Interface/ChildNode.js';\n\n/**\n * @param {!CustomElementInternals} internals\n */\nexport default function(internals) {\n  if (Native.Element_attachShadow) {\n    Utilities.setPropertyUnchecked(Element.prototype, 'attachShadow',\n      /**\n       * @this {Element}\n       * @param {!{mode: string}} init\n       * @return {ShadowRoot}\n       */\n      function(init) {\n        const shadowRoot = Native.Element_attachShadow.call(this, init);\n        this.__CE_shadowRoot = shadowRoot;\n        return shadowRoot;\n      });\n  }\n\n\n  function patch_innerHTML(destination, baseDescriptor) {\n    Object.defineProperty(destination, 'innerHTML', {\n      enumerable: baseDescriptor.enumerable,\n      configurable: true,\n      get: baseDescriptor.get,\n      set: /** @this {Element} */ function(htmlString) {\n        const isConnected = Utilities.isConnected(this);\n\n        // NOTE: In IE11, when using the native `innerHTML` setter, all nodes\n        // that were previously descendants of the context element have all of\n        // their children removed as part of the set - the entire subtree is\n        // 'disassembled'. This work around walks the subtree *before* using the\n        // native setter.\n        /** @type {!Array<!Element>|undefined} */\n        let removedElements = undefined;\n        if (isConnected) {\n          removedElements = [];\n          Utilities.walkDeepDescendantElements(this, element => {\n            if (element !== this) {\n              removedElements.push(element);\n            }\n          });\n        }\n\n        baseDescriptor.set.call(this, htmlString);\n\n        if (removedElements) {\n          for (let i = 0; i < removedElements.length; i++) {\n            const element = removedElements[i];\n            if (element.__CE_state === CEState.custom) {\n              internals.disconnectedCallback(element);\n            }\n          }\n        }\n\n        // Only create custom elements if this element's owner document is\n        // associated with the registry.\n        if (!this.ownerDocument.__CE_hasRegistry) {\n          internals.patchTree(this);\n        } else {\n          internals.patchAndUpgradeTree(this);\n        }\n        return htmlString;\n      },\n    });\n  }\n\n  if (Native.Element_innerHTML && Native.Element_innerHTML.get) {\n    patch_innerHTML(Element.prototype, Native.Element_innerHTML);\n  } else if (Native.HTMLElement_innerHTML && Native.HTMLElement_innerHTML.get) {\n    patch_innerHTML(HTMLElement.prototype, Native.HTMLElement_innerHTML);\n  } else {\n\n    internals.addPatch(function(element) {\n      patch_innerHTML(element, {\n        enumerable: true,\n        configurable: true,\n        // Implements getting `innerHTML` by performing an unpatched `cloneNode`\n        // of the element and returning the resulting element's `innerHTML`.\n        // TODO: Is this too expensive?\n        get: /** @this {Element} */ function() {\n          return Native.Node_cloneNode.call(this, true).innerHTML;\n        },\n        // Implements setting `innerHTML` by creating an unpatched element,\n        // setting `innerHTML` of that element and replacing the target\n        // element's children with those of the unpatched element.\n        set: /** @this {Element} */ function(assignedValue) {\n          // NOTE: re-route to `content` for `template` elements.\n          // We need to do this because `template.appendChild` does not\n          // route into `template.content`.\n          const isTemplate = (this.localName === 'template');\n          /** @type {!Node} */\n          const content = isTemplate ? (/** @type {!HTMLTemplateElement} */\n            (this)).content : this;\n          /** @type {!Node} */\n          const rawElement = Native.Document_createElementNS.call(document,\n              this.namespaceURI, this.localName);\n          rawElement.innerHTML = assignedValue;\n\n          while (content.childNodes.length > 0) {\n            Native.Node_removeChild.call(content, content.childNodes[0]);\n          }\n          const container = isTemplate ? rawElement.content : rawElement;\n          while (container.childNodes.length > 0) {\n            Native.Node_appendChild.call(content, container.childNodes[0]);\n          }\n        },\n      });\n    });\n  }\n\n\n  Utilities.setPropertyUnchecked(Element.prototype, 'setAttribute',\n    /**\n     * @this {Element}\n     * @param {string} name\n     * @param {string} newValue\n     */\n    function(name, newValue) {\n      // Fast path for non-custom elements.\n      if (this.__CE_state !== CEState.custom) {\n        return Native.Element_setAttribute.call(this, name, newValue);\n      }\n\n      const oldValue = Native.Element_getAttribute.call(this, name);\n      Native.Element_setAttribute.call(this, name, newValue);\n      newValue = Native.Element_getAttribute.call(this, name);\n      internals.attributeChangedCallback(this, name, oldValue, newValue, null);\n    });\n\n  Utilities.setPropertyUnchecked(Element.prototype, 'setAttributeNS',\n    /**\n     * @this {Element}\n     * @param {?string} namespace\n     * @param {string} name\n     * @param {string} newValue\n     */\n    function(namespace, name, newValue) {\n      // Fast path for non-custom elements.\n      if (this.__CE_state !== CEState.custom) {\n        return Native.Element_setAttributeNS.call(this, namespace, name, newValue);\n      }\n\n      const oldValue = Native.Element_getAttributeNS.call(this, namespace, name);\n      Native.Element_setAttributeNS.call(this, namespace, name, newValue);\n      newValue = Native.Element_getAttributeNS.call(this, namespace, name);\n      internals.attributeChangedCallback(this, name, oldValue, newValue, namespace);\n    });\n\n  Utilities.setPropertyUnchecked(Element.prototype, 'removeAttribute',\n    /**\n     * @this {Element}\n     * @param {string} name\n     */\n    function(name) {\n      // Fast path for non-custom elements.\n      if (this.__CE_state !== CEState.custom) {\n        return Native.Element_removeAttribute.call(this, name);\n      }\n\n      const oldValue = Native.Element_getAttribute.call(this, name);\n      Native.Element_removeAttribute.call(this, name);\n      if (oldValue !== null) {\n        internals.attributeChangedCallback(this, name, oldValue, null, null);\n      }\n    });\n\n  Utilities.setPropertyUnchecked(Element.prototype, 'removeAttributeNS',\n    /**\n     * @this {Element}\n     * @param {?string} namespace\n     * @param {string} name\n     */\n    function(namespace, name) {\n      // Fast path for non-custom elements.\n      if (this.__CE_state !== CEState.custom) {\n        return Native.Element_removeAttributeNS.call(this, namespace, name);\n      }\n\n      const oldValue = Native.Element_getAttributeNS.call(this, namespace, name);\n      Native.Element_removeAttributeNS.call(this, namespace, name);\n      // In older browsers, `Element#getAttributeNS` may return the empty string\n      // instead of null if the attribute does not exist. For details, see;\n      // https://developer.mozilla.org/en-US/docs/Web/API/Element/getAttributeNS#Notes\n      const newValue = Native.Element_getAttributeNS.call(this, namespace, name);\n      if (oldValue !== newValue) {\n        internals.attributeChangedCallback(this, name, oldValue, newValue, namespace);\n      }\n    });\n\n\n  function patch_insertAdjacentElement(destination, baseMethod) {\n    Utilities.setPropertyUnchecked(destination, 'insertAdjacentElement',\n      /**\n       * @this {Element}\n       * @param {string} position\n       * @param {!Element} element\n       * @return {?Element}\n       */\n      function(position, element) {\n        const wasConnected = Utilities.isConnected(element);\n        const insertedElement = /** @type {!Element} */\n          (baseMethod.call(this, position, element));\n\n        if (wasConnected) {\n          internals.disconnectTree(element);\n        }\n\n        if (Utilities.isConnected(insertedElement)) {\n          internals.connectTree(element);\n        }\n        return insertedElement;\n      });\n  }\n\n  if (Native.HTMLElement_insertAdjacentElement) {\n    patch_insertAdjacentElement(HTMLElement.prototype, Native.HTMLElement_insertAdjacentElement);\n  } else if (Native.Element_insertAdjacentElement) {\n    patch_insertAdjacentElement(Element.prototype, Native.Element_insertAdjacentElement);\n  } else {\n    console.warn('Custom Elements: `Element#insertAdjacentElement` was not patched.');\n  }\n\n\n  function patch_insertAdjacentHTML(destination, baseMethod) {\n    /**\n     * Patches and upgrades all nodes which are siblings between `start`\n     * (inclusive) and `end` (exclusive). If `end` is `null`, then all siblings\n     * following `start` will be patched and upgraded.\n     * @param {!Node} start\n     * @param {?Node} end\n     */\n    function upgradeNodesInRange(start, end) {\n      const nodes = [];\n      for (let node = start; node !== end; node = node.nextSibling) {\n        nodes.push(node);\n      }\n      for (let i = 0; i < nodes.length; i++) {\n        internals.patchAndUpgradeTree(nodes[i]);\n      }\n    }\n\n    Utilities.setPropertyUnchecked(destination, 'insertAdjacentHTML',\n      /**\n       * @this {Element}\n       * @param {string} position\n       * @param {string} text\n       */\n      function(position, text) {\n        position = position.toLowerCase();\n\n        if (position === \"beforebegin\") {\n          const marker = this.previousSibling;\n          baseMethod.call(this, position, text);\n          upgradeNodesInRange(marker || /** @type {!Node} */ (this.parentNode.firstChild), this);\n        } else if (position === \"afterbegin\") {\n          const marker = this.firstChild;\n          baseMethod.call(this, position, text);\n          upgradeNodesInRange(/** @type {!Node} */ (this.firstChild), marker);\n        } else if (position === \"beforeend\") {\n          const marker = this.lastChild;\n          baseMethod.call(this, position, text);\n          upgradeNodesInRange(marker || /** @type {!Node} */ (this.firstChild), null);\n        } else if (position === \"afterend\") {\n          const marker = this.nextSibling;\n          baseMethod.call(this, position, text);\n          upgradeNodesInRange(/** @type {!Node} */ (this.nextSibling), marker);\n        } else {\n          throw new SyntaxError(`The value provided (${String(position)}) is ` +\n            \"not one of 'beforebegin', 'afterbegin', 'beforeend', or 'afterend'.\");\n        }\n      });\n  }\n\n  if (Native.HTMLElement_insertAdjacentHTML) {\n    patch_insertAdjacentHTML(HTMLElement.prototype, Native.HTMLElement_insertAdjacentHTML);\n  } else if (Native.Element_insertAdjacentHTML) {\n    patch_insertAdjacentHTML(Element.prototype, Native.Element_insertAdjacentHTML);\n  } else {\n    console.warn('Custom Elements: `Element#insertAdjacentHTML` was not patched.');\n  }\n\n\n  PatchParentNode(internals, Element.prototype, {\n    prepend: Native.Element_prepend,\n    append: Native.Element_append,\n  });\n\n  PatchChildNode(internals, Element.prototype, {\n    before: Native.Element_before,\n    after: Native.Element_after,\n    replaceWith: Native.Element_replaceWith,\n    remove: Native.Element_remove,\n  });\n};\n","/**\n * @license\n * Copyright (c) 2016 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n */\n\nimport CustomElementInternals from './CustomElementInternals.js';\nimport CustomElementRegistry from './CustomElementRegistry.js';\n\nimport PatchHTMLElement from './Patch/HTMLElement.js';\nimport PatchDocument from './Patch/Document.js';\nimport PatchDocumentFragment from './Patch/DocumentFragment.js';\nimport PatchNode from './Patch/Node.js';\nimport PatchElement from './Patch/Element.js';\n\nconst priorCustomElements = window['customElements'];\n\nif (!priorCustomElements ||\n     priorCustomElements['forcePolyfill'] ||\n     (typeof priorCustomElements['define'] != 'function') ||\n     (typeof priorCustomElements['get'] != 'function')) {\n  /** @type {!CustomElementInternals} */\n  const internals = new CustomElementInternals();\n\n  PatchHTMLElement(internals);\n  PatchDocument(internals);\n  PatchDocumentFragment(internals);\n  PatchNode(internals);\n  PatchElement(internals);\n\n  // The main document is always associated with the registry.\n  document.__CE_hasRegistry = true;\n\n  /** @type {!CustomElementRegistry} */\n  const customElements = new CustomElementRegistry(internals);\n\n  Object.defineProperty(window, 'customElements', {\n    configurable: true,\n    enumerable: true,\n    value: customElements,\n  });\n}\n","/**\n@license\nCopyright (c) 2017 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n/*\nExtremely simple css parser. Intended to be not more than what we need\nand definitely not necessarily correct =).\n*/\n\n'use strict';\n\n/** @unrestricted */\nclass StyleNode {\n  constructor() {\n    /** @type {number} */\n    this['start'] = 0;\n    /** @type {number} */\n    this['end'] = 0;\n    /** @type {StyleNode} */\n    this['previous'] = null;\n    /** @type {StyleNode} */\n    this['parent'] = null;\n    /** @type {Array<StyleNode>} */\n    this['rules'] = null;\n    /** @type {string} */\n    this['parsedCssText'] = '';\n    /** @type {string} */\n    this['cssText'] = '';\n    /** @type {boolean} */\n    this['atRule'] = false;\n    /** @type {number} */\n    this['type'] = 0;\n    /** @type {string} */\n    this['keyframesName'] = '';\n    /** @type {string} */\n    this['selector'] = '';\n    /** @type {string} */\n    this['parsedSelector'] = '';\n  }\n}\n\nexport {StyleNode}\n\n// given a string of css, return a simple rule tree\n/**\n * @param {string} text\n * @return {StyleNode}\n */\nexport function parse(text) {\n  text = clean(text);\n  return parseCss(lex(text), text);\n}\n\n// remove stuff we don't care about that may hinder parsing\n/**\n * @param {string} cssText\n * @return {string}\n */\nfunction clean(cssText) {\n  return cssText.replace(RX.comments, '').replace(RX.port, '');\n}\n\n// super simple {...} lexer that returns a node tree\n/**\n * @param {string} text\n * @return {StyleNode}\n */\nfunction lex(text) {\n  let root = new StyleNode();\n  root['start'] = 0;\n  root['end'] = text.length\n  let n = root;\n  for (let i = 0, l = text.length; i < l; i++) {\n    if (text[i] === OPEN_BRACE) {\n      if (!n['rules']) {\n        n['rules'] = [];\n      }\n      let p = n;\n      let previous = p['rules'][p['rules'].length - 1] || null;\n      n = new StyleNode();\n      n['start'] = i + 1;\n      n['parent'] = p;\n      n['previous'] = previous;\n      p['rules'].push(n);\n    } else if (text[i] === CLOSE_BRACE) {\n      n['end'] = i + 1;\n      n = n['parent'] || root;\n    }\n  }\n  return root;\n}\n\n// add selectors/cssText to node tree\n/**\n * @param {StyleNode} node\n * @param {string} text\n * @return {StyleNode}\n */\nfunction parseCss(node, text) {\n  let t = text.substring(node['start'], node['end'] - 1);\n  node['parsedCssText'] = node['cssText'] = t.trim();\n  if (node['parent']) {\n    let ss = node['previous'] ? node['previous']['end'] : node['parent']['start'];\n    t = text.substring(ss, node['start'] - 1);\n    t = _expandUnicodeEscapes(t);\n    t = t.replace(RX.multipleSpaces, ' ');\n    // TODO(sorvell): ad hoc; make selector include only after last ;\n    // helps with mixin syntax\n    t = t.substring(t.lastIndexOf(';') + 1);\n    let s = node['parsedSelector'] = node['selector'] = t.trim();\n    node['atRule'] = (s.indexOf(AT_START) === 0);\n    // note, support a subset of rule types...\n    if (node['atRule']) {\n      if (s.indexOf(MEDIA_START) === 0) {\n        node['type'] = types.MEDIA_RULE;\n      } else if (s.match(RX.keyframesRule)) {\n        node['type'] = types.KEYFRAMES_RULE;\n        node['keyframesName'] =\n          node['selector'].split(RX.multipleSpaces).pop();\n      }\n    } else {\n      if (s.indexOf(VAR_START) === 0) {\n        node['type'] = types.MIXIN_RULE;\n      } else {\n        node['type'] = types.STYLE_RULE;\n      }\n    }\n  }\n  let r$ = node['rules'];\n  if (r$) {\n    for (let i = 0, l = r$.length, r;\n      (i < l) && (r = r$[i]); i++) {\n      parseCss(r, text);\n    }\n  }\n  return node;\n}\n\n/**\n * conversion of sort unicode escapes with spaces like `\\33 ` (and longer) into\n * expanded form that doesn't require trailing space `\\000033`\n * @param {string} s\n * @return {string}\n */\nfunction _expandUnicodeEscapes(s) {\n  return s.replace(/\\\\([0-9a-f]{1,6})\\s/gi, function() {\n    let code = arguments[1],\n      repeat = 6 - code.length;\n    while (repeat--) {\n      code = '0' + code;\n    }\n    return '\\\\' + code;\n  });\n}\n\n/**\n * stringify parsed css.\n * @param {StyleNode} node\n * @param {boolean=} preserveProperties\n * @param {string=} text\n * @return {string}\n */\nexport function stringify(node, preserveProperties, text = '') {\n  // calc rule cssText\n  let cssText = '';\n  if (node['cssText'] || node['rules']) {\n    let r$ = node['rules'];\n    if (r$ && !_hasMixinRules(r$)) {\n      for (let i = 0, l = r$.length, r;\n        (i < l) && (r = r$[i]); i++) {\n        cssText = stringify(r, preserveProperties, cssText);\n      }\n    } else {\n      cssText = preserveProperties ? node['cssText'] :\n        removeCustomProps(node['cssText']);\n      cssText = cssText.trim();\n      if (cssText) {\n        cssText = '  ' + cssText + '\\n';\n      }\n    }\n  }\n  // emit rule if there is cssText\n  if (cssText) {\n    if (node['selector']) {\n      text += node['selector'] + ' ' + OPEN_BRACE + '\\n';\n    }\n    text += cssText;\n    if (node['selector']) {\n      text += CLOSE_BRACE + '\\n\\n';\n    }\n  }\n  return text;\n}\n\n/**\n * @param {Array<StyleNode>} rules\n * @return {boolean}\n */\nfunction _hasMixinRules(rules) {\n  let r = rules[0];\n  return Boolean(r) && Boolean(r['selector']) && r['selector'].indexOf(VAR_START) === 0;\n}\n\n/**\n * @param {string} cssText\n * @return {string}\n */\nfunction removeCustomProps(cssText) {\n  cssText = removeCustomPropAssignment(cssText);\n  return removeCustomPropApply(cssText);\n}\n\n/**\n * @param {string} cssText\n * @return {string}\n */\nexport function removeCustomPropAssignment(cssText) {\n  return cssText\n    .replace(RX.customProp, '')\n    .replace(RX.mixinProp, '');\n}\n\n/**\n * @param {string} cssText\n * @return {string}\n */\nfunction removeCustomPropApply(cssText) {\n  return cssText\n    .replace(RX.mixinApply, '')\n    .replace(RX.varApply, '');\n}\n\n/** @enum {number} */\nexport const types = {\n  STYLE_RULE: 1,\n  KEYFRAMES_RULE: 7,\n  MEDIA_RULE: 4,\n  MIXIN_RULE: 1000\n}\n\nconst OPEN_BRACE = '{';\nconst CLOSE_BRACE = '}';\n\n// helper regexp's\nconst RX = {\n  comments: /\\/\\*[^*]*\\*+([^/*][^*]*\\*+)*\\//gim,\n  port: /@import[^;]*;/gim,\n  customProp: /(?:^[^;\\-\\s}]+)?--[^;{}]*?:[^{};]*?(?:[;\\n]|$)/gim,\n  mixinProp: /(?:^[^;\\-\\s}]+)?--[^;{}]*?:[^{};]*?{[^}]*?}(?:[;\\n]|$)?/gim,\n  mixinApply: /@apply\\s*\\(?[^);]*\\)?\\s*(?:[;\\n]|$)?/gim,\n  varApply: /[^;:]*?:[^;]*?var\\([^;]*\\)(?:[;\\n]|$)?/gim,\n  keyframesRule: /^@[^\\s]*keyframes/,\n  multipleSpaces: /\\s+/g\n}\n\nconst VAR_START = '--';\nconst MEDIA_START = '@media';\nconst AT_START = '@';\n","/**\n@license\nCopyright (c) 2017 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n'use strict';\n\nexport const nativeShadow = !(window['ShadyDOM'] && window['ShadyDOM']['inUse']);\nlet nativeCssVariables_;\n\n/**\n * @param {(ShadyCSSOptions | ShadyCSSInterface)=} settings\n */\nfunction calcCssVariables(settings) {\n  if (settings && settings['shimcssproperties']) {\n    nativeCssVariables_ = false;\n  } else {\n    // chrome 49 has semi-working css vars, check if box-shadow works\n    // safari 9.1 has a recalc bug: https://bugs.webkit.org/show_bug.cgi?id=155782\n    // However, shim css custom properties are only supported with ShadyDOM enabled,\n    // so fall back on native if we do not detect ShadyDOM\n    // Edge 15: custom properties used in ::before and ::after will also be used in the parent element\n    // https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/12414257/\n    nativeCssVariables_ = nativeShadow || Boolean(!navigator.userAgent.match(/AppleWebKit\\/601|Edge\\/15/) &&\n      window.CSS && CSS.supports && CSS.supports('box-shadow', '0 0 0 var(--foo)'));\n  }\n}\n\n/** @type {string | undefined} */\nexport let cssBuild;\nif (window.ShadyCSS && window.ShadyCSS.cssBuild !== undefined) {\n  cssBuild = window.ShadyCSS.cssBuild;\n}\n\n/** @type {boolean} */\nexport const disableRuntime = Boolean(window.ShadyCSS && window.ShadyCSS.disableRuntime);\n\nif (window.ShadyCSS && window.ShadyCSS.nativeCss !== undefined) {\n  nativeCssVariables_ = window.ShadyCSS.nativeCss;\n} else if (window.ShadyCSS) {\n  calcCssVariables(window.ShadyCSS);\n  // reset window variable to let ShadyCSS API take its place\n  window.ShadyCSS = undefined;\n} else {\n  calcCssVariables(window['WebComponents'] && window['WebComponents']['flags']);\n}\n\n// Hack for type error under new type inference which doesn't like that\n// nativeCssVariables is updated in a function and assigns the type\n// `function(): ?` instead of `boolean`.\nexport const nativeCssVariables = /** @type {boolean} */(nativeCssVariables_);","/**\n@license\nCopyright (c) 2017 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\nexport const VAR_ASSIGN = /(?:^|[;\\s{]\\s*)(--[\\w-]*?)\\s*:\\s*(?:((?:'(?:\\\\'|.)*?'|\"(?:\\\\\"|.)*?\"|\\([^)]*?\\)|[^};{])+)|\\{([^}]*)\\}(?:(?=[;\\s}])|$))/gi;\nexport const MIXIN_MATCH = /(?:^|\\W+)@apply\\s*\\(?([^);\\n]*)\\)?/gi;\nexport const VAR_CONSUMED = /(--[\\w-]+)\\s*([:,;)]|$)/gi;\nexport const ANIMATION_MATCH = /(animation\\s*:)|(animation-name\\s*:)/;\nexport const MEDIA_MATCH = /@media\\s(.*)/;\nexport const IS_VAR = /^--/;\nexport const BRACKETED = /\\{[^}]*\\}/g;\nexport const HOST_PREFIX = '(?:^|[^.#[:])';\nexport const HOST_SUFFIX = '($|[.:[\\\\s>+~])';\n","/**\n@license\nCopyright (c) 2017 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n'use strict';\n\n/** @type {!Set<string>} */\nconst styleTextSet = new Set();\n\nexport const scopingAttribute = 'shady-unscoped';\n\n/**\n * Add a specifically-marked style to the document directly, and only one copy of that style.\n *\n * @param {!HTMLStyleElement} style\n * @return {undefined}\n */\nexport function processUnscopedStyle(style) {\n  const text = style.textContent;\n  if (!styleTextSet.has(text)) {\n    styleTextSet.add(text);\n    const newStyle = style.cloneNode(true);\n    document.head.appendChild(newStyle);\n  }\n}\n\n/**\n * Check if a style is supposed to be unscoped\n * @param {!HTMLStyleElement} style\n * @return {boolean} true if the style has the unscoping attribute\n */\nexport function isUnscopedStyle(style) {\n  return style.hasAttribute(scopingAttribute);\n}","/**\n@license\nCopyright (c) 2017 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n'use strict';\n\nimport {nativeShadow, nativeCssVariables, cssBuild} from './style-settings.js';\nimport {parse, stringify, types, StyleNode} from './css-parse.js'; // eslint-disable-line no-unused-vars\nimport {MEDIA_MATCH} from './common-regex.js';\nimport {processUnscopedStyle, isUnscopedStyle} from './unscoped-style-handler.js';\n\n/**\n * @param {string|StyleNode} rules\n * @param {function(StyleNode)=} callback\n * @return {string}\n */\nexport function toCssText (rules, callback) {\n  if (!rules) {\n    return '';\n  }\n  if (typeof rules === 'string') {\n    rules = parse(rules);\n  }\n  if (callback) {\n    forEachRule(rules, callback);\n  }\n  return stringify(rules, nativeCssVariables);\n}\n\n/**\n * @param {HTMLStyleElement} style\n * @return {StyleNode}\n */\nexport function rulesForStyle(style) {\n  if (!style['__cssRules'] && style.textContent) {\n    style['__cssRules'] = parse(style.textContent);\n  }\n  return style['__cssRules'] || null;\n}\n\n// Tests if a rule is a keyframes selector, which looks almost exactly\n// like a normal selector but is not (it has nothing to do with scoping\n// for example).\n/**\n * @param {StyleNode} rule\n * @return {boolean}\n */\nexport function isKeyframesSelector(rule) {\n  return Boolean(rule['parent']) &&\n  rule['parent']['type'] === types.KEYFRAMES_RULE;\n}\n\n/**\n * @param {StyleNode} node\n * @param {Function=} styleRuleCallback\n * @param {Function=} keyframesRuleCallback\n * @param {boolean=} onlyActiveRules\n */\nexport function forEachRule(node, styleRuleCallback, keyframesRuleCallback, onlyActiveRules) {\n  if (!node) {\n    return;\n  }\n  let skipRules = false;\n  let type = node['type'];\n  if (onlyActiveRules) {\n    if (type === types.MEDIA_RULE) {\n      let matchMedia = node['selector'].match(MEDIA_MATCH);\n      if (matchMedia) {\n        // if rule is a non matching @media rule, skip subrules\n        if (!window.matchMedia(matchMedia[1]).matches) {\n          skipRules = true;\n        }\n      }\n    }\n  }\n  if (type === types.STYLE_RULE) {\n    styleRuleCallback(node);\n  } else if (keyframesRuleCallback &&\n    type === types.KEYFRAMES_RULE) {\n    keyframesRuleCallback(node);\n  } else if (type === types.MIXIN_RULE) {\n    skipRules = true;\n  }\n  let r$ = node['rules'];\n  if (r$ && !skipRules) {\n    for (let i=0, l=r$.length, r; (i<l) && (r=r$[i]); i++) {\n      forEachRule(r, styleRuleCallback, keyframesRuleCallback, onlyActiveRules);\n    }\n  }\n}\n\n// add a string of cssText to the document.\n/**\n * @param {string} cssText\n * @param {string} moniker\n * @param {Node} target\n * @param {Node} contextNode\n * @return {HTMLStyleElement}\n */\nexport function applyCss(cssText, moniker, target, contextNode) {\n  let style = createScopeStyle(cssText, moniker);\n  applyStyle(style, target, contextNode);\n  return style;\n}\n\n/**\n * @param {string} cssText\n * @param {string} moniker\n * @return {HTMLStyleElement}\n */\nexport function createScopeStyle(cssText, moniker) {\n  let style = /** @type {HTMLStyleElement} */(document.createElement('style'));\n  if (moniker) {\n    style.setAttribute('scope', moniker);\n  }\n  style.textContent = cssText;\n  return style;\n}\n\n/**\n * Track the position of the last added style for placing placeholders\n * @type {Node}\n */\nlet lastHeadApplyNode = null;\n\n// insert a comment node as a styling position placeholder.\n/**\n * @param {string} moniker\n * @return {!Comment}\n */\nexport function applyStylePlaceHolder(moniker) {\n  let placeHolder = document.createComment(' Shady DOM styles for ' +\n    moniker + ' ');\n  let after = lastHeadApplyNode ?\n    lastHeadApplyNode['nextSibling'] : null;\n  let scope = document.head;\n  scope.insertBefore(placeHolder, after || scope.firstChild);\n  lastHeadApplyNode = placeHolder;\n  return placeHolder;\n}\n\n/**\n * @param {HTMLStyleElement} style\n * @param {?Node} target\n * @param {?Node} contextNode\n */\nexport function applyStyle(style, target, contextNode) {\n  target = target || document.head;\n  let after = (contextNode && contextNode.nextSibling) ||\n    target.firstChild;\n  target.insertBefore(style, after);\n  if (!lastHeadApplyNode) {\n    lastHeadApplyNode = style;\n  } else {\n    // only update lastHeadApplyNode if the new style is inserted after the old lastHeadApplyNode\n    let position = style.compareDocumentPosition(lastHeadApplyNode);\n    if (position === Node.DOCUMENT_POSITION_PRECEDING) {\n      lastHeadApplyNode = style;\n    }\n  }\n}\n\n/**\n * @param {string} buildType\n * @return {boolean}\n */\nexport function isTargetedBuild(buildType) {\n  return nativeShadow ? buildType === 'shadow' : buildType === 'shady';\n}\n\n/**\n * Walk from text[start] matching parens and\n * returns position of the outer end paren\n * @param {string} text\n * @param {number} start\n * @return {number}\n */\nexport function findMatchingParen(text, start) {\n  let level = 0;\n  for (let i=start, l=text.length; i < l; i++) {\n    if (text[i] === '(') {\n      level++;\n    } else if (text[i] === ')') {\n      if (--level === 0) {\n        return i;\n      }\n    }\n  }\n  return -1;\n}\n\n/**\n * @param {string} str\n * @param {function(string, string, string, string)} callback\n */\nexport function processVariableAndFallback(str, callback) {\n  // find 'var('\n  let start = str.indexOf('var(');\n  if (start === -1) {\n    // no var?, everything is prefix\n    return callback(str, '', '', '');\n  }\n  //${prefix}var(${inner})${suffix}\n  let end = findMatchingParen(str, start + 3);\n  let inner = str.substring(start + 4, end);\n  let prefix = str.substring(0, start);\n  // suffix may have other variables\n  let suffix = processVariableAndFallback(str.substring(end + 1), callback);\n  let comma = inner.indexOf(',');\n  // value and fallback args should be trimmed to match in property lookup\n  if (comma === -1) {\n    // variable, no fallback\n    return callback(prefix, inner.trim(), '', suffix);\n  }\n  // var(${value},${fallback})\n  let value = inner.substring(0, comma).trim();\n  let fallback = inner.substring(comma + 1).trim();\n  return callback(prefix, value, fallback, suffix);\n}\n\n/**\n * @param {Element} element\n * @param {string} value\n */\nexport function setElementClassRaw(element, value) {\n  // use native setAttribute provided by ShadyDOM when setAttribute is patched\n  if (nativeShadow) {\n    element.setAttribute('class', value);\n  } else {\n    window['ShadyDOM']['nativeMethods']['setAttribute'].call(element, 'class', value);\n  }\n}\n\n/**\n * @type {function(*):*}\n */\nexport const wrap = window['ShadyDOM'] && window['ShadyDOM']['wrap'] || ((node) => node);\n\n/**\n * @param {Element | {is: string, extends: string}} element\n * @return {{is: string, typeExtension: string}}\n */\nexport function getIsExtends(element) {\n  let localName = element['localName'];\n  let is = '', typeExtension = '';\n  /*\n  NOTE: technically, this can be wrong for certain svg elements\n  with `-` in the name like `<font-face>`\n  */\n  if (localName) {\n    if (localName.indexOf('-') > -1) {\n      is = localName;\n    } else {\n      typeExtension = localName;\n      is = (element.getAttribute && element.getAttribute('is')) || '';\n    }\n  } else {\n    is = /** @type {?} */(element).is;\n    typeExtension = /** @type {?} */(element).extends;\n  }\n  return {is, typeExtension};\n}\n\n/**\n * @param {Element|DocumentFragment} element\n * @return {string}\n */\nexport function gatherStyleText(element) {\n  /** @type {!Array<string>} */\n  const styleTextParts = [];\n  const styles = /** @type {!NodeList<!HTMLStyleElement>} */(element.querySelectorAll('style'));\n  for (let i = 0; i < styles.length; i++) {\n    const style = styles[i];\n    if (isUnscopedStyle(style)) {\n      if (!nativeShadow) {\n        processUnscopedStyle(style);\n        style.parentNode.removeChild(style);\n      }\n    } else {\n      styleTextParts.push(style.textContent);\n      style.parentNode.removeChild(style);\n    }\n  }\n  return styleTextParts.join('').trim();\n}\n\n/**\n * Split a selector separated by commas into an array in a smart way\n * @param {string} selector\n * @return {!Array<string>}\n */\nexport function splitSelectorList(selector) {\n  const parts = [];\n  let part = '';\n  for (let i = 0; i >= 0 && i < selector.length; i++) {\n    // A selector with parentheses will be one complete part\n    if (selector[i] === '(') {\n      // find the matching paren\n      const end = findMatchingParen(selector, i);\n      // push the paren block into the part\n      part += selector.slice(i, end + 1);\n      // move the index to after the paren block\n      i = end;\n    } else if (selector[i] === ',') {\n      parts.push(part);\n      part = '';\n    } else {\n      part += selector[i];\n    }\n  }\n  // catch any pieces after the last comma\n  if (part) {\n    parts.push(part);\n  }\n  return parts;\n}\n\nconst CSS_BUILD_ATTR = 'css-build';\n\n/**\n * Return the polymer-css-build \"build type\" applied to this element\n *\n * @param {!HTMLElement} element\n * @return {string} Can be \"\", \"shady\", or \"shadow\"\n */\nexport function getCssBuild(element) {\n  if (cssBuild !== undefined) {\n    return /** @type {string} */(cssBuild);\n  }\n  if (element.__cssBuild === undefined) {\n    // try attribute first, as it is the common case\n    const attrValue = element.getAttribute(CSS_BUILD_ATTR);\n    if (attrValue) {\n      element.__cssBuild = attrValue;\n    } else {\n      const buildComment = getBuildComment(element);\n      if (buildComment !== '') {\n        // remove build comment so it is not needlessly copied into every element instance\n        removeBuildComment(element);\n      }\n      element.__cssBuild = buildComment;\n    }\n  }\n  return element.__cssBuild || '';\n}\n\n/**\n * Check if the given element, either a <template> or <style>, has been processed\n * by polymer-css-build.\n *\n * If so, then we can make a number of optimizations:\n * - polymer-css-build will decompose mixins into individual CSS Custom Properties,\n * so the ApplyShim can be skipped entirely.\n * - Under native ShadowDOM, the style text can just be copied into each instance\n * without modification\n * - If the build is \"shady\" and ShadyDOM is in use, the styling does not need\n * scoping beyond the shimming of CSS Custom Properties\n *\n * @param {!HTMLElement} element\n * @return {boolean}\n */\nexport function elementHasBuiltCss(element) {\n  return getCssBuild(element) !== '';\n}\n\n/**\n * For templates made with tagged template literals, polymer-css-build will\n * insert a comment of the form `<!--css-build:shadow-->`\n *\n * @param {!HTMLElement} element\n * @return {string}\n */\nexport function getBuildComment(element) {\n  const buildComment = element.localName === 'template' ?\n      /** @type {!HTMLTemplateElement} */ (element).content.firstChild :\n      element.firstChild;\n  if (buildComment instanceof Comment) {\n    const commentParts = buildComment.textContent.trim().split(':');\n    if (commentParts[0] === CSS_BUILD_ATTR) {\n      return commentParts[1];\n    }\n  }\n  return '';\n}\n\n/**\n * Check if the css build status is optimal, and do no unneeded work.\n *\n * @param {string=} cssBuild CSS build status\n * @return {boolean} css build is optimal or not\n */\nexport function isOptimalCssBuild(cssBuild = '') {\n  // CSS custom property shim always requires work\n  if (cssBuild === '' || !nativeCssVariables) {\n    return false;\n  }\n  return nativeShadow ? cssBuild === 'shadow' : cssBuild === 'shady';\n}\n\n/**\n * @param {!HTMLElement} element\n */\nfunction removeBuildComment(element) {\n  const buildComment = element.localName === 'template' ?\n      /** @type {!HTMLTemplateElement} */ (element).content.firstChild :\n      element.firstChild;\n  buildComment.parentNode.removeChild(buildComment);\n}\n","/**\n@license\nCopyright (c) 2017 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n'use strict';\n\nimport {StyleNode} from './css-parse.js'; // eslint-disable-line no-unused-vars\nimport * as StyleUtil from './style-util.js';\nimport {nativeShadow} from './style-settings.js';\n\n/* Transforms ShadowDOM styling into ShadyDOM styling\n\n* scoping:\n\n  * elements in scope get scoping selector class=\"x-foo-scope\"\n  * selectors re-written as follows:\n\n    div button -> div.x-foo-scope button.x-foo-scope\n\n* :host -> scopeName\n\n* :host(...) -> scopeName...\n\n* ::slotted(...) -> scopeName > ...\n\n* ...:dir(ltr|rtl) -> [dir=\"ltr|rtl\"] ..., ...[dir=\"ltr|rtl\"]\n\n* :host(:dir[rtl]) -> scopeName:dir(rtl) -> [dir=\"rtl\"] scopeName, scopeName[dir=\"rtl\"]\n\n*/\nconst SCOPE_NAME = 'style-scope';\n\nclass StyleTransformer {\n  get SCOPE_NAME() {\n    return SCOPE_NAME;\n  }\n  /**\n   * Given a node and scope name, add a scoping class to each node\n   * in the tree. This facilitates transforming css into scoped rules.\n   * @param {!Node} node\n   * @param {string} scope\n   * @param {boolean=} shouldRemoveScope\n   * @deprecated\n   */\n  dom(node, scope, shouldRemoveScope) {\n    const fn = (node) => {\n      this.element(node, scope || '', shouldRemoveScope);\n    };\n    this._transformDom(node, fn);\n  }\n\n  /**\n   * Given a node and scope name, add a scoping class to each node in the tree.\n   * @param {!Node} node\n   * @param {string} scope\n   */\n  domAddScope(node, scope) {\n    const fn = (node) => {\n      this.element(node, scope || '');\n    };\n    this._transformDom(node, fn);\n  }\n\n  /**\n   * @param {!Node} startNode\n   * @param {!function(!Node)} transformer\n   */\n  _transformDom(startNode, transformer) {\n    if (startNode.nodeType === Node.ELEMENT_NODE) {\n      transformer(startNode)\n    }\n    let c$;\n    if (startNode.localName === 'template') {\n      const template = /** @type {!HTMLTemplateElement} */ (startNode);\n      // In case the template is in svg context, fall back to the node\n      // since it won't be an HTMLTemplateElement with a .content property\n      c$ = (template.content || template._content || template).childNodes;\n    } else {\n      c$ = /** @type {!ParentNode} */ (startNode).children ||\n          startNode.childNodes;\n    }\n    if (c$) {\n      for (let i = 0; i < c$.length; i++) {\n        this._transformDom(c$[i], transformer);\n      }\n    }\n  }\n\n  /**\n   * @param {?} element\n   * @param {?} scope\n   * @param {?=} shouldRemoveScope\n   */\n  element(element, scope, shouldRemoveScope) {\n    // note: if using classes, we add both the general 'style-scope' class\n    // as well as the specific scope. This enables easy filtering of all\n    // `style-scope` elements\n    if (scope) {\n      // note: svg on IE does not have classList so fallback to class\n      if (element.classList) {\n        if (shouldRemoveScope) {\n          element.classList.remove(SCOPE_NAME);\n          element.classList.remove(scope);\n        } else {\n          element.classList.add(SCOPE_NAME);\n          element.classList.add(scope);\n        }\n      } else if (element.getAttribute) {\n        let c = element.getAttribute(CLASS);\n        if (shouldRemoveScope) {\n          if (c) {\n            let newValue = c.replace(SCOPE_NAME, '').replace(scope, '');\n            StyleUtil.setElementClassRaw(element, newValue);\n          }\n        } else {\n          let newValue = (c ? c + ' ' : '') + SCOPE_NAME + ' ' + scope;\n          StyleUtil.setElementClassRaw(element, newValue);\n        }\n      }\n    }\n  }\n\n  /**\n   * Given a node, replace the scoping class to each subnode in the tree.\n   * @param {!Node} node\n   * @param {string} oldScope\n   * @param {string} newScope\n   */\n  domReplaceScope(node, oldScope, newScope) {\n    const fn = (node) => {\n      this.element(node, oldScope, true);\n      this.element(node, newScope);\n    };\n    this._transformDom(node, fn);\n  }\n  /**\n   * Given a node, remove the scoping class to each subnode in the tree.\n   * @param {!Node} node\n   * @param {string} oldScope\n   */\n  domRemoveScope(node, oldScope) {\n    const fn = (node) => {\n      this.element(node, oldScope || '', true);\n    };\n    this._transformDom(node, fn);\n  }\n\n  /**\n   * @param {?} element\n   * @param {?} styleRules\n   * @param {?=} callback\n   * @param {string=} cssBuild\n   * @param {string=} cssText\n   * @return {string}\n   */\n  elementStyles(element, styleRules, callback, cssBuild = '', cssText = '') {\n    // no need to shim selectors if settings.useNativeShadow, also\n    // a shady css build will already have transformed selectors\n    // NOTE: This method may be called as part of static or property shimming.\n    // When there is a targeted build it will not be called for static shimming,\n    // but when the property shim is used it is called and should opt out of\n    // static shimming work when a proper build exists.\n    if (cssText === '') {\n      if (nativeShadow || cssBuild === 'shady') {\n        cssText = StyleUtil.toCssText(styleRules, callback);\n      } else {\n        let {is, typeExtension} = StyleUtil.getIsExtends(element);\n        cssText = this.css(styleRules, is, typeExtension, callback) + '\\n\\n';\n      }\n    }\n    return cssText.trim();\n  }\n\n  // Given a string of cssText and a scoping string (scope), returns\n  // a string of scoped css where each selector is transformed to include\n  // a class created from the scope. ShadowDOM selectors are also transformed\n  // (e.g. :host) to use the scoping selector.\n  css(rules, scope, ext, callback) {\n    let hostScope = this._calcHostScope(scope, ext);\n    scope = this._calcElementScope(scope);\n    let self = this;\n    return StyleUtil.toCssText(rules, function(/** StyleNode */rule) {\n      if (!rule.isScoped) {\n        self.rule(rule, scope, hostScope);\n        rule.isScoped = true;\n      }\n      if (callback) {\n        callback(rule, scope, hostScope);\n      }\n    });\n  }\n\n  _calcElementScope(scope) {\n    if (scope) {\n      return CSS_CLASS_PREFIX + scope;\n    } else {\n      return '';\n    }\n  }\n\n  _calcHostScope(scope, ext) {\n    return ext ? `[is=${scope}]` : scope;\n  }\n\n  rule(rule, scope, hostScope) {\n    this._transformRule(rule, this._transformComplexSelector,\n      scope, hostScope);\n  }\n\n  /**\n   * transforms a css rule to a scoped rule.\n   *\n   * @param {StyleNode} rule\n   * @param {Function} transformer\n   * @param {string=} scope\n   * @param {string=} hostScope\n   */\n  _transformRule(rule, transformer, scope, hostScope) {\n    // NOTE: save transformedSelector for subsequent matching of elements\n    // against selectors (e.g. when calculating style properties)\n    rule['selector'] = rule.transformedSelector =\n      this._transformRuleCss(rule, transformer, scope, hostScope);\n  }\n\n  /**\n   * @param {StyleNode} rule\n   * @param {Function} transformer\n   * @param {string=} scope\n   * @param {string=} hostScope\n   */\n  _transformRuleCss(rule, transformer, scope, hostScope) {\n    let p$ = StyleUtil.splitSelectorList(rule['selector']);\n    // we want to skip transformation of rules that appear in keyframes,\n    // because they are keyframe selectors, not element selectors.\n    if (!StyleUtil.isKeyframesSelector(rule)) {\n      for (let i=0, l=p$.length, p; (i<l) && (p=p$[i]); i++) {\n        p$[i] = transformer.call(this, p, scope, hostScope);\n      }\n    }\n    return p$.filter((part) => Boolean(part)).join(COMPLEX_SELECTOR_SEP);\n  }\n\n  /**\n   * @param {string} selector\n   * @return {string}\n   */\n  _twiddleNthPlus(selector) {\n    return selector.replace(NTH, (m, type, inside) => {\n      if (inside.indexOf('+') > -1) {\n        inside = inside.replace(/\\+/g, '___');\n      } else if (inside.indexOf('___') > -1) {\n        inside = inside.replace(/___/g, '+');\n      }\n      return `:${type}(${inside})`;\n    });\n  }\n\n  /**\n   * Preserve `:matches()` selectors by replacing them with MATCHES_REPLACMENT\n   * and returning an array of `:matches()` selectors.\n   * Use `_replacesMatchesPseudo` to replace the `:matches()` parts\n   *\n   * @param {string} selector\n   * @return {{selector: string, matches: !Array<string>}}\n   */\n  _preserveMatchesPseudo(selector) {\n    /** @type {!Array<string>} */\n    const matches = [];\n    let match;\n    while ((match = selector.match(MATCHES))) {\n      const start = match.index;\n      const end = StyleUtil.findMatchingParen(selector, start);\n      if (end === -1) {\n        throw new Error(`${match.input} selector missing ')'`)\n      }\n      const part = selector.slice(start, end + 1);\n      selector = selector.replace(part, MATCHES_REPLACEMENT);\n      matches.push(part);\n    }\n    return {selector, matches};\n  }\n\n  /**\n   * Replace MATCHES_REPLACMENT character with the given set of `:matches()`\n   * selectors.\n   *\n   * @param {string} selector\n   * @param {!Array<string>} matches\n   * @return {string}\n   */\n  _replaceMatchesPseudo(selector, matches) {\n    const parts = selector.split(MATCHES_REPLACEMENT);\n    return matches.reduce((acc, cur, idx) => acc + cur + parts[idx + 1], parts[0]);\n  }\n\n/**\n * @param {string} selector\n * @param {string} scope\n * @param {string=} hostScope\n */\n  _transformComplexSelector(selector, scope, hostScope) {\n    let stop = false;\n    selector = selector.trim();\n    // Remove spaces inside of selectors like `:nth-of-type` because it confuses SIMPLE_SELECTOR_SEP\n    let isNth = NTH.test(selector);\n    if (isNth) {\n      selector = selector.replace(NTH, (m, type, inner) => `:${type}(${inner.replace(/\\s/g, '')})`)\n      selector = this._twiddleNthPlus(selector);\n    }\n    // Preserve selectors like `:-webkit-any` so that SIMPLE_SELECTOR_SEP does\n    // not get confused by spaces inside the pseudo selector\n    const isMatches = MATCHES.test(selector);\n    /** @type {!Array<string>} */\n    let matches;\n    if (isMatches) {\n      ({selector, matches} = this._preserveMatchesPseudo(selector));\n    }\n    selector = selector.replace(SLOTTED_START, `${HOST} $1`);\n    selector = selector.replace(SIMPLE_SELECTOR_SEP, (m, c, s) => {\n      if (!stop) {\n        let info = this._transformCompoundSelector(s, c, scope, hostScope);\n        stop = stop || info.stop;\n        c = info.combinator;\n        s = info.value;\n      }\n      return c + s;\n    });\n    // replace `:matches()` selectors\n    if (isMatches) {\n      selector = this._replaceMatchesPseudo(selector, matches);\n    }\n    if (isNth) {\n      selector = this._twiddleNthPlus(selector);\n    }\n    return selector;\n  }\n\n  _transformCompoundSelector(selector, combinator, scope, hostScope) {\n    // replace :host with host scoping class\n    let slottedIndex = selector.indexOf(SLOTTED);\n    if (selector.indexOf(HOST) >= 0) {\n      selector = this._transformHostSelector(selector, hostScope);\n    // replace other selectors with scoping class\n    } else if (slottedIndex !== 0) {\n      selector = scope ? this._transformSimpleSelector(selector, scope) :\n        selector;\n    }\n    // mark ::slotted() scope jump to replace with descendant selector + arg\n    // also ignore left-side combinator\n    let slotted = false;\n    if (slottedIndex >= 0) {\n      combinator = '';\n      slotted = true;\n    }\n    // process scope jumping selectors up to the scope jump and then stop\n    let stop;\n    if (slotted) {\n      stop = true;\n      if (slotted) {\n        // .zonk ::slotted(.foo) -> .zonk.scope > .foo\n        selector = selector.replace(SLOTTED_PAREN, (m, paren) => ` > ${paren}`);\n      }\n    }\n    selector = selector.replace(DIR_PAREN, (m, before, dir) =>\n      `[dir=\"${dir}\"] ${before}, ${before}[dir=\"${dir}\"]`);\n    return {value: selector, combinator, stop};\n  }\n\n  _transformSimpleSelector(selector, scope) {\n    const attributes = selector.split(/(\\[.+?\\])/);\n\n    const output = [];\n    for (let i = 0; i < attributes.length; i++) {\n      // Do not attempt to transform any attribute selector content\n      if ((i % 2) === 1) {\n        output.push(attributes[i]);\n      } else {\n        const part = attributes[i];\n\n        if (!(part === '' && i === attributes.length - 1)) {\n          let p$ = part.split(PSEUDO_PREFIX);\n          p$[0] += scope;\n          output.push(p$.join(PSEUDO_PREFIX));\n        }\n      }\n    }\n\n    return output.join('');\n  }\n\n  // :host(...) -> scopeName...\n  _transformHostSelector(selector, hostScope) {\n    let m = selector.match(HOST_PAREN);\n    let paren = m && m[2].trim() || '';\n    if (paren) {\n      if (!paren[0].match(SIMPLE_SELECTOR_PREFIX)) {\n        // paren starts with a type selector\n        let typeSelector = paren.split(SIMPLE_SELECTOR_PREFIX)[0];\n        // if the type selector is our hostScope then avoid pre-pending it\n        if (typeSelector === hostScope) {\n          return paren;\n        // otherwise, this selector should not match in this scope so\n        // output a bogus selector.\n        } else {\n          return SELECTOR_NO_MATCH;\n        }\n      } else {\n        // make sure to do a replace here to catch selectors like:\n        // `:host(.foo)::before`\n        return selector.replace(HOST_PAREN, function(m, host, paren) {\n          return hostScope + paren;\n        });\n      }\n    // if no paren, do a straight :host replacement.\n    // TODO(sorvell): this should not strictly be necessary but\n    // it's needed to maintain support for `:host[foo]` type selectors\n    // which have been improperly used under Shady DOM. This should be\n    // deprecated.\n    } else {\n      return selector.replace(HOST, hostScope);\n    }\n  }\n\n  /**\n   * @param {StyleNode} rule\n   */\n  documentRule(rule) {\n    // reset selector in case this is redone.\n    rule['selector'] = rule['parsedSelector'];\n    this.normalizeRootSelector(rule);\n    this._transformRule(rule, this._transformDocumentSelector);\n  }\n\n  /**\n   * @param {StyleNode} rule\n   */\n  normalizeRootSelector(rule) {\n    if (rule['selector'] === ROOT) {\n      rule['selector'] = 'html';\n    }\n  }\n\n/**\n * @param {string} selector\n */\n  _transformDocumentSelector(selector) {\n    if (selector.match(HOST)) {\n      // remove ':host' type selectors in document rules\n      return '';\n    } else if (selector.match(SLOTTED)) {\n      return this._transformComplexSelector(selector, SCOPE_DOC_SELECTOR)\n    } else {\n      return this._transformSimpleSelector(selector.trim(), SCOPE_DOC_SELECTOR);\n    }\n  }\n}\n\nconst NTH = /:(nth[-\\w]+)\\(([^)]+)\\)/;\nconst SCOPE_DOC_SELECTOR = `:not(.${SCOPE_NAME})`;\nconst COMPLEX_SELECTOR_SEP = ',';\nconst SIMPLE_SELECTOR_SEP = /(^|[\\s>+~]+)((?:\\[.+?\\]|[^\\s>+~=[])+)/g;\nconst SIMPLE_SELECTOR_PREFIX = /[[.:#*]/;\nconst HOST = ':host';\nconst ROOT = ':root';\nconst SLOTTED = '::slotted';\nconst SLOTTED_START = new RegExp(`^(${SLOTTED})`);\n// NOTE: this supports 1 nested () pair for things like\n// :host(:not([selected]), more general support requires\n// parsing which seems like overkill\nconst HOST_PAREN = /(:host)(?:\\(((?:\\([^)(]*\\)|[^)(]*)+?)\\))/;\n// similar to HOST_PAREN\nconst SLOTTED_PAREN = /(?:::slotted)(?:\\(((?:\\([^)(]*\\)|[^)(]*)+?)\\))/;\nconst DIR_PAREN = /(.*):dir\\((?:(ltr|rtl))\\)/;\nconst CSS_CLASS_PREFIX = '.';\nconst PSEUDO_PREFIX = ':';\nconst CLASS = 'class';\nconst SELECTOR_NO_MATCH = 'should_not_match';\nconst MATCHES = /:(?:matches|any|-(?:webkit|moz)-any)/;\nconst MATCHES_REPLACEMENT = '\\u{e000}';\n\nexport default new StyleTransformer()\n","/**\n@license\nCopyright (c) 2017 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n'use strict';\n\nimport {StyleNode} from './css-parse.js'; // eslint-disable-line no-unused-vars\n\n/** @const {string} */\nconst infoKey = '__styleInfo';\n\nexport default class StyleInfo {\n  /**\n   * @param {Element} node\n   * @return {StyleInfo}\n   */\n  static get(node) {\n    if (node) {\n      return node[infoKey];\n    } else {\n      return null;\n    }\n  }\n  /**\n   * @param {!Element} node\n   * @param {StyleInfo} styleInfo\n   * @return {StyleInfo}\n   */\n  static set(node, styleInfo) {\n    node[infoKey] = styleInfo;\n    return styleInfo;\n  }\n  /**\n   * @param {StyleNode} ast\n   * @param {Node=} placeholder\n   * @param {Array<string>=} ownStylePropertyNames\n   * @param {string=} elementName\n   * @param {string=} typeExtension\n   * @param {string=} cssBuild\n   */\n  constructor(ast, placeholder, ownStylePropertyNames, elementName, typeExtension, cssBuild) {\n    /** @type {StyleNode} */\n    this.styleRules = ast || null;\n    /** @type {Node} */\n    this.placeholder = placeholder || null;\n    /** @type {!Array<string>} */\n    this.ownStylePropertyNames = ownStylePropertyNames || [];\n    /** @type {Object} */\n    this.overrideStyleProperties = null;\n    /** @type {string} */\n    this.elementName = elementName || '';\n    /** @type {string} */\n    this.cssBuild = cssBuild || '';\n    /** @type {string} */\n    this.typeExtension = typeExtension || '';\n    /** @type {Object<string, string>} */\n    this.styleProperties = null;\n    /** @type {?string} */\n    this.scopeSelector = null;\n    /** @type {HTMLStyleElement} */\n    this.customStyle = null;\n  }\n  _getStyleRules() {\n    return this.styleRules;\n  }\n}\n\n/* eslint-disable-next-line no-self-assign */\nStyleInfo.prototype['_getStyleRules'] = StyleInfo.prototype._getStyleRules;\n","/**\n@license\nCopyright (c) 2017 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n'use strict';\n\nimport {removeCustomPropAssignment, StyleNode} from './css-parse.js'; // eslint-disable-line no-unused-vars\nimport {nativeShadow} from './style-settings.js';\nimport StyleTransformer from './style-transformer.js';\nimport * as StyleUtil from './style-util.js';\nimport * as RX from './common-regex.js';\nimport StyleInfo from './style-info.js';\n\n// TODO: dedupe with shady\n/**\n * @param {string} selector\n * @return {boolean}\n * @this {Element}\n */\nconst matchesSelector = function(selector) {\n  const method = this.matches || this.matchesSelector ||\n    this.mozMatchesSelector || this.msMatchesSelector ||\n    this.oMatchesSelector || this.webkitMatchesSelector;\n  return method && method.call(this, selector);\n};\n\nconst IS_IE = navigator.userAgent.match('Trident');\n\nconst XSCOPE_NAME = 'x-scope';\n\nclass StyleProperties {\n  get XSCOPE_NAME() {\n    return XSCOPE_NAME;\n  }\n/**\n * decorates styles with rule info and returns an array of used style property names\n *\n * @param {StyleNode} rules\n * @return {Array<string>}\n */\n  decorateStyles(rules) {\n    let self = this, props = {}, keyframes = [], ruleIndex = 0;\n    StyleUtil.forEachRule(rules, function(rule) {\n      self.decorateRule(rule);\n      // mark in-order position of ast rule in styles block, used for cache key\n      rule.index = ruleIndex++;\n      self.collectPropertiesInCssText(rule.propertyInfo.cssText, props);\n    }, function onKeyframesRule(rule) {\n      keyframes.push(rule);\n    });\n    // Cache all found keyframes rules for later reference:\n    rules._keyframes = keyframes;\n    // return this list of property names *consumes* in these styles.\n    let names = [];\n    for (let i in props) {\n      names.push(i);\n    }\n    return names;\n  }\n\n  // decorate a single rule with property info\n  decorateRule(rule) {\n    if (rule.propertyInfo) {\n      return rule.propertyInfo;\n    }\n    let info = {}, properties = {};\n    let hasProperties = this.collectProperties(rule, properties);\n    if (hasProperties) {\n      info.properties = properties;\n      // TODO(sorvell): workaround parser seeing mixins as additional rules\n      rule['rules'] = null;\n    }\n    info.cssText = this.collectCssText(rule);\n    rule.propertyInfo = info;\n    return info;\n  }\n\n  // collects the custom properties from a rule's cssText\n  collectProperties(rule, properties) {\n    let info = rule.propertyInfo;\n    if (info) {\n      if (info.properties) {\n        Object.assign(properties, info.properties);\n        return true;\n      }\n    } else {\n      let m, rx = RX.VAR_ASSIGN;\n      let cssText = rule['parsedCssText'];\n      let value;\n      let any;\n      while ((m = rx.exec(cssText))) {\n        // note: group 2 is var, 3 is mixin\n        value = (m[2] || m[3]).trim();\n        // value of 'inherit' or 'unset' is equivalent to not setting the property here\n        if (value !== 'inherit' || value !== 'unset') {\n          properties[m[1].trim()] = value;\n        }\n        any = true;\n      }\n      return any;\n    }\n\n  }\n\n  // returns cssText of properties that consume variables/mixins\n  collectCssText(rule) {\n    return this.collectConsumingCssText(rule['parsedCssText']);\n  }\n\n  // NOTE: we support consumption inside mixin assignment\n  // but not production, so strip out {...}\n  collectConsumingCssText(cssText) {\n    return cssText.replace(RX.BRACKETED, '')\n      .replace(RX.VAR_ASSIGN, '');\n  }\n\n  collectPropertiesInCssText(cssText, props) {\n    let m;\n    while ((m = RX.VAR_CONSUMED.exec(cssText))) {\n      let name = m[1];\n      // This regex catches all variable names, and following non-whitespace char\n      // If next char is not ':', then variable is a consumer\n      if (m[2] !== ':') {\n        props[name] = true;\n      }\n    }\n  }\n\n  // turns custom properties into realized values.\n  reify(props) {\n    // big perf optimization here: reify only *own* properties\n    // since this object has __proto__ of the element's scope properties\n    let names = Object.getOwnPropertyNames(props);\n    for (let i=0, n; i < names.length; i++) {\n      n = names[i];\n      props[n] = this.valueForProperty(props[n], props);\n    }\n  }\n\n  // given a property value, returns the reified value\n  // a property value may be:\n  // (1) a literal value like: red or 5px;\n  // (2) a variable value like: var(--a), var(--a, red), or var(--a, --b) or\n  // var(--a, var(--b));\n  // (3) a literal mixin value like { properties }. Each of these properties\n  // can have values that are: (a) literal, (b) variables, (c) @apply mixins.\n  valueForProperty(property, props) {\n    // case (1) default\n    // case (3) defines a mixin and we have to reify the internals\n    if (property) {\n      if (property.indexOf(';') >=0) {\n        property = this.valueForProperties(property, props);\n      } else {\n        // case (2) variable\n        let self = this;\n        let fn = function(prefix, value, fallback, suffix) {\n          if (!value) {\n            return prefix + suffix;\n          }\n          let propertyValue = self.valueForProperty(props[value], props);\n          // if value is \"initial\", then the variable should be treated as unset\n          if (!propertyValue || propertyValue === 'initial') {\n            // fallback may be --a or var(--a) or literal\n            propertyValue = self.valueForProperty(props[fallback] || fallback, props) ||\n            fallback;\n          } else if (propertyValue === 'apply-shim-inherit') {\n            // CSS build will replace `inherit` with `apply-shim-inherit`\n            // for use with native css variables.\n            // Since we have full control, we can use `inherit` directly.\n            propertyValue = 'inherit';\n          }\n          return prefix + (propertyValue || '') + suffix;\n        };\n        property = StyleUtil.processVariableAndFallback(property, fn);\n      }\n    }\n    return property && property.trim() || '';\n  }\n\n  // note: we do not yet support mixin within mixin\n  valueForProperties(property, props) {\n    let parts = property.split(';');\n    for (let i=0, p, m; i<parts.length; i++) {\n      if ((p = parts[i])) {\n        RX.MIXIN_MATCH.lastIndex = 0;\n        m = RX.MIXIN_MATCH.exec(p);\n        if (m) {\n          p = this.valueForProperty(props[m[1]], props);\n        } else {\n          let colon = p.indexOf(':');\n          if (colon !== -1) {\n            let pp = p.substring(colon);\n            pp = pp.trim();\n            pp = this.valueForProperty(pp, props) || pp;\n            p = p.substring(0, colon) + pp;\n          }\n        }\n        parts[i] = (p && p.lastIndexOf(';') === p.length - 1) ?\n          // strip trailing ;\n          p.slice(0, -1) :\n          p || '';\n      }\n    }\n    return parts.join(';');\n  }\n\n  applyProperties(rule, props) {\n    let output = '';\n    // dynamically added sheets may not be decorated so ensure they are.\n    if (!rule.propertyInfo) {\n      this.decorateRule(rule);\n    }\n    if (rule.propertyInfo.cssText) {\n      output = this.valueForProperties(rule.propertyInfo.cssText, props);\n    }\n    rule['cssText'] = output;\n  }\n\n  // Apply keyframe transformations to the cssText of a given rule. The\n  // keyframeTransforms object is a map of keyframe names to transformer\n  // functions which take in cssText and spit out transformed cssText.\n  applyKeyframeTransforms(rule, keyframeTransforms) {\n    let input = rule['cssText'];\n    let output = rule['cssText'];\n    if (rule.hasAnimations == null) {\n      // Cache whether or not the rule has any animations to begin with:\n      rule.hasAnimations = RX.ANIMATION_MATCH.test(input);\n    }\n    // If there are no animations referenced, we can skip transforms:\n    if (rule.hasAnimations) {\n      let transform;\n      // If we haven't transformed this rule before, we iterate over all\n      // transforms:\n      if (rule.keyframeNamesToTransform == null) {\n        rule.keyframeNamesToTransform = [];\n        for (let keyframe in keyframeTransforms) {\n          transform = keyframeTransforms[keyframe];\n          output = transform(input);\n          // If the transform actually changed the CSS text, we cache the\n          // transform name for future use:\n          if (input !== output) {\n            input = output;\n            rule.keyframeNamesToTransform.push(keyframe);\n          }\n        }\n      } else {\n        // If we already have a list of keyframe names that apply to this\n        // rule, we apply only those keyframe name transforms:\n        for (let i = 0; i < rule.keyframeNamesToTransform.length; ++i) {\n          transform = keyframeTransforms[rule.keyframeNamesToTransform[i]];\n          input = transform(input);\n        }\n        output = input;\n      }\n    }\n    rule['cssText'] = output;\n  }\n\n  // Test if the rules in these styles matches the given `element` and if so,\n  // collect any custom properties into `props`.\n  /**\n   * @param {StyleNode} rules\n   * @param {Element} element\n   */\n  propertyDataFromStyles(rules, element) {\n    let props = {};\n    // generates a unique key for these matches\n    let o = [];\n    // note: active rules excludes non-matching @media rules\n    StyleUtil.forEachRule(rules, (rule) => {\n      // TODO(sorvell): we could trim the set of rules at declaration\n      // time to only include ones that have properties\n      if (!rule.propertyInfo) {\n        this.decorateRule(rule);\n      }\n      // match element against transformedSelector: selector may contain\n      // unwanted uniquification and parsedSelector does not directly match\n      // for :host selectors.\n      let selectorToMatch = rule.transformedSelector || rule['parsedSelector'];\n      if (element && rule.propertyInfo.properties && selectorToMatch) {\n        if (matchesSelector.call(element, selectorToMatch)) {\n          this.collectProperties(rule, props);\n          // produce numeric key for these matches for lookup\n          addToBitMask(rule.index, o);\n        }\n      }\n    }, null, true);\n    return {properties: props, key: o};\n  }\n\n  /**\n   * @param {Element} scope\n   * @param {StyleNode} rule\n   * @param {string} cssBuild\n   * @param {function(Object)} callback\n   */\n  whenHostOrRootRule(scope, rule, cssBuild, callback) {\n    if (!rule.propertyInfo) {\n      this.decorateRule(rule);\n    }\n    if (!rule.propertyInfo.properties) {\n      return;\n    }\n    let {is, typeExtension} = StyleUtil.getIsExtends(scope);\n    let hostScope = is ?\n      StyleTransformer._calcHostScope(is, typeExtension) :\n      'html';\n    let parsedSelector = rule['parsedSelector'];\n    let isRoot = (parsedSelector === ':host > *' || parsedSelector === 'html');\n    let isHost = parsedSelector.indexOf(':host') === 0 && !isRoot;\n    // build info is either in scope (when scope is an element) or in the style\n    // when scope is the default scope; note: this allows default scope to have\n    // mixed mode built and unbuilt styles.\n    if (cssBuild === 'shady') {\n      // :root -> x-foo > *.x-foo for elements and html for custom-style\n      isRoot = parsedSelector === (hostScope + ' > *.' + hostScope) || parsedSelector.indexOf('html') !== -1;\n      // :host -> x-foo for elements, but sub-rules have .x-foo in them\n      isHost = !isRoot && parsedSelector.indexOf(hostScope) === 0;\n    }\n    if (!isRoot && !isHost) {\n      return;\n    }\n    let selectorToMatch = hostScope;\n    if (isHost) {\n      // need to transform :host because `:host` does not work with `matches`\n      if (!rule.transformedSelector) {\n        // transform :host into a matchable selector\n        rule.transformedSelector =\n        StyleTransformer._transformRuleCss(\n          rule,\n          StyleTransformer._transformComplexSelector,\n          StyleTransformer._calcElementScope(is),\n          hostScope\n        );\n      }\n      selectorToMatch = rule.transformedSelector || hostScope;\n    }\n    callback({\n      selector: selectorToMatch,\n      isHost: isHost,\n      isRoot: isRoot\n    });\n  }\n/**\n * @param {Element} scope\n * @param {StyleNode} rules\n * @param {string} cssBuild\n * @return {Object}\n */\n  hostAndRootPropertiesForScope(scope, rules, cssBuild) {\n    let hostProps = {}, rootProps = {};\n    // note: active rules excludes non-matching @media rules\n    StyleUtil.forEachRule(rules, (rule) => {\n      // if scope is StyleDefaults, use _element for matchesSelector\n      this.whenHostOrRootRule(scope, rule, cssBuild, (info) => {\n        let element = scope._element || scope;\n        if (matchesSelector.call(element, info.selector)) {\n          if (info.isHost) {\n            this.collectProperties(rule, hostProps);\n          } else {\n            this.collectProperties(rule, rootProps);\n          }\n        }\n      });\n    }, null, true);\n    return {rootProps: rootProps, hostProps: hostProps};\n  }\n\n  /**\n   * @param {Element} element\n   * @param {Object} properties\n   * @param {string} scopeSelector\n   */\n  transformStyles(element, properties, scopeSelector) {\n    let self = this;\n    let {is, typeExtension} = StyleUtil.getIsExtends(element);\n    let hostSelector = StyleTransformer\n      ._calcHostScope(is, typeExtension);\n    let rxHostSelector = element.extends ?\n      '\\\\' + hostSelector.slice(0, -1) + '\\\\]' :\n      hostSelector;\n    let hostRx = new RegExp(RX.HOST_PREFIX + rxHostSelector +\n      RX.HOST_SUFFIX);\n    let {styleRules: rules, cssBuild} = StyleInfo.get(element);\n    let keyframeTransforms =\n      this._elementKeyframeTransforms(element, rules, scopeSelector);\n    return StyleTransformer.elementStyles(element, rules, function(rule) {\n      self.applyProperties(rule, properties);\n      if (!nativeShadow &&\n          !StyleUtil.isKeyframesSelector(rule) &&\n          rule['cssText']) {\n        // NOTE: keyframe transforms only scope munge animation names, so it\n        // is not necessary to apply them in ShadowDOM.\n        self.applyKeyframeTransforms(rule, keyframeTransforms);\n        self._scopeSelector(rule, hostRx, hostSelector, scopeSelector);\n      }\n    }, cssBuild);\n  }\n\n  /**\n   * @param {Element} element\n   * @param {StyleNode} rules\n   * @param {string} scopeSelector\n   * @return {Object}\n   */\n  _elementKeyframeTransforms(element, rules, scopeSelector) {\n    let keyframesRules = rules._keyframes;\n    let keyframeTransforms = {};\n    if (!nativeShadow && keyframesRules) {\n      // For non-ShadowDOM, we transform all known keyframes rules in\n      // advance for the current scope. This allows us to catch keyframes\n      // rules that appear anywhere in the stylesheet:\n      for (let i = 0, keyframesRule = keyframesRules[i];\n           i < keyframesRules.length;\n           keyframesRule = keyframesRules[++i]) {\n        this._scopeKeyframes(keyframesRule, scopeSelector);\n        keyframeTransforms[keyframesRule['keyframesName']] =\n            this._keyframesRuleTransformer(keyframesRule);\n      }\n    }\n    return keyframeTransforms;\n  }\n\n  // Generate a factory for transforming a chunk of CSS text to handle a\n  // particular scoped keyframes rule.\n  /**\n   * @param {StyleNode} keyframesRule\n   * @return {function(string):string}\n   */\n  _keyframesRuleTransformer(keyframesRule) {\n    return function(cssText) {\n      return cssText.replace(\n          keyframesRule.keyframesNameRx,\n          keyframesRule.transformedKeyframesName);\n    };\n  }\n\n/**\n * Transforms `@keyframes` names to be unique for the current host.\n * Example: @keyframes foo-anim -> @keyframes foo-anim-x-foo-0\n *\n * @param {StyleNode} rule\n * @param {string} scopeId\n */\n  _scopeKeyframes(rule, scopeId) {\n    // Animation names are of the form [\\w-], so ensure that the name regex does not partially apply\n    // to similarly named keyframe names by checking for a word boundary at the beginning and\n    // a non-word boundary or `-` at the end.\n    rule.keyframesNameRx = new RegExp(`\\\\b${rule['keyframesName']}(?!\\\\B|-)`, 'g');\n    rule.transformedKeyframesName = rule['keyframesName'] + '-' + scopeId;\n    rule.transformedSelector = rule.transformedSelector || rule['selector'];\n    rule['selector'] = rule.transformedSelector.replace(\n        rule['keyframesName'], rule.transformedKeyframesName);\n  }\n\n  // Strategy: x scope shim a selector e.g. to scope `.x-foo-42` (via classes):\n  // non-host selector: .a.x-foo -> .x-foo-42 .a.x-foo\n  // host selector: x-foo.wide -> .x-foo-42.wide\n  // note: we use only the scope class (.x-foo-42) and not the hostSelector\n  // (x-foo) to scope :host rules; this helps make property host rules\n  // have low specificity. They are overrideable by class selectors but,\n  // unfortunately, not by type selectors (e.g. overriding via\n  // `.special` is ok, but not by `x-foo`).\n  /**\n   * @param {StyleNode} rule\n   * @param {RegExp} hostRx\n   * @param {string} hostSelector\n   * @param {string} scopeId\n   */\n  _scopeSelector(rule, hostRx, hostSelector, scopeId) {\n    rule.transformedSelector = rule.transformedSelector || rule['selector'];\n    let selector = rule.transformedSelector;\n    let scope = '.' + scopeId;\n    let parts = StyleUtil.splitSelectorList(selector);\n    for (let i=0, l=parts.length, p; (i<l) && (p=parts[i]); i++) {\n      parts[i] = p.match(hostRx) ?\n        p.replace(hostSelector, scope) :\n        scope + ' ' + p;\n    }\n    rule['selector'] = parts.join(',');\n  }\n\n  /**\n   * @param {Element} element\n   * @param {string} selector\n   * @param {string} old\n   */\n  applyElementScopeSelector(element, selector, old) {\n    let c = element.getAttribute('class') || '';\n    let v = c;\n    if (old) {\n      v = c.replace(\n        new RegExp('\\\\s*' + XSCOPE_NAME + '\\\\s*' + old + '\\\\s*', 'g'), ' ');\n    }\n    v += (v ? ' ' : '') + XSCOPE_NAME + ' ' + selector;\n    if (c !== v) {\n      StyleUtil.setElementClassRaw(element, v);\n    }\n  }\n\n  /**\n   * @param {HTMLElement} element\n   * @param {Object} properties\n   * @param {string} selector\n   * @param {HTMLStyleElement} style\n   * @return {HTMLStyleElement}\n   */\n  applyElementStyle(element, properties, selector, style) {\n    // calculate cssText to apply\n    let cssText = style ? style.textContent || '' :\n      this.transformStyles(element, properties, selector);\n    // if shady and we have a cached style that is not style, decrement\n    let styleInfo = StyleInfo.get(element);\n    let s = styleInfo.customStyle;\n    if (s && !nativeShadow && (s !== style)) {\n      s['_useCount']--;\n      if (s['_useCount'] <= 0 && s.parentNode) {\n        s.parentNode.removeChild(s);\n      }\n    }\n    // apply styling always under native or if we generated style\n    // or the cached style is not in document(!)\n    if (nativeShadow) {\n      // update existing style only under native\n      if (styleInfo.customStyle) {\n        styleInfo.customStyle.textContent = cssText;\n        style = styleInfo.customStyle;\n      // otherwise, if we have css to apply, do so\n      } else if (cssText) {\n        // apply css after the scope style of the element to help with\n        // style precedence rules.\n        style = StyleUtil.applyCss(cssText, selector, element.shadowRoot,\n          styleInfo.placeholder);\n      }\n    } else {\n      // shady and no cache hit\n      if (!style) {\n        // apply css after the scope style of the element to help with\n        // style precedence rules.\n        if (cssText) {\n          style = StyleUtil.applyCss(cssText, selector, null,\n            styleInfo.placeholder);\n        }\n      // shady and cache hit but not in document\n      } else if (!style.parentNode) {\n        if (IS_IE && cssText.indexOf('@media') > -1) {\n            // @media rules may be stale in IE 10 and 11\n            // refresh the text content of the style to revalidate them.\n          style.textContent = cssText;\n        }\n        StyleUtil.applyStyle(style, null, styleInfo.placeholder);\n      }\n    }\n    // ensure this style is our custom style and increment its use count.\n    if (style) {\n      style['_useCount'] = style['_useCount'] || 0;\n      // increment use count if we changed styles\n      if (styleInfo.customStyle != style) {\n        style['_useCount']++;\n      }\n      styleInfo.customStyle = style;\n    }\n    return style;\n  }\n\n  /**\n   * @param {Element} style\n   * @param {Object} properties\n   */\n  applyCustomStyle(style, properties) {\n    let rules = StyleUtil.rulesForStyle(/** @type {HTMLStyleElement} */(style));\n    let self = this;\n    style.textContent = StyleUtil.toCssText(rules, function(/** StyleNode */rule) {\n      let css = rule['cssText'] = rule['parsedCssText'];\n      if (rule.propertyInfo && rule.propertyInfo.cssText) {\n        // remove property assignments\n        // so next function isn't confused\n        // NOTE: we have 3 categories of css:\n        // (1) normal properties,\n        // (2) custom property assignments (--foo: red;),\n        // (3) custom property usage: border: var(--foo); @apply(--foo);\n        // In elements, 1 and 3 are separated for efficiency; here they\n        // are not and this makes this case unique.\n        css = removeCustomPropAssignment(/** @type {string} */(css));\n        // replace with reified properties, scenario is same as mixin\n        rule['cssText'] = self.valueForProperties(css, properties);\n      }\n    });\n  }\n}\n\n/**\n * @param {number} n\n * @param {Array<number>} bits\n */\nfunction addToBitMask(n, bits) {\n  let o = parseInt(n / 32, 10);\n  let v = 1 << (n % 32);\n  bits[o] = (bits[o] || 0) | v;\n}\n\nexport default new StyleProperties();","/**\n@license\nCopyright (c) 2017 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n'use strict';\n\nimport {applyStylePlaceHolder} from './style-util.js';\nimport {nativeShadow, disableRuntime} from './style-settings.js';\n\n/** @type {!Object<string, !Node>} */\nconst placeholderMap = {};\n\n/**\n * @param {string} elementName\n * @return {Node}\n */\nexport function getStylePlaceholder(elementName) {\n  return placeholderMap[elementName] || null;\n}\n\n/**\n * @param {string} elementName\n */\nexport function ensureStylePlaceholder(elementName) {\n  if (!placeholderMap[elementName]) {\n    placeholderMap[elementName] = applyStylePlaceHolder(elementName);\n  }\n}\n\n/**\n * @const {CustomElementRegistry}\n */\nconst ce = window['customElements'];\nif (ce && !nativeShadow && !disableRuntime) {\n  /**\n   * @const {function(this:CustomElementRegistry, string,function(new:HTMLElement),{extends: string}=)}\n   */\n  const origDefine = ce['define'];\n  /**\n   * @param {string} name\n   * @param {function(new:HTMLElement)} clazz\n   * @param {{extends: string}=} options\n   */\n  const wrappedDefine = (name, clazz, options) => {\n    ensureStylePlaceholder(name);\n    origDefine.call(/** @type {!CustomElementRegistry} */(ce), name, clazz, options);\n  };\n  ce['define'] = wrappedDefine;\n}","/**\n@license\nCopyright (c) 2017 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n'use strict';\n\nexport default class StyleCache {\n  constructor(typeMax = 100) {\n    // map element name -> [{properties, styleElement, scopeSelector}]\n    this.cache = {};\n    /** @type {number} */\n    this.typeMax = typeMax;\n  }\n\n  _validate(cacheEntry, properties, ownPropertyNames) {\n    for (let idx = 0; idx < ownPropertyNames.length; idx++) {\n      let pn = ownPropertyNames[idx];\n      if (cacheEntry.properties[pn] !== properties[pn]) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  store(tagname, properties, styleElement, scopeSelector) {\n    let list = this.cache[tagname] || [];\n    list.push({properties, styleElement, scopeSelector});\n    if (list.length > this.typeMax) {\n      list.shift();\n    }\n    this.cache[tagname] = list;\n  }\n\n  fetch(tagname, properties, ownPropertyNames) {\n    let list = this.cache[tagname];\n    if (!list) {\n      return;\n    }\n    // reverse list for most-recent lookups\n    for (let idx = list.length - 1; idx >= 0; idx--) {\n      let entry = list[idx];\n      if (this._validate(entry, properties, ownPropertyNames)) {\n        return entry;\n      }\n    }\n  }\n}\n","/**\n@license\nCopyright (c) 2017 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n'use strict';\n\nimport {nativeShadow} from './style-settings.js';\nimport StyleTransformer from './style-transformer.js';\nimport {getIsExtends, elementHasBuiltCss, wrap} from './style-util.js';\n\nexport let flush = function() {};\n\n/**\n * @param {!Element} element\n * @return {string}\n */\nfunction getClasses(element) {\n  if (element.classList && element.classList.value) {\n    return element.classList.value;\n  } else {\n    // NOTE: className is patched to remove scoping classes in ShadyDOM\n    // use getAttribute('class') instead, which is unpatched\n    return element.getAttribute('class') || '';\n  }\n}\n\nconst scopeRegExp = new RegExp(`${StyleTransformer.SCOPE_NAME}\\\\s*([^\\\\s]*)`);\n\n/**\n * @param {!Element} element\n * @return {string}\n */\nexport function getCurrentScope(element) {\n  const match = getClasses(element).match(scopeRegExp);\n  if (match) {\n    return match[1];\n  } else {\n    return '';\n  }\n}\n\n/**\n * @param {!Node} node\n */\nexport function getOwnerScope(node) {\n  const ownerRoot = wrap(node).getRootNode();\n  if (ownerRoot === node || ownerRoot === node.ownerDocument) {\n    return '';\n  }\n  const host = /** @type {!ShadowRoot} */(ownerRoot).host;\n  if (!host) {\n    // this may actually be a document fragment\n    return '';\n  }\n  return getIsExtends(host).is;\n}\n\n/**\n * @param {!Element} element\n */\nexport function ensureCorrectScope(element) {\n  const currentScope = getCurrentScope(element);\n  const ownerRoot = wrap(element).getRootNode();\n  if (ownerRoot === element) {\n    return;\n  }\n  if (currentScope && ownerRoot === element.ownerDocument) {\n    // node was scoped, but now is in document\n    StyleTransformer.domRemoveScope(element, currentScope);\n  } else if (ownerRoot instanceof ShadowRoot) {\n    const ownerScope = getOwnerScope(element);\n    if (ownerScope !== currentScope) {\n      // node was scoped, but not by its current owner\n      StyleTransformer.domReplaceScope(element, currentScope, ownerScope);\n    }\n  }\n}\n\n/**\n * @param {!HTMLElement|!HTMLDocument} element\n */\nexport function ensureCorrectSubtreeScoping(element) {\n  // find unscoped subtree nodes\n  const unscopedNodes = window['ShadyDOM']['nativeMethods']['querySelectorAll'].call(\n    element, `:not(.${StyleTransformer.SCOPE_NAME})`);\n\n  for (let j = 0; j < unscopedNodes.length; j++) {\n    // it's possible, during large batch inserts, that nodes that aren't\n    // scoped within the current scope were added.\n    // To make sure that any unscoped nodes that were inserted in the current batch are correctly styled,\n    // query all unscoped nodes and force their style-scope to be applied.\n    // This could happen if a sub-element appended an unscoped node in its shadowroot and this function\n    // runs on a parent element of the host of that unscoped node:\n    // parent-element -> element -> unscoped node\n    // Here unscoped node should have the style-scope element, not parent-element.\n    const unscopedNode = unscopedNodes[j];\n    const scopeForPreviouslyUnscopedNode = getOwnerScope(unscopedNode);\n    if (scopeForPreviouslyUnscopedNode) {\n      StyleTransformer.element(unscopedNode, scopeForPreviouslyUnscopedNode);\n    }\n  }\n}\n\n/**\n * @param {HTMLElement} el\n * @return {boolean}\n */\nfunction isElementWithBuiltCss(el) {\n  if (el.localName === 'style' || el.localName === 'template') {\n    return elementHasBuiltCss(el);\n  }\n  return false;\n}\n\n/**\n * @param {Array<MutationRecord|null>|null} mxns\n */\nfunction handler(mxns) {\n  for (let x=0; x < mxns.length; x++) {\n    let mxn = mxns[x];\n    if (mxn.target === document.documentElement ||\n      mxn.target === document.head) {\n      continue;\n    }\n    for (let i=0; i < mxn.addedNodes.length; i++) {\n      let n = mxn.addedNodes[i];\n      if (n.nodeType !== Node.ELEMENT_NODE) {\n        continue;\n      }\n      n = /** @type {HTMLElement} */(n); // eslint-disable-line no-self-assign\n      let root = n.getRootNode();\n      let currentScope = getCurrentScope(n);\n      // node was scoped, but now is in document\n      // If this element has built css, we must not remove scoping as this node\n      // will be used as a template or style without re - applying scoping as an optimization\n      if (currentScope && root === n.ownerDocument && !isElementWithBuiltCss(n)) {\n        StyleTransformer.domRemoveScope(n, currentScope);\n      } else if (root instanceof ShadowRoot) {\n        const newScope = getOwnerScope(n);\n        // rescope current node and subtree if necessary\n        if (newScope !== currentScope) {\n          StyleTransformer.domReplaceScope(n, currentScope, newScope);\n        }\n        // make sure all the subtree elements are scoped correctly\n        ensureCorrectSubtreeScoping(n);\n      }\n    }\n  }\n}\n\n// if native Shadow DOM is being used, or ShadyDOM handles dynamic scoiping, do not activate the MutationObserver\nif (!nativeShadow && !(window['ShadyDOM'] && window['ShadyDOM']['handlesDynamicScoping'])) {\n  let observer = new MutationObserver(handler);\n  let start = (node) => {\n    observer.observe(node, {childList: true, subtree: true});\n  }\n  let nativeCustomElements = (window['customElements'] &&\n    !window['customElements']['polyfillWrapFlushCallback']);\n  // need to start immediately with native custom elements\n  // TODO(dfreedm): with polyfilled HTMLImports and native custom elements\n  // excessive mutations may be observed; this can be optimized via cooperation\n  // with the HTMLImports polyfill.\n  if (nativeCustomElements) {\n    start(document);\n  } else {\n    let delayedStart = () => {\n      start(document.body);\n    }\n    // use polyfill timing if it's available\n    if (window['HTMLImports']) {\n      window['HTMLImports']['whenReady'](delayedStart);\n    // otherwise push beyond native imports being ready\n    // which requires RAF + readystate interactive.\n    } else {\n      requestAnimationFrame(function() {\n        if (document.readyState === 'loading') {\n          let listener = function() {\n            delayedStart();\n            document.removeEventListener('readystatechange', listener);\n          }\n          document.addEventListener('readystatechange', listener);\n        } else {\n          delayedStart();\n        }\n      });\n    }\n  }\n\n  flush = function() {\n    handler(observer.takeRecords());\n  }\n}\n","/**\n@license\nCopyright (c) 2017 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n'use strict';\n\n/**\n * @const {!Object<string, !HTMLTemplateElement>}\n */\nconst templateMap = {};\nexport default templateMap;\n","/**\n@license\nCopyright (c) 2017 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n'use strict';\nimport templateMap from './template-map.js';\nimport {StyleNode} from './css-parse.js'; // eslint-disable-line no-unused-vars\n\n/*\n * Utilities for handling invalidating apply-shim mixins for a given template.\n *\n * The invalidation strategy involves keeping track of the \"current\" version of a template's mixins, and updating that count when a mixin is invalidated.\n * The template\n */\n\n/** @const {string} */\nconst CURRENT_VERSION = '_applyShimCurrentVersion';\n\n/** @const {string} */\nconst NEXT_VERSION = '_applyShimNextVersion';\n\n/** @const {string} */\nconst VALIDATING_VERSION = '_applyShimValidatingVersion';\n\n/**\n * @const {Promise<void>}\n */\nconst promise = Promise.resolve();\n\n/**\n * @param {string} elementName\n */\nexport function invalidate(elementName){\n  let template = templateMap[elementName];\n  if (template) {\n    invalidateTemplate(template);\n  }\n}\n\n/**\n * This function can be called multiple times to mark a template invalid\n * and signal that the style inside must be regenerated.\n *\n * Use `startValidatingTemplate` to begin an asynchronous validation cycle.\n * During that cycle, call `templateIsValidating` to see if the template must\n * be revalidated\n * @param {HTMLTemplateElement} template\n */\nexport function invalidateTemplate(template) {\n  // default the current version to 0\n  template[CURRENT_VERSION] = template[CURRENT_VERSION] || 0;\n  // ensure the \"validating for\" flag exists\n  template[VALIDATING_VERSION] = template[VALIDATING_VERSION] || 0;\n  // increment the next version\n  template[NEXT_VERSION] = (template[NEXT_VERSION] || 0) + 1;\n}\n\n/**\n * @param {string} elementName\n * @return {boolean}\n */\nexport function isValid(elementName) {\n  let template = templateMap[elementName];\n  if (template) {\n    return templateIsValid(template);\n  }\n  return true;\n}\n\n/**\n * @param {HTMLTemplateElement} template\n * @return {boolean}\n */\nexport function templateIsValid(template) {\n  return template[CURRENT_VERSION] === template[NEXT_VERSION];\n}\n\n/**\n * @param {string} elementName\n * @return {boolean}\n */\nexport function isValidating(elementName) {\n  let template = templateMap[elementName];\n  if (template) {\n    return templateIsValidating(template);\n  }\n  return false;\n}\n\n/**\n * Returns true if the template is currently invalid and `startValidating` has been called since the last invalidation.\n * If false, the template must be validated.\n * @param {HTMLTemplateElement} template\n * @return {boolean}\n */\nexport function templateIsValidating(template) {\n  return !templateIsValid(template) && template[VALIDATING_VERSION] === template[NEXT_VERSION];\n}\n\n/**\n * the template is marked as `validating` for one microtask so that all instances\n * found in the tree crawl of `applyStyle` will update themselves,\n * but the template will only be updated once.\n * @param {string} elementName\n*/\nexport function startValidating(elementName) {\n  let template = templateMap[elementName];\n  startValidatingTemplate(template);\n}\n\n/**\n * Begin an asynchronous invalidation cycle.\n * This should be called after every validation of a template\n *\n * After one microtask, the template will be marked as valid until the next call to `invalidateTemplate`\n * @param {HTMLTemplateElement} template\n */\nexport function startValidatingTemplate(template) {\n  // remember that the current \"next version\" is the reason for this validation cycle\n  template[VALIDATING_VERSION] = template[NEXT_VERSION];\n  // however, there only needs to be one async task to clear the counters\n  if (!template._validating) {\n    template._validating = true;\n    promise.then(function() {\n      // sync the current version to let future invalidations cause a refresh cycle\n      template[CURRENT_VERSION] = template[NEXT_VERSION];\n      template._validating = false;\n    });\n  }\n}\n\n/**\n * @return {boolean}\n */\nexport function elementsAreInvalid() {\n  for (let elementName in templateMap) {\n    let template = templateMap[elementName];\n    if (!templateIsValid(template)) {\n      return true;\n    }\n  }\n  return false;\n}\n","/**\n@license\nCopyright (c) 2017 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n'use strict';\n\nimport { MIXIN_MATCH, VAR_ASSIGN } from './common-regex.js';\n\n/**\n * @param {Element} element\n * @param {Object=} properties\n */\nexport function updateNativeProperties(element, properties) {\n  // remove previous properties\n  for (let p in properties) {\n    // NOTE: for bc with shim, don't apply null values.\n    if (p === null) {\n      element.style.removeProperty(p);\n    } else {\n      element.style.setProperty(p, properties[p]);\n    }\n  }\n}\n\n/**\n * @param {Element} element\n * @param {string} property\n * @return {string}\n */\nexport function getComputedStyleValue(element, property) {\n  /**\n   * @const {string}\n   */\n  const value = window.getComputedStyle(element).getPropertyValue(property);\n  if (!value) {\n    return '';\n  } else {\n    return value.trim();\n  }\n}\n\n/**\n * return true if `cssText` contains a mixin definition or consumption\n * @param {string} cssText\n * @return {boolean}\n */\nexport function detectMixin(cssText) {\n  const has = MIXIN_MATCH.test(cssText) || VAR_ASSIGN.test(cssText);\n  // reset state of the regexes\n  MIXIN_MATCH.lastIndex = 0;\n  VAR_ASSIGN.lastIndex = 0;\n  return has;\n}\n","/**\n@license\nCopyright (c) 2017 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n'use strict';\n\n/** @type {Promise<void>} */\nlet readyPromise = null;\n\n/** @type {?function(?function())} */\nlet whenReady = window['HTMLImports'] && window['HTMLImports']['whenReady'] || null;\n\n/** @type {function()} */\nlet resolveFn;\n\n/**\n * @param {?function()} callback\n */\nexport default function documentWait(callback) {\n  requestAnimationFrame(function() {\n    if (whenReady) {\n      whenReady(callback)\n    } else {\n      if (!readyPromise) {\n        readyPromise = new Promise((resolve) => {resolveFn = resolve});\n        if (document.readyState === 'complete') {\n          resolveFn();\n        } else {\n          document.addEventListener('readystatechange', () => {\n            if (document.readyState === 'complete') {\n              resolveFn();\n            }\n          });\n        }\n      }\n      readyPromise.then(function(){ callback && callback(); });\n    }\n  });\n}\n","/**\n@license\nCopyright (c) 2017 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n'use strict';\n\nimport documentWait from './document-wait.js';\n\n/**\n * @typedef {HTMLStyleElement | {getStyle: function():HTMLStyleElement}}\n */\nexport let CustomStyleProvider;\n\nconst SEEN_MARKER = '__seenByShadyCSS';\nconst CACHED_STYLE = '__shadyCSSCachedStyle';\n\n/** @type {?function(!HTMLStyleElement)} */\nlet transformFn = null;\n\n/** @type {?function()} */\nlet validateFn = null;\n\n/**\nThis interface is provided to add document-level <style> elements to ShadyCSS for processing.\nThese styles must be processed by ShadyCSS to simulate ShadowRoot upper-bound encapsulation from outside styles\nIn addition, these styles may also need to be processed for @apply rules and CSS Custom Properties\n\nTo add document-level styles to ShadyCSS, one can call `ShadyCSS.addDocumentStyle(styleElement)` or `ShadyCSS.addDocumentStyle({getStyle: () => styleElement})`\n\nIn addition, if the process used to discover document-level styles can be synchronously flushed, one should set `ShadyCSS.documentStyleFlush`.\nThis function will be called when calculating styles.\n\nAn example usage of the document-level styling api can be found in `examples/document-style-lib.js`\n\n@unrestricted\n*/\nexport default class CustomStyleInterface {\n  constructor() {\n    /** @type {!Array<!CustomStyleProvider>} */\n    this['customStyles'] = [];\n    this['enqueued'] = false;\n    // NOTE(dfreedm): use quotes here to prevent closure inlining to `function(){}`;\n    documentWait(() => {\n      if (window['ShadyCSS']['flushCustomStyles']) {\n        window['ShadyCSS']['flushCustomStyles']();\n      }\n    })\n  }\n  /**\n   * Queue a validation for new custom styles to batch style recalculations\n   */\n  enqueueDocumentValidation() {\n    if (this['enqueued'] || !validateFn) {\n      return;\n    }\n    this['enqueued'] = true;\n    documentWait(validateFn);\n  }\n  /**\n   * @param {!HTMLStyleElement} style\n   */\n  addCustomStyle(style) {\n    if (!style[SEEN_MARKER]) {\n      style[SEEN_MARKER] = true;\n      this['customStyles'].push(style);\n      this.enqueueDocumentValidation();\n    }\n  }\n  /**\n   * @param {!CustomStyleProvider} customStyle\n   * @return {HTMLStyleElement}\n   */\n  getStyleForCustomStyle(customStyle) {\n    if (customStyle[CACHED_STYLE]) {\n      return customStyle[CACHED_STYLE];\n    }\n    let style;\n    if (customStyle['getStyle']) {\n      style = customStyle['getStyle']();\n    } else {\n      style = customStyle;\n    }\n    return style;\n  }\n  /**\n   * @return {!Array<!CustomStyleProvider>}\n   */\n  processStyles() {\n    const cs = this['customStyles'];\n    for (let i = 0; i < cs.length; i++) {\n      const customStyle = cs[i];\n      if (customStyle[CACHED_STYLE]) {\n        continue;\n      }\n      const style = this.getStyleForCustomStyle(customStyle);\n      if (style) {\n        // HTMLImports polyfill may have cloned the style into the main document,\n        // which is referenced with __appliedElement.\n        const styleToTransform = /** @type {!HTMLStyleElement} */(style['__appliedElement'] || style);\n        if (transformFn) {\n          transformFn(styleToTransform);\n        }\n        customStyle[CACHED_STYLE] = styleToTransform;\n      }\n    }\n    return cs;\n  }\n}\n\n/* eslint-disable no-self-assign */\nCustomStyleInterface.prototype['addCustomStyle'] = CustomStyleInterface.prototype.addCustomStyle;\nCustomStyleInterface.prototype['getStyleForCustomStyle'] = CustomStyleInterface.prototype.getStyleForCustomStyle;\nCustomStyleInterface.prototype['processStyles'] = CustomStyleInterface.prototype.processStyles;\n/* eslint-enable no-self-assign */\n\nObject.defineProperties(CustomStyleInterface.prototype, {\n  'transformCallback': {\n    /** @return {?function(!HTMLStyleElement)} */\n    get() {\n      return transformFn;\n    },\n    /** @param {?function(!HTMLStyleElement)} fn */\n    set(fn) {\n      transformFn = fn;\n    }\n  },\n  'validateCallback': {\n    /** @return {?function()} */\n    get() {\n      return validateFn;\n    },\n    /**\n     * @param {?function()} fn\n     * @this {CustomStyleInterface}\n     */\n    set(fn) {\n      let needsEnqueue = false;\n      if (!validateFn) {\n        needsEnqueue = true;\n      }\n      validateFn = fn;\n      if (needsEnqueue) {\n        this.enqueueDocumentValidation();\n      }\n    },\n  }\n})\n\n/** @typedef {{\n * customStyles: !Array<!CustomStyleProvider>,\n * addCustomStyle: function(!CustomStyleProvider),\n * getStyleForCustomStyle: function(!CustomStyleProvider): HTMLStyleElement,\n * findStyles: function(),\n * transformCallback: ?function(!HTMLStyleElement),\n * validateCallback: ?function()\n * }}\n */\nexport const CustomStyleInterfaceInterface = {};\n","/**\n@license\nCopyright (c) 2017 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n'use strict';\n\nimport {parse, StyleNode} from './css-parse.js';\nimport {nativeShadow, nativeCssVariables, disableRuntime} from './style-settings.js';\nimport StyleTransformer from './style-transformer.js';\nimport * as StyleUtil from './style-util.js';\nimport StyleProperties from './style-properties.js';\nimport {ensureStylePlaceholder, getStylePlaceholder} from './style-placeholder.js';\nimport StyleInfo from './style-info.js';\nimport StyleCache from './style-cache.js';\nimport {flush as watcherFlush, getOwnerScope, getCurrentScope} from './document-watcher.js';\nimport templateMap from './template-map.js';\nimport * as ApplyShimUtils from './apply-shim-utils.js';\nimport {updateNativeProperties, detectMixin} from './common-utils.js';\nimport {CustomStyleInterfaceInterface} from './custom-style-interface.js'; // eslint-disable-line no-unused-vars\n\n/** @type {!Object<string, string>} */\nconst adoptedCssTextMap = {};\n\n/**\n * @const {StyleCache}\n */\nconst styleCache = new StyleCache();\n\nexport default class ScopingShim {\n  constructor() {\n    this._scopeCounter = {};\n    this._documentOwner = /** @type {!HTMLElement} */(document.documentElement);\n    let ast = new StyleNode();\n    ast['rules'] = [];\n    this._documentOwnerStyleInfo = StyleInfo.set(this._documentOwner, new StyleInfo(ast));\n    this._elementsHaveApplied = false;\n    /** @type {?Object} */\n    this._applyShim = null;\n    /** @type {?CustomStyleInterfaceInterface} */\n    this._customStyleInterface = null;\n  }\n  flush() {\n    watcherFlush();\n  }\n  _generateScopeSelector(name) {\n    let id = this._scopeCounter[name] = (this._scopeCounter[name] || 0) + 1;\n    return `${name}-${id}`;\n  }\n  getStyleAst(style) {\n    return StyleUtil.rulesForStyle(style);\n  }\n  styleAstToString(ast) {\n    return StyleUtil.toCssText(ast);\n  }\n  _gatherStyles(template) {\n    return StyleUtil.gatherStyleText(template.content);\n  }\n  /**\n   * Prepare the styling and template for the given element type\n   *\n   * @param {!HTMLTemplateElement} template\n   * @param {string} elementName\n   * @param {string=} typeExtension\n   */\n  prepareTemplate(template, elementName, typeExtension) {\n    this.prepareTemplateDom(template, elementName);\n    this.prepareTemplateStyles(template, elementName, typeExtension);\n  }\n  /**\n   * Prepare styling for the given element type\n   * @param {!HTMLTemplateElement} template\n   * @param {string} elementName\n   * @param {string=} typeExtension\n   */\n  prepareTemplateStyles(template, elementName, typeExtension) {\n    if (template._prepared || disableRuntime) {\n      return;\n    }\n    // style placeholders are only used when ShadyDOM is active\n    if (!nativeShadow) {\n      ensureStylePlaceholder(elementName);\n    }\n    template._prepared = true;\n    template.name = elementName;\n    template.extends = typeExtension;\n    templateMap[elementName] = template;\n    let cssBuild = StyleUtil.getCssBuild(template);\n    const optimalBuild = StyleUtil.isOptimalCssBuild(cssBuild);\n    let info = {\n      is: elementName,\n      extends: typeExtension,\n    };\n    let cssText = this._gatherStyles(template) + (adoptedCssTextMap[elementName] || '');\n    // check if the styling has mixin definitions or uses\n    this._ensure();\n    if (!optimalBuild) {\n      let hasMixins = !cssBuild && detectMixin(cssText);\n      let ast = parse(cssText);\n      // only run the applyshim transforms if there is a mixin involved\n      if (hasMixins && nativeCssVariables && this._applyShim) {\n        this._applyShim['transformRules'](ast, elementName);\n      }\n      template['_styleAst'] = ast;\n    }\n    let ownPropertyNames = [];\n    if (!nativeCssVariables) {\n      ownPropertyNames = StyleProperties.decorateStyles(template['_styleAst']);\n    }\n    if (!ownPropertyNames.length || nativeCssVariables) {\n      let root = nativeShadow ? template.content : null;\n      let placeholder = getStylePlaceholder(elementName);\n      let style = this._generateStaticStyle(info, template['_styleAst'], root, placeholder, cssBuild, optimalBuild ? cssText : '');\n      template._style = style;\n    }\n    template._ownPropertyNames = ownPropertyNames;\n  }\n\n  /**\n   * @param {!Array<string>} cssTextArray\n   * @param {string} elementName\n   */\n  prepareAdoptedCssText(cssTextArray, elementName) {\n    adoptedCssTextMap[elementName] = cssTextArray.join(' ');\n  }\n  /**\n   * Prepare template for the given element type\n   * @param {!HTMLTemplateElement} template\n   * @param {string} elementName\n   */\n  prepareTemplateDom(template, elementName) {\n    if (disableRuntime) {\n      return;\n    }\n    const cssBuild = StyleUtil.getCssBuild(template);\n    if (!nativeShadow && cssBuild !== 'shady' && !template._domPrepared) {\n      template._domPrepared = true;\n      StyleTransformer.domAddScope(template.content, elementName);\n    }\n  }\n  /**\n   * @param {!{is: string, extends: (string|undefined)}} info\n   * @param {!StyleNode} rules\n   * @param {DocumentFragment} shadowroot\n   * @param {Node} placeholder\n   * @param {string} cssBuild\n   * @param {string=} cssText\n   * @return {?HTMLStyleElement}\n   */\n  _generateStaticStyle(info, rules, shadowroot, placeholder, cssBuild, cssText) {\n    cssText = StyleTransformer.elementStyles(info, rules, null, cssBuild, cssText);\n    if (cssText.length) {\n      return StyleUtil.applyCss(cssText, info.is, shadowroot, placeholder);\n    }\n    return null;\n  }\n  _prepareHost(host) {\n    const {is, typeExtension} = StyleUtil.getIsExtends(host);\n    const placeholder = getStylePlaceholder(is);\n    const template = templateMap[is];\n    if (!template) {\n      return;\n    }\n    const ast = template['_styleAst'];\n    const ownStylePropertyNames = template._ownPropertyNames;\n    const cssBuild = StyleUtil.getCssBuild(template);\n    const styleInfo = new StyleInfo(\n      ast,\n      placeholder,\n      ownStylePropertyNames,\n      is,\n      typeExtension,\n      cssBuild\n    );\n    StyleInfo.set(host, styleInfo);\n    return styleInfo;\n  }\n  _ensureApplyShim() {\n    if (this._applyShim) {\n      return;\n    } else if (window.ShadyCSS && window.ShadyCSS.ApplyShim) {\n      this._applyShim = /** @type {!Object} */ (window.ShadyCSS.ApplyShim);\n      this._applyShim['invalidCallback'] = ApplyShimUtils.invalidate;\n    }\n  }\n  _ensureCustomStyleInterface() {\n    if (this._customStyleInterface) {\n      return;\n    } else if (window.ShadyCSS && window.ShadyCSS.CustomStyleInterface) {\n      this._customStyleInterface = /** @type {!CustomStyleInterfaceInterface} */(window.ShadyCSS.CustomStyleInterface);\n      /** @type {function(!HTMLStyleElement)} */\n      this._customStyleInterface['transformCallback'] = (style) => {this.transformCustomStyleForDocument(style)};\n      this._customStyleInterface['validateCallback'] = () => {\n        requestAnimationFrame(() => {\n          if (this._customStyleInterface['enqueued'] || this._elementsHaveApplied) {\n            this.flushCustomStyles();\n          }\n        })\n      };\n    }\n  }\n  _ensure() {\n    this._ensureApplyShim();\n    this._ensureCustomStyleInterface();\n  }\n  /**\n   * Flush and apply custom styles to document\n   */\n  flushCustomStyles() {\n    if (disableRuntime) {\n      return;\n    }\n    this._ensure();\n    if (!this._customStyleInterface) {\n      return;\n    }\n    let customStyles = this._customStyleInterface['processStyles']();\n    // early return if custom-styles don't need validation\n    if (!this._customStyleInterface['enqueued']) {\n      return;\n    }\n    // bail if custom styles are built optimally\n    if (StyleUtil.isOptimalCssBuild(this._documentOwnerStyleInfo.cssBuild)) {\n      return;\n    }\n    if (!nativeCssVariables) {\n      this._updateProperties(this._documentOwner, this._documentOwnerStyleInfo);\n      this._applyCustomStyles(customStyles);\n      if (this._elementsHaveApplied) {\n        // if custom elements have upgraded and there are no native css variables, we must recalculate the whole tree\n        this.styleDocument();\n      }\n    } else if (!this._documentOwnerStyleInfo.cssBuild) {\n      this._revalidateCustomStyleApplyShim(customStyles);\n    }\n    this._customStyleInterface['enqueued'] = false;\n  }\n  /**\n   * Apply styles for the given element\n   *\n   * @param {!HTMLElement} host\n   * @param {Object=} overrideProps\n   */\n  styleElement(host, overrideProps) {\n    if (disableRuntime) {\n      if (overrideProps) {\n        if (!StyleInfo.get(host)) {\n          StyleInfo.set(host, new StyleInfo(null));\n        }\n        const styleInfo = /** @type {!StyleInfo} */(StyleInfo.get(host));\n        this._mixOverrideStyleProps(styleInfo, overrideProps);\n        this.styleElementNativeVariables(host, styleInfo);\n      }\n      return;\n    }\n    const styleInfo = StyleInfo.get(host) || this._prepareHost(host);\n    // if there is no style info at this point, bail\n    if (!styleInfo) {\n      return;\n    }\n    // Only trip the `elementsHaveApplied` flag if a node other that the root document has `applyStyle` called\n    if (!this._isRootOwner(host)) {\n      this._elementsHaveApplied = true;\n    }\n    if (overrideProps) {\n      this._mixOverrideStyleProps(styleInfo, overrideProps);\n    }\n    if (!nativeCssVariables) {\n      this.styleElementShimVariables(host, styleInfo);\n    } else {\n      this.styleElementNativeVariables(host, styleInfo);\n    }\n  }\n  /**\n   * @param {!StyleInfo} styleInfo\n   * @param {Object} overrideProps\n   */\n  _mixOverrideStyleProps(styleInfo, overrideProps) {\n    styleInfo.overrideStyleProperties =\n      styleInfo.overrideStyleProperties || {};\n    Object.assign(styleInfo.overrideStyleProperties, overrideProps);\n  }\n  /**\n   * @param {!HTMLElement} host\n   * @param {!StyleInfo} styleInfo\n   */\n  styleElementShimVariables(host, styleInfo) {\n    this.flush();\n    this._updateProperties(host, styleInfo);\n    if (styleInfo.ownStylePropertyNames && styleInfo.ownStylePropertyNames.length) {\n      this._applyStyleProperties(host, styleInfo);\n    }\n  }\n  /**\n   * @param {!HTMLElement} host\n   * @param {!StyleInfo} styleInfo\n   */\n  styleElementNativeVariables(host, styleInfo) {\n    const { is } = StyleUtil.getIsExtends(host);\n    if (styleInfo.overrideStyleProperties) {\n      updateNativeProperties(host, styleInfo.overrideStyleProperties);\n    }\n    const template = templateMap[is];\n    // bail early if there is no shadowroot for this element\n    if (!template && !this._isRootOwner(host)) {\n      return;\n    }\n    // bail early if the template was built with polymer-css-build\n    if (template && StyleUtil.elementHasBuiltCss(template)) {\n      return;\n    }\n    if (template && template._style && !ApplyShimUtils.templateIsValid(template)) {\n      // update template\n      if (!ApplyShimUtils.templateIsValidating(template)) {\n        this._ensure();\n        this._applyShim && this._applyShim['transformRules'](template['_styleAst'], is);\n        template._style.textContent = StyleTransformer.elementStyles(host, styleInfo.styleRules);\n        ApplyShimUtils.startValidatingTemplate(template);\n      }\n      // update instance if native shadowdom\n      if (nativeShadow) {\n        let root = host.shadowRoot;\n        if (root) {\n          let style = root.querySelector('style');\n          if (style) {\n            style.textContent = StyleTransformer.elementStyles(host, styleInfo.styleRules);\n          }\n        }\n      }\n      styleInfo.styleRules = template['_styleAst'];\n    }\n  }\n  _styleOwnerForNode(node) {\n    let root = StyleUtil.wrap(node).getRootNode();\n    let host = root.host;\n    if (host) {\n      if (StyleInfo.get(host) || this._prepareHost(host)) {\n        return host;\n      } else {\n        return this._styleOwnerForNode(host);\n      }\n    }\n    return this._documentOwner;\n  }\n  _isRootOwner(node) {\n    return (node === this._documentOwner);\n  }\n  _applyStyleProperties(host, styleInfo) {\n    let is = StyleUtil.getIsExtends(host).is;\n    let cacheEntry = styleCache.fetch(is, styleInfo.styleProperties, styleInfo.ownStylePropertyNames);\n    let cachedScopeSelector = cacheEntry && cacheEntry.scopeSelector;\n    let cachedStyle = cacheEntry ? cacheEntry.styleElement : null;\n    let oldScopeSelector = styleInfo.scopeSelector;\n    // only generate new scope if cached style is not found\n    styleInfo.scopeSelector = cachedScopeSelector || this._generateScopeSelector(is);\n    let style = StyleProperties.applyElementStyle(host, styleInfo.styleProperties, styleInfo.scopeSelector, cachedStyle);\n    if (!nativeShadow) {\n      StyleProperties.applyElementScopeSelector(host, styleInfo.scopeSelector, oldScopeSelector);\n    }\n    if (!cacheEntry) {\n      styleCache.store(is, styleInfo.styleProperties, style, styleInfo.scopeSelector);\n    }\n    return style;\n  }\n  _updateProperties(host, styleInfo) {\n    let owner = this._styleOwnerForNode(host);\n    let ownerStyleInfo = StyleInfo.get(owner);\n    let ownerProperties = ownerStyleInfo.styleProperties;\n    // style owner has not updated properties yet\n    // go up the chain and force property update,\n    // except if the owner is the document\n    if (owner !== this._documentOwner && !ownerProperties) {\n      this._updateProperties(owner, ownerStyleInfo);\n      ownerProperties = ownerStyleInfo.styleProperties;\n    }\n    let props = Object.create(ownerProperties || null);\n    let hostAndRootProps = StyleProperties.hostAndRootPropertiesForScope(host, styleInfo.styleRules, styleInfo.cssBuild);\n    let propertyData = StyleProperties.propertyDataFromStyles(ownerStyleInfo.styleRules, host);\n    let propertiesMatchingHost = propertyData.properties\n    Object.assign(\n      props,\n      hostAndRootProps.hostProps,\n      propertiesMatchingHost,\n      hostAndRootProps.rootProps\n    );\n    this._mixinOverrideStyles(props, styleInfo.overrideStyleProperties);\n    StyleProperties.reify(props);\n    styleInfo.styleProperties = props;\n  }\n  _mixinOverrideStyles(props, overrides) {\n    for (let p in overrides) {\n      let v = overrides[p];\n      // skip override props if they are not truthy or 0\n      // in order to fall back to inherited values\n      if (v || v === 0) {\n        props[p] = v;\n      }\n    }\n  }\n  /**\n   * Update styles of the whole document\n   *\n   * @param {Object=} properties\n   */\n  styleDocument(properties) {\n    this.styleSubtree(this._documentOwner, properties);\n  }\n  /**\n   * Update styles of a subtree\n   *\n   * @param {!HTMLElement} host\n   * @param {Object=} properties\n   */\n  styleSubtree(host, properties) {\n    const wrappedHost = StyleUtil.wrap(host);\n    let root = wrappedHost.shadowRoot;\n    if (root || this._isRootOwner(host)) {\n      this.styleElement(host, properties);\n    }\n    // process the shadowdom children of `host`\n    let shadowChildren =\n        root && (/** @type {!ParentNode} */ (root).children || root.childNodes);\n    if (shadowChildren) {\n      for (let i = 0; i < shadowChildren.length; i++) {\n        let c = /** @type {!HTMLElement} */(shadowChildren[i]);\n        this.styleSubtree(c);\n      }\n    } else {\n      // process the lightdom children of `host`\n      let children = wrappedHost.children || wrappedHost.childNodes;\n      if (children) {\n        for (let i = 0; i < children.length; i++) {\n          let c = /** @type {!HTMLElement} */(children[i]);\n          this.styleSubtree(c);\n        }\n      }\n    }\n  }\n  /* Custom Style operations */\n  _revalidateCustomStyleApplyShim(customStyles) {\n    for (let i = 0; i < customStyles.length; i++) {\n      let c = customStyles[i];\n      let s = this._customStyleInterface['getStyleForCustomStyle'](c);\n      if (s) {\n        this._revalidateApplyShim(s);\n      }\n    }\n  }\n  _applyCustomStyles(customStyles) {\n    for (let i = 0; i < customStyles.length; i++) {\n      let c = customStyles[i];\n      let s = this._customStyleInterface['getStyleForCustomStyle'](c);\n      if (s) {\n        StyleProperties.applyCustomStyle(s, this._documentOwnerStyleInfo.styleProperties);\n      }\n    }\n  }\n  transformCustomStyleForDocument(style) {\n    const cssBuild = StyleUtil.getCssBuild(style);\n    if (cssBuild !== this._documentOwnerStyleInfo.cssBuild) {\n      this._documentOwnerStyleInfo.cssBuild = cssBuild;\n    }\n    if (StyleUtil.isOptimalCssBuild(cssBuild)) {\n      return;\n    }\n    let ast = StyleUtil.rulesForStyle(style);\n    StyleUtil.forEachRule(ast, (rule) => {\n      if (nativeShadow) {\n        StyleTransformer.normalizeRootSelector(rule);\n      } else {\n        StyleTransformer.documentRule(rule);\n      }\n      if (nativeCssVariables && cssBuild === '') {\n        this._ensure();\n        this._applyShim && this._applyShim['transformRule'](rule);\n      }\n    });\n    if (nativeCssVariables) {\n      style.textContent = StyleUtil.toCssText(ast);\n    } else {\n      this._documentOwnerStyleInfo.styleRules['rules'].push(ast);\n    }\n  }\n  _revalidateApplyShim(style) {\n    if (nativeCssVariables && this._applyShim) {\n      let ast = StyleUtil.rulesForStyle(style);\n      this._ensure();\n      this._applyShim['transformRules'](ast);\n      style.textContent = StyleUtil.toCssText(ast);\n    }\n  }\n  getComputedStyleValue(element, property) {\n    let value;\n    if (!nativeCssVariables) {\n      // element is either a style host, or an ancestor of a style host\n      let styleInfo = StyleInfo.get(element) || StyleInfo.get(this._styleOwnerForNode(element));\n      value = styleInfo.styleProperties[property];\n    }\n    // fall back to the property value from the computed styling\n    value = value || window.getComputedStyle(element).getPropertyValue(property);\n    // trim whitespace that can come after the `:` in css\n    // example: padding: 2px -> \" 2px\"\n    return value ? value.trim() : '';\n  }\n  // given an element and a classString, replaces\n  // the element's class with the provided classString and adds\n  // any necessary ShadyCSS static and property based scoping selectors\n  setElementClass(element, classString) {\n    let root = StyleUtil.wrap(element).getRootNode();\n    let classes = classString ? classString.split(/\\s/) : [];\n    let scopeName = root.host && root.host.localName;\n    // If no scope, try to discover scope name from existing class.\n    // This can occur if, for example, a template stamped element that\n    // has been scoped is manipulated when not in a root.\n    if (!scopeName) {\n      var classAttr = element.getAttribute('class');\n      if (classAttr) {\n        let k$ = classAttr.split(/\\s/);\n        for (let i=0; i < k$.length; i++) {\n          if (k$[i] === StyleTransformer.SCOPE_NAME) {\n            scopeName = k$[i+1];\n            break;\n          }\n        }\n      }\n    }\n    if (scopeName) {\n      classes.push(StyleTransformer.SCOPE_NAME, scopeName);\n    }\n    if (!nativeCssVariables) {\n      let styleInfo = StyleInfo.get(element);\n      if (styleInfo && styleInfo.scopeSelector) {\n        classes.push(StyleProperties.XSCOPE_NAME, styleInfo.scopeSelector);\n      }\n    }\n    StyleUtil.setElementClassRaw(element, classes.join(' '));\n  }\n  _styleInfoForNode(node) {\n    return StyleInfo.get(node);\n  }\n  /**\n   * @param {!Element} node\n   * @param {string} scope\n   */\n  scopeNode(node, scope) {\n    StyleTransformer.element(node, scope);\n  }\n  /**\n   * @param {!Element} node\n   * @param {string} scope\n   */\n  unscopeNode(node, scope) {\n    StyleTransformer.element(node, scope, true);\n  }\n  /**\n   * @param {!Node} node\n   * @return {string}\n   */\n  scopeForNode(node) {\n    return getOwnerScope(node);\n  }\n  /**\n   * @param {!Element} node\n   * @return {string}\n   */\n  currentScopeForNode(node) {\n    return getCurrentScope(node);\n  }\n}\n\n/* exports */\n/* eslint-disable no-self-assign */\nScopingShim.prototype['flush'] = ScopingShim.prototype.flush;\nScopingShim.prototype['prepareTemplate'] = ScopingShim.prototype.prepareTemplate;\nScopingShim.prototype['styleElement'] = ScopingShim.prototype.styleElement;\nScopingShim.prototype['styleDocument'] = ScopingShim.prototype.styleDocument;\nScopingShim.prototype['styleSubtree'] = ScopingShim.prototype.styleSubtree;\nScopingShim.prototype['getComputedStyleValue'] = ScopingShim.prototype.getComputedStyleValue;\nScopingShim.prototype['setElementClass'] = ScopingShim.prototype.setElementClass;\nScopingShim.prototype['_styleInfoForNode'] = ScopingShim.prototype._styleInfoForNode;\nScopingShim.prototype['transformCustomStyleForDocument'] = ScopingShim.prototype.transformCustomStyleForDocument;\nScopingShim.prototype['getStyleAst'] = ScopingShim.prototype.getStyleAst;\nScopingShim.prototype['styleAstToString'] = ScopingShim.prototype.styleAstToString;\nScopingShim.prototype['flushCustomStyles'] = ScopingShim.prototype.flushCustomStyles;\nScopingShim.prototype['scopeNode'] = ScopingShim.prototype.scopeNode;\nScopingShim.prototype['unscopeNode'] = ScopingShim.prototype.unscopeNode;\nScopingShim.prototype['scopeForNode'] = ScopingShim.prototype.scopeForNode;\nScopingShim.prototype['currentScopeForNode'] = ScopingShim.prototype.currentScopeForNode;\nScopingShim.prototype['prepareAdoptedCssText'] = ScopingShim.prototype.prepareAdoptedCssText;\n/* eslint-enable no-self-assign */\nObject.defineProperties(ScopingShim.prototype, {\n  'nativeShadow': {\n    get() {\n      return nativeShadow;\n    }\n  },\n  'nativeCss': {\n    get() {\n      return nativeCssVariables;\n    }\n  }\n});\n","/**\n@license\nCopyright (c) 2017 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n\n'use strict';\n\nimport ScopingShim from '../src/scoping-shim.js';\nimport {nativeCssVariables, nativeShadow, cssBuild, disableRuntime} from '../src/style-settings.js';\n\n/** @const {ScopingShim} */\nconst scopingShim = new ScopingShim();\n\nlet ApplyShim, CustomStyleInterface;\n\nif (window['ShadyCSS']) {\n  ApplyShim = window['ShadyCSS']['ApplyShim'];\n  CustomStyleInterface = window['ShadyCSS']['CustomStyleInterface'];\n}\n\nwindow.ShadyCSS = {\n  ScopingShim: scopingShim,\n  /**\n   * @param {!HTMLTemplateElement} template\n   * @param {string} elementName\n   * @param {string=} elementExtends\n   */\n  prepareTemplate(template, elementName, elementExtends) {\n    scopingShim.flushCustomStyles();\n    scopingShim.prepareTemplate(template, elementName, elementExtends)\n  },\n\n  /**\n   * @param {!HTMLTemplateElement} template\n   * @param {string} elementName\n   */\n  prepareTemplateDom(template, elementName) {\n    scopingShim.prepareTemplateDom(template, elementName);\n  },\n\n  /**\n   * @param {!HTMLTemplateElement} template\n   * @param {string} elementName\n   * @param {string=} elementExtends\n   */\n  prepareTemplateStyles(template, elementName, elementExtends) {\n    scopingShim.flushCustomStyles();\n    scopingShim.prepareTemplateStyles(template, elementName, elementExtends)\n  },\n  /**\n   * @param {!HTMLElement} element\n   * @param {Object=} properties\n   */\n  styleSubtree(element, properties) {\n    scopingShim.flushCustomStyles();\n    scopingShim.styleSubtree(element, properties);\n  },\n\n  /**\n   * @param {!HTMLElement} element\n   */\n  styleElement(element) {\n    scopingShim.flushCustomStyles();\n    scopingShim.styleElement(element);\n  },\n\n  /**\n   * @param {Object=} properties\n   */\n  styleDocument(properties) {\n    scopingShim.flushCustomStyles();\n    scopingShim.styleDocument(properties);\n  },\n\n  flushCustomStyles() {\n    scopingShim.flushCustomStyles();\n  },\n\n  /**\n   * @param {Element} element\n   * @param {string} property\n   * @return {string}\n   */\n  getComputedStyleValue(element, property) {\n    return scopingShim.getComputedStyleValue(element, property);\n  },\n\n  nativeCss: nativeCssVariables,\n\n  nativeShadow: nativeShadow,\n\n  cssBuild: cssBuild,\n\n  disableRuntime: disableRuntime,\n};\n\nif (ApplyShim) {\n  window.ShadyCSS.ApplyShim = ApplyShim;\n}\n\nif (CustomStyleInterface) {\n  window.ShadyCSS.CustomStyleInterface = CustomStyleInterface;\n}"],"names":["ShadyData","root","publicRoot","dirty","observer","assignedNodes","assignedSlot","_previouslyAssignedNodes","_prevAssignedSlot","flattenedNodes","ownerShadyRoot","undefined","parentNode","firstChild","lastChild","previousSibling","nextSibling","childNodes","__outsideAccessors","__insideAccessors","__onCallbackListeners","ensureShadyDataForNode","node","__shady","shadyDataForNode","settings","window","hasNativeShadowDOM","Boolean","Element","prototype","attachShadow","Node","getRootNode","desc","Object","getOwnPropertyDescriptor","hasDescriptors","configurable","get","inUse","noPatch","preferPerformance","isTrackingLogicalChildNodes","nodeData","isShadyRoot","obj","_localName","hasShadowRootWithSlot","_hasInsertionPoint","p","matches","matchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector","webkitMatchesSelector","element","selector","call","twiddle","document","createTextNode","content","queue","MutationObserver","length","shift","e","textContent","observe","characterData","microtask","callback","push","hasDocumentContains","contains","container","SHADY_PREFIX","getNodeHTMLCollectionName","getAttribute","isValidHTMLCollectionName","name","isNaN","createPolyfilledHTMLCollection","nodes","l","item","index","namedItem","nodeName","NATIVE_PREFIX","patchProperties","proto","descriptors","prefix","disallowedPatches","newDescriptor","indexOf","value","defineProperty","NativeHTMLElement","HTMLElement","getOwnPropertyDescriptors","getOwnPropertyNames","forEach","flushList","scheduled","enqueue","utils","flush","didFlush","AsyncObserver","_scheduled","addedNodes","removedNodes","callbacks","Set","mutations","takeRecords","cb","observeChildren","sd","add","_callback","_observer","_node","unobserveChildren","handle","delete","size","filterMutations","target","targetRootNode","map","mutation","mutationInScope","Array","from","filter","n","create","m","escapeAttrRegExp","escapeDataRegExp","escapeReplace","c","escapeAttr","s","replace","escapeData","makeSet","arr","set","i","voidElements","plaintextParents","getOuterHTML","nodeType","ELEMENT_NODE","tagName","localName","attrs","attributes","attr","getInnerHTML","TEXT_NODE","data","COMMENT_NODE","console","error","Error","c$","child","nativeMethods","querySelector","querySelectorAll","nativeTree","installNativeAccessor","installNativeMethod","fn","defineNativeAccessors","prop","copyProperties","list","descriptor","nodeWalker","createTreeWalker","NodeFilter","SHOW_ALL","elementWalker","SHOW_ELEMENT","inertDoc","implementation","createHTMLDocument","clearNode","ParentNodeAccessors","ParentNodeMethods","addNativePrefixedProperties","eventProps","EventTarget","Window","currentNode","parentElement","DOCUMENT_FRAGMENT_NODE","textWalker","SHOW_TEXT","nextNode","nodeValue","ParentNodeWalkerDescriptors","firstElementChild","lastElementChild","children","childElementCount","previousElementSibling","nextElementSibling","innerHTML","containerName","htmlContainer","namespaceURI","createElement","createElementNS","newContent","HTMLTemplateElement","DocumentFragment","Document","InsideDescriptors","shadowRoot","OutsideDescriptors","className","enumerable","noInstancePatching","patchOutsideElementAccessors","patchInsideElementAccessors","eventWrappersName","Date","now","composedGetter","composedProp","Event","ev","alwaysComposed","unpatchedEvents","getRootNodeWithFallback","eventTarget","pathComposer","startNode","composed","composedPath","current","startRoot","host","event","__composedPath","retarget","refNode","path","refNodePath","p$","ancestor","lastRoot","rootIdx","EventPatches","__composed","type","isTrusted","currentTarget","relatedTarget","__relatedTarget","__relatedTargetComposedPath","stopPropagation","__propagationStopped","stopImmediatePropagation","__immediatePropagationStopped","mixinComposedFlag","Base","klazz","options","__proto__","nonBubblingEventsToRetarget","hasRetargeted","fireHandlers","phase","hs","__handlers","retargetNonBubblingEvent","AT_TARGET","lastFiredRoot","listenerSettingsEqual","savedListener","capture","once","passive","savedNode","savedType","savedCapture","savedOnce","savedPassive","findListener","wrappers","getEventWrappers","eventLike","addEventListener","fnOrObj","optionsOrCapture","handlerType","handleEvent","__shadyTarget","wrapperFn","patchEvent","lastCurrentTargetDesc","eventPhase","BUBBLING_PHASE","CAPTURING_PHASE","bubbles","ret","removeEventListener","idx","splice","activateFocusEventOverrides","EventPatchesDescriptors","SHADY_PROTO","SHADY_SOURCE_PROTO","getPrototypeOf","hasOwnProperty","patchedProto","PatchedEvent","PatchedCustomEvent","CustomEvent","PatchedMouseEvent","MouseEvent","patchEvents","patchClick","composedClickFn","cancelable","click","eventPropertyNames","substring","newSplice","removed","addedCount","EDIT_LEAVE","EDIT_UPDATE","EDIT_ADD","EDIT_DELETE","calcEditDistances","currentStart","currentEnd","old","oldStart","oldEnd","rowCount","columnCount","distances","j","equals","north","west","spliceOperationsFromEditDistances","edits","northWest","min","reverse","calcSplices","prefixCount","suffixCount","minLength","Math","sharedPrefix","sharedSuffix","ops","splices","oldIndex","searchLength","index1","index2","count","currentValue","previousValue","calculateSplices","previous","linkNode","ref_node","containerData","ref_nodeData","psd","nsd","recordInsertBefore","resetTo","recordRemoveChild","recordChildNodes","first","scopingShim","getScopingShim","scopeClassAttribute","addShadyScoping","newScopeName","removeShadyScoping","currentScopeName","replaceShadyScoping","oldScopeName","currentScopeIsCorrect","correctScope","currentScope","currentScopeForNode","treeVisitor","visitorFn","doc","nativeIsConnectedAccessors","nativeIsConnected","removeOwnerShadyRoot","hasCachedOwnerRoot","firstComposedNode","flattened","scheduleObserver","addedNode","removedNode","schedule","NodePatches","isConnected","ownerDocument","documentElement","tc","cn","join","insertBefore","refData","slotsAdded","ownerRoot","ownerShadyRootForNode","allowNativeInsert","needsScoping","needsSlotFinding","_addSlots","_asyncRender","parentData","adoptNode","appendChild","removeChild","skipUnscoping","preventNativeRemove","removingInsertionPoint","_removeContainedSlots","changeSlotContent","replaceChild","cloneNode","deep","ATTRIBUTE_NODE","nc","parent","query","matcher","halter","queryElements","elements","queryElement","result","ParentNodePatches","QueryPatches","useNative","o","slice","ParentNodeDocumentOrFragmentPatches","assign","DocumentOrFragmentPatches","getElementById","id","getDocumentActiveElement","activeElement","DocumentOrShadowRootPatches","active","activeRoot","ElementOrShadowRootPatches","ShadowRootPatches","patchShadyAccessors","patchShadyRoot","defineProperties","ShadyRootConstructionToken","CATCHALL_NAME","SHADYROOT_NAME","MODE_CLOSED","isRendering","readyState","rootRendered","ancestorList","ancestors","unshift","ShadyRoot","token","TypeError","mode","hostData","rootData","_renderPending","_hasRendered","_slotList","_slotMap","_pendingSlots","_render","renderRoot","_getDistributionParent","__childSlotCount","_getPendingDistributionRoot","_renderSelf","wasRendering","_distribute","_compose","_validateSlots","slot","_clearSlotAssignedNodes","_distributeNodeToSlot","slotData","slotParentData","slotParentRoot","_addAssignedToFlattenedNodes","prevAssignedNodes","_fireSlotChange","forcedSlot","oldSlot","n$","assigned","nestedAssigned","slots","composeList","targetNode","_updateChildNodes","_composeNode","_isInsertionPoint","distributedNode","d","next","_ensureSlotData","_mapSlots","slotNamesToSort","slotParent","_nameForSlot","_sortSlots","__slotName","sort","a","b","listA","listB","nA","nB","didRemove","x","_removeFlattenedNodes","oldName","connectMap","Map","r","v","k","clear","__shadydom_connectedCallback","__shadydom_disconnectedCallback","ManageConnect","base","connected","disconnected","counter","connectFlag","connectedCallback","disconnectedCallback","define","constructor","Wrapper","DOCUMENT_NODE","wrapperMap","WeakMap","wrap","wrapper","EventTargetPatches","dispatchEvent","SlotablePatches","distributeAttributeChange","_updateSlotName","ElementPatches","setAttribute","removeAttribute","HTMLElementPatches","blur","shadowActive","property","shadyData","eventName","SlotPatches","flatten","DocumentPatches","importNode","WindowPatches","bind","NonStandardHTMLElement","ElementShouldHaveInnerHTML","patchMap","Text","HTMLSlotElement","getPatchPrototype","disallowedNativePatches","applyPatches","disallowed","patch","addShadyPrefixedProperties","ShadyDOM","_flushInitial","ShadowRoot","reservedTagList","isValidCustomElementName","reserved","has","validForm","test","nativeValue","__CE_isImportDocument","nextSiblingOrAncestorSibling","start","walkDeepDescendantElements","visitedImports","import","__CE_shadowRoot","setPropertyUnchecked","destination","CustomElementState","custom","failed","CustomElementInternals","_localNameToDefinition","_constructorToDefinition","_patches","_hasPatches","definition","constructorFunction","listener","Utilities","__CE_patched","__CE_state","CEState","upgradeElement","upgrade","gatherElements","__CE_hasRegistry","__CE_documentLoadHandled","clonedVisitedImports","patchAndUpgradeTree","currentState","defaultView","localNameToDefinition","constructionStack","pop","__CE_definition","attributeChangedCallback","observedAttributes","oldValue","newValue","namespace","DocumentConstructionObserver","internals","_internals","_document","_handleMutations","childList","subtree","disconnect","Deferred","_value","_resolve","_promise","Promise","resolve","CustomElementRegistry","_elementDefinitionIsRunning","_whenDefinedDeferred","_flushCallback","_flushPending","_pendingDefinitions","_documentConstructionObserver","Function","SyntaxError","adoptedCallback","getCallback","callbackValue","setDefinition","_flush","pendingDefinitions","elementsWithStableDefinitions","elementsWithPendingDefinitions","pendingElements","pendingUpgradableElements","deferred","reject","prior","toPromise","some","outer","inner","whenDefined","polyfillWrapFlushCallback","Document_createElement","Document_createElementNS","Document_importNode","Document_prepend","Document_append","DocumentFragment_prepend","DocumentFragment_append","Node_cloneNode","Node_appendChild","Node_insertBefore","Node_removeChild","Node_replaceChild","Node_textContent","Element_attachShadow","Element_innerHTML","Element_getAttribute","Element_setAttribute","Element_removeAttribute","Element_getAttributeNS","getAttributeNS","Element_setAttributeNS","setAttributeNS","Element_removeAttributeNS","removeAttributeNS","Element_insertAdjacentElement","Element_insertAdjacentHTML","Element_prepend","Element_append","Element_before","Element_after","Element_replaceWith","Element_remove","HTMLElement_innerHTML","HTMLElement_insertAdjacentElement","HTMLElement_insertAdjacentHTML","AlreadyConstructedMarker","constructorToDefinition","Native","setPrototypeOf","lastIndex","toConstructElement","writable","builtIn","appendPrependPatch","builtInMethod","connectedElements","apply","disconnectTree","connectTree","prepend","append","clone","patchTree","NS_HTML","PatchParentNode","insertedNodes","nativeResult","nodeWasConnected","nodeToInsert","nodeToRemove","nodeToInsertWasConnected","thisIsConnected","patch_textContent","baseDescriptor","assignedValue","childNodesLength","addPatch","parts","beforeAfterPatch","before","after","replaceWith","wasConnected","remove","init","patch_innerHTML","htmlString","removedElements","isTemplate","rawElement","patch_insertAdjacentElement","baseMethod","position","insertedElement","warn","patch_insertAdjacentHTML","upgradeNodesInRange","end","text","toLowerCase","marker","String","PatchChildNode","priorCustomElements","PatchHTMLElement","PatchDocument","PatchDocumentFragment","PatchNode","PatchElement","customElements","StyleNode","parse","clean","parseCss","lex","cssText","RX","comments","port","OPEN_BRACE","CLOSE_BRACE","t","trim","ss","_expandUnicodeEscapes","multipleSpaces","lastIndexOf","AT_START","MEDIA_START","types","MEDIA_RULE","match","keyframesRule","KEYFRAMES_RULE","split","VAR_START","MIXIN_RULE","STYLE_RULE","r$","code","arguments","repeat","stringify","preserveProperties","_hasMixinRules","removeCustomProps","rules","removeCustomPropAssignment","removeCustomPropApply","customProp","mixinProp","mixinApply","varApply","nativeShadow","nativeCssVariables_","calcCssVariables","navigator","userAgent","CSS","supports","cssBuild","ShadyCSS","disableRuntime","nativeCss","nativeCssVariables","VAR_ASSIGN","MIXIN_MATCH","VAR_CONSUMED","ANIMATION_MATCH","MEDIA_MATCH","BRACKETED","HOST_PREFIX","HOST_SUFFIX","styleTextSet","scopingAttribute","processUnscopedStyle","style","newStyle","head","isUnscopedStyle","hasAttribute","toCssText","forEachRule","rulesForStyle","isKeyframesSelector","rule","styleRuleCallback","keyframesRuleCallback","onlyActiveRules","skipRules","matchMedia","applyCss","moniker","contextNode","createScopeStyle","applyStyle","lastHeadApplyNode","applyStylePlaceHolder","placeHolder","createComment","scope","compareDocumentPosition","DOCUMENT_POSITION_PRECEDING","findMatchingParen","level","processVariableAndFallback","str","suffix","comma","fallback","setElementClassRaw","getIsExtends","is","typeExtension","extends","gatherStyleText","styleTextParts","styles","splitSelectorList","part","CSS_BUILD_ATTR","getCssBuild","__cssBuild","attrValue","buildComment","getBuildComment","removeBuildComment","elementHasBuiltCss","Comment","commentParts","isOptimalCssBuild","SCOPE_NAME","StyleTransformer","shouldRemoveScope","_transformDom","transformer","template","_content","classList","CLASS","StyleUtil","oldScope","newScope","styleRules","css","ext","hostScope","_calcHostScope","_calcElementScope","self","isScoped","CSS_CLASS_PREFIX","_transformRule","_transformComplexSelector","transformedSelector","_transformRuleCss","COMPLEX_SELECTOR_SEP","NTH","inside","MATCHES","input","MATCHES_REPLACEMENT","reduce","acc","cur","stop","isNth","_twiddleNthPlus","isMatches","_preserveMatchesPseudo","SLOTTED_START","HOST","SIMPLE_SELECTOR_SEP","info","_transformCompoundSelector","combinator","_replaceMatchesPseudo","slottedIndex","SLOTTED","_transformHostSelector","_transformSimpleSelector","slotted","SLOTTED_PAREN","paren","DIR_PAREN","dir","output","PSEUDO_PREFIX","HOST_PAREN","SIMPLE_SELECTOR_PREFIX","typeSelector","SELECTOR_NO_MATCH","normalizeRootSelector","_transformDocumentSelector","ROOT","SCOPE_DOC_SELECTOR","RegExp","infoKey","StyleInfo","styleInfo","ast","placeholder","ownStylePropertyNames","elementName","overrideStyleProperties","styleProperties","scopeSelector","customStyle","_getStyleRules","method","IS_IE","XSCOPE_NAME","StyleProperties","props","keyframes","ruleIndex","decorateRule","collectPropertiesInCssText","propertyInfo","onKeyframesRule","_keyframes","names","properties","hasProperties","collectProperties","collectCssText","rx","any","exec","collectConsumingCssText","valueForProperty","valueForProperties","propertyValue","colon","pp","keyframeTransforms","hasAnimations","transform","keyframeNamesToTransform","keyframe","selectorToMatch","addToBitMask","key","parsedSelector","isRoot","isHost","hostProps","rootProps","whenHostOrRootRule","_element","hostSelector","rxHostSelector","hostRx","_elementKeyframeTransforms","elementStyles","applyProperties","applyKeyframeTransforms","_scopeSelector","keyframesRules","_scopeKeyframes","_keyframesRuleTransformer","keyframesNameRx","transformedKeyframesName","scopeId","transformStyles","bits","parseInt","placeholderMap","getStylePlaceholder","ensureStylePlaceholder","ce","origDefine","wrappedDefine","clazz","StyleCache","typeMax","cache","cacheEntry","ownPropertyNames","pn","tagname","styleElement","entry","_validate","getClasses","scopeRegExp","getCurrentScope","getOwnerScope","ensureCorrectSubtreeScoping","unscopedNodes","unscopedNode","scopeForPreviouslyUnscopedNode","isElementWithBuiltCss","el","handler","mxns","mxn","domRemoveScope","domReplaceScope","nativeCustomElements","delayedStart","body","requestAnimationFrame","templateMap","CURRENT_VERSION","NEXT_VERSION","VALIDATING_VERSION","promise","invalidate","invalidateTemplate","templateIsValid","templateIsValidating","startValidatingTemplate","_validating","then","updateNativeProperties","removeProperty","setProperty","detectMixin","readyPromise","whenReady","resolveFn","documentWait","SEEN_MARKER","CACHED_STYLE","transformFn","validateFn","CustomStyleInterface","enqueueDocumentValidation","cs","getStyleForCustomStyle","styleToTransform","addCustomStyle","processStyles","needsEnqueue","adoptedCssTextMap","styleCache","ScopingShim","_scopeCounter","_documentOwner","_documentOwnerStyleInfo","_elementsHaveApplied","_applyShim","_customStyleInterface","watcherFlush","prepareTemplateDom","prepareTemplateStyles","_prepared","optimalBuild","_gatherStyles","_ensure","hasMixins","decorateStyles","_generateStaticStyle","_style","_ownPropertyNames","cssTextArray","_domPrepared","domAddScope","shadowroot","ApplyShim","ApplyShimUtils","transformCustomStyleForDocument","flushCustomStyles","_ensureApplyShim","_ensureCustomStyleInterface","customStyles","_updateProperties","_applyCustomStyles","styleDocument","_revalidateCustomStyleApplyShim","overrideProps","_mixOverrideStyleProps","styleElementNativeVariables","_prepareHost","_isRootOwner","styleElementShimVariables","_applyStyleProperties","_styleOwnerForNode","fetch","cachedScopeSelector","cachedStyle","oldScopeSelector","_generateScopeSelector","applyElementStyle","applyElementScopeSelector","store","owner","ownerStyleInfo","ownerProperties","hostAndRootProps","hostAndRootPropertiesForScope","propertyData","propertyDataFromStyles","propertiesMatchingHost","_mixinOverrideStyles","reify","overrides","styleSubtree","wrappedHost","shadowChildren","_revalidateApplyShim","applyCustomStyle","documentRule","getComputedStyle","getPropertyValue","classString","classes","scopeName","classAttr","k$","prepareTemplate","getComputedStyleValue","setElementClass","_styleInfoForNode","getStyleAst","styleAstToString","scopeNode","unscopeNode","scopeForNode","prepareAdoptedCssText","elementExtends"],"mappings":"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"}